"use strict";var app=angular.module("ancestorsTale",["ngCookies","ngResource","ngSanitize","ngAnimate","ui.router","ui.bootstrap","pascalprecht.translate","angular-growl","angularMoment","angular-loading-bar","services.titleService","services.referenceData","rorymadden.languages","rorymadden.dateUtils","config","security","policies","user","project","person","name","fact","relationship","templates-main"]);app.config(["$stateProvider","$locationProvider","$urlRouterProvider","$httpProvider","$translateProvider","growlProvider",function(a,b,c,d,e,f){a.state("default",{url:"",resolve:app.defaultHome}).state("home",{url:"/",resolve:app.defaultHome}).state("404",{url:"/404",templateUrl:"templates/404.tpl.html"}).state("500",{url:"/500",templateUrl:"templates/500.tpl.html"}),c.otherwise("/404"),d.defaults.withCredentials=!0,d.defaults.useXDomain=!0,delete d.defaults.headers.common["X-Requested-With"],f.messageTextKey("code"),e.useStaticFilesLoader({prefix:"locales/",suffix:".json"}),e.preferredLanguage("en_UK"),e.fallbackLanguage("en_UK")}]),app.run(["titleService","$rootScope","$state",function(a,b,c){b.$state=c,a.setPrefix("Ancestor's Tale | ")}]),app.run(["security",function(a){a.requestCurrentUser()}]),app.defaultHome={authenticated:["security","$state","$q","projectService",function(a,b,c,d){var e=c.defer();return a.requestCurrentUser().then(function(a){null===a?(b.go("register.show"),e.resolve()):d.getCurrentProject().then(function(a){a&&a.data?b.go("project.show",{projectId:a.data.projectId}):b.go("project.create"),e.resolve()},function(){b.go("500")})}),e.promise}]},app.controller("HeaderCtrl",["$scope","$state",function(a,b){a.location=b,a.menuOpen=!1,a.$on("$stateChangeStart",function(){a.menuOpen=!1})}]),angular.module("config",[]).value("server","http://api.ancestorstale.com").value("api","/api/v0"),angular.module("templates-main",["scripts/common/services/confirmModal/templates/confirmModal.tpl.html","scripts/home/templates/benefits.tpl.html","scripts/person/directives/dateField/templates/dateField.tpl.html","scripts/person/directives/fullTextField/templates/nameFullTextField.tpl.html","scripts/person/directives/namePartField/templates/namePartField.tpl.html","scripts/person/directives/placeField/templates/placeField.tpl.html","scripts/person/directives/relationshipTypeField/templates/relationshipTypeField.tpl.html","scripts/person/directives/textField/templates/textField.tpl.html","scripts/person/templates/abstract.tpl.html","scripts/person/templates/factForm.tpl.html","scripts/person/templates/nameForm.tpl.html","scripts/person/templates/person.tpl.html","scripts/person/templates/personEdit.tpl.html","scripts/person/templates/personFacts.tpl.html","scripts/person/templates/personHistory.tpl.html","scripts/person/templates/personPaths.tpl.html","scripts/person/templates/personRelationships.tpl.html","scripts/person/templates/personShow.tpl.html","scripts/person/templates/relationshipForm.tpl.html","scripts/person/templates/relationshipPotentials.tpl.html","scripts/policies/templates/disputes.tpl.html","scripts/policies/templates/guidelines.tpl.html","scripts/policies/templates/licensing.tpl.html","scripts/policies/templates/policies.tpl.html","scripts/policies/templates/policiesMenu.tpl.html","scripts/policies/templates/privacy.tpl.html","scripts/policies/templates/terms.tpl.html","scripts/project/templates/contractLinksModal.tpl.html","scripts/project/templates/graph.tpl.html","scripts/project/templates/project.tpl.html","scripts/project/templates/projectCreate.tpl.html","scripts/project/templates/projectGraph.tpl.html","scripts/security/templates/loginFormModal.tpl.html","scripts/security/templates/loginToolbar.tpl.html","scripts/user/templates/account.tpl.html","scripts/user/templates/accountMenu.tpl.html","scripts/user/templates/accountPassword.tpl.html","scripts/user/templates/accountShow.tpl.html","scripts/user/templates/changeForgottenPassword.tpl.html","scripts/user/templates/checkEmail.tpl.html","scripts/user/templates/forgotPassword.tpl.html","scripts/user/templates/profile.tpl.html","scripts/user/templates/profileMenu.tpl.html","scripts/user/templates/profileShow.tpl.html","scripts/user/templates/register.tpl.html","scripts/user/templates/registerShow.tpl.html","scripts/user/templates/resendActivation.tpl.html","scripts/user/templates/terms.tpl.html","templates/404.tpl.html","templates/500.tpl.html","templates/main.tpl.html"]),angular.module("scripts/common/services/confirmModal/templates/confirmModal.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/common/services/confirmModal/templates/confirmModal.tpl.html","<div class=modal-header><h3 name=confirmModalTitle>{{content + '.Title' | translate}} {{type}}</h3></div><div class=modal-body><p name=confirmModalText>{{content + '.Body' | translate}}{{type | lowercase}}?</p></div><div class=modal-footer><button class=\"btn btn-danger\" ng-click=ok()>{{content + '.Leave' | translate}}</button> <button class=\"btn btn-primary\" ng-click=cancel()>{{content + '.Stay' | translate}}</button></div>")}]),angular.module("scripts/home/templates/benefits.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/home/templates/benefits.tpl.html","<div><div class=row><div class=\"col-xs-12 col-md-6 pull-right\"><img class=puzzleLogo src=./images/logoPuzzle.png></div><div class=\"col-xs-12 col-md-6\"><h1>{{'Home.HomeCtrl.Slogan' | translate}}<br><small>{{'Home.HomeCtrl.SubSlogan' | translate}}</small></h1><h3><em>{{'Home.HomeCtrl.SubSubSlogan' | translate}}</em></h3></div></div><div class=\"row marketing\"><div class=\"col-xs-12 col-md-4\"><div class=benefit-item><span class=\"glyphicon glyphicon-link xlarge\"></span><h4>{{'Home.HomeCtrl.Connect' | translate}}</h4><p>{{'Home.HomeCtrl.ConnectText' | translate}}</p></div></div><div class=\"col-xs-12 col-md-4\"><div class=benefit-item><span class=\"glyphicon glyphicon-transfer xlarge\"></span><h4>{{'Home.HomeCtrl.Collaborate' | translate}}</h4><p>{{'Home.HomeCtrl.CollaborateText' | translate}}</p></div></div><div class=\"col-xs-12 col-md-4\"><div class=benefit-item><span class=\"glyphicon glyphicon-fullscreen xlarge\"></span><h4>{{'Home.HomeCtrl.Explore' | translate}}</h4><p>{{'Home.HomeCtrl.ExploreText' | translate}}</p></div></div></div></div>")}]),angular.module("scripts/person/directives/dateField/templates/dateField.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/person/directives/dateField/templates/dateField.tpl.html",'<div ng-if="!hide && (loggedIn || (!loggedIn && date))"><div class="panel panel-default"><div class=panel-heading><div class=row><div class=col-xs-7><h4 class=panel-title><span name=dateTitle>{{label | translate}}</span> <small class=text-muted ng-if=optional name=dateTitleOptional>({{\'rsmPlaceField.Optional\' | translate}})</small></h4></div><div class=col-xs-5><div class="btn-group btn-group-sm pull-right" ng-if="loggedIn && (show || date.range)"><button type=button class="btn btn-default" ng-model=date.approximate btn-radio=false ng-checked=setDateType() name=exactDate><span class=icon-calendar2></span></button> <button type=button class="btn btn-default" ng-model=date.approximate btn-radio=true ng-checked=setDateType() name=approximateDate><span class=icon-calendar></span></button></div><div class=pull-right ng-click=showDate() ng-if="loggedIn && !show && !date.range"><small class=text-muted><span class="glyphicon glyphicon-plus" name=showDate></span></small></div></div></div></div><div class=panel-body><div ng-if=loggedIn><div class="col-xs-12 noPadding" ng-show=date.approximate><div class=form-group><label for=dateRangeType class=sr-only>{{\'rsmDateField.DateRange\' | translate}}</label><select class=form-control ng-options="o.value as translate(o.name) for o in dateRangeOptions" name=dateRangeType ng-model=date.range ng-change=setDateRangeOption()></select></div></div><div class="col-xs-12 noPadding" ng-show="show && dateElements.startDate"><div class="form-group col-xs-3 noPadding"><select name=date.startDateDay data-ng-model=date.startDateDay class=form-control ng-options="day for day in days" ng-change="checkDate(date, \'start\')"></select></div><div class="form-group col-xs-4 noPadding"><select name=date.startDateMonth data-ng-model=date.startDateMonth class=form-control ng-options="month.value as translate(month.name) for month in months" ng-change="checkDate(date, \'start\')"></select></div><div class="form-group col-xs-4 noPadding"><input type=number name=date.startDateYear data-ng-model=date.startDateYear placeholder=Year class=form-control ng-change="checkDate(date, \'start\')"></div><div class="col-xs-1 noPadding centered"><span class="pull-right glyphicon glyphicon-remove-circle" ng-click="removeDate(\'start\')" name=removeDate></span></div></div><div ng-show="dateElements.endDate && date.approximate"><label class=control-label for=toDate>{{\'rsmDateField.To\' | translate}}</label><div class="col-xs-12 noPadding"><div class="form-group col-xs-3 noPadding"><select name=date.endDateDay data-ng-model=date.endDateDay class=form-control ng-options="day for day in days" ng-change="checkDate(date, \'end\')"></select></div><div class="form-group col-xs-4 noPadding"><select name=date.endDateMonth data-ng-model=date.endDateMonth class=form-control ng-options="month.value as translate(month.name) for month in months" ng-change="checkDate(date, \'end\')"></select></div><div class="form-group col-xs-4 noPadding"><input type=number name=date.endDateYear data-ng-model=date.endDateYear placeholder=Year class=form-control ng-change="checkDate(date, \'end\')"></div><div class="col-xs-1 noPadding centered"></div></div></div></div><div ng-if="!loggedIn && date"><p class=form-control-static name=staticDate>{{date | dateFilter}}</p></div></div></div></div>')}]),angular.module("scripts/person/directives/fullTextField/templates/nameFullTextField.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/person/directives/fullTextField/templates/nameFullTextField.tpl.html",'<div class=form-group><div ng-if=!editable><h4 class=form-control-static><span ng-if=!nameForm.customFullText name=calculatedName>{{nameForm.nameParts | calculatedName}}</span>  <span ng-if=nameForm.customFullText name=customName>{{nameForm.fullText}}</span> <a ng-click=edit() ng-if=canEdit()><small><span class="pull-right glyphicon glyphicon-pencil" name=editFullText></span></small></a></h4><hr ng-if="(nameForm.customFullText || nameForm.nameParts | calculatedName | iif:true:false)"></div><div ng-if=editable><label for=fullText>{{\'rsmFullTextField.FullText\' | translate}}</label><div class=input-group><input class=form-control name=fullText data-ng-model=nameForm.fullText required> <span class=input-group-btn><button type=button class="btn btn-default" ng-click=cancelEdit() name=cancelEditFullText><span class="glyphicon glyphicon-remove-circle"></span></button></span></div><hr></div></div>')}]),angular.module("scripts/person/directives/namePartField/templates/namePartField.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/person/directives/namePartField/templates/namePartField.tpl.html",'<div class=form-group ng-if="loggedIn || parts.length"><label for={{name}}>{{label}} <small class=text-muted ng-if=!mandatory>({{\'rsmNamePartField.Optional\' | translate}})</small></label><div class=pull-right ng-click=addField() ng-if=loggedIn name=add_{{name}}><small class=text-muted><span class="glyphicon glyphicon-plus"></span></small></div><div ng-repeat="part in parts | orderBy:\'order\'" ng-form=namePartFieldForm name={{name}}_parts><div class=input-group ng-if=$parent.loggedIn><input class=form-control name=part data-ng-model=part.value ng-required=part.mandatory> <span class=input-group-btn><button type=button class="btn btn-default" ng-init="part.showQualifier=false" ng-click="part.showQualifier = !part.showQualifier" name=showQualifier><span class=glyphicon ng-class="{\'glyphicon-chevron-down\': !part.showQualifier, \'glyphicon-chevron-up\': part.showQualifier}"></span></button></span> <span class=input-group-btn ng-show=!part.mandatory><button type=button class="btn btn-default" ng-click="removeField( part._tempId)" name=removeField><span class="glyphicon glyphicon-remove-circle"></span></button></span></div><div class=input-group ng-show=part.showQualifier><span class=input-group-addon>{{\'rsmNamePartField.Qualifier\' | translate}}</span> <div class=checkbox ng-repeat="qualifier in qualifiers | inArray:\'partType\':name"><label><input type=checkbox ng-checked="part.qualifier.indexOf(qualifier.value) > -1" ng-click="toggleQualifier(qualifier.value, part.qualifier)"> {{qualifier.name | translate}}</label></div></div><span class=help-block data-ng-show="submitted && namePartFieldForm.part.$invalid" name=requiredValidation><small class=text-danger>{{\'rsmNamePartField.RequiredValidation\' | translate}}</small></span><div class=form-group ng-if=!loggedIn><p class=form-control-static>{{part.value}}</p></div></div></div>')}]),angular.module("scripts/person/directives/placeField/templates/placeField.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/person/directives/placeField/templates/placeField.tpl.html",'<div ng-if="!hide && (loggedIn || (!loggedIn && place))" class="panel panel-default"><div class=panel-heading><h4 class=panel-title><span name=placeTitle>{{label | translate}}</span> <small class=text-muted ng-if=optional name=placeTitleOptional>({{\'rsmPlaceField.Optional\' | translate}})</small><div class=pull-right ng-click=showPlace() ng-if="loggedIn && !show && !place.lat"><small class=text-muted><span class="glyphicon glyphicon-plus" name=showPlace></span></small></div></h4></div><div class=panel-body><div class=input-group ng-show="loggedIn && !place.lat && show"><input class=form-control lang={{language}} name=place ng-keydown=preventSubmission($event)> <span class=input-group-btn><button type=button class="btn btn-default" ng-click=removePlace()><span class="glyphicon glyphicon-remove-circle" name=removePlace></span></button></span> <span class=help-block data-ng-show=FactForm.place.$invalid><small name=placeValidation>{{\'rsmPlaceField.PlaceValidation\' | translate}}</small></span></div><div ng-if=place.lat><div class=form-group><p class=form-control-static><span name=selectedPlace>{{place.names | defaultLangName | fieldValue:\'value\'}}</span> <span class="pull-right glyphicon glyphicon-pencil" ng-click=removePlace(true) ng-if=loggedIn></span></p></div></div></div></div>')}]),angular.module("scripts/person/directives/relationshipTypeField/templates/relationshipTypeField.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/person/directives/relationshipTypeField/templates/relationshipTypeField.tpl.html",'<div class=form-group><div ng-if=!editable><p class=form-control-static><span name=relationshipType>{{relationship.subType | valueName:\'detailedRelationshipTypes\' | translate}}</span> <a ng-click=edit() ng-if=loggedIn><small><span class="pull-right glyphicon glyphicon-pencil" name=editRelationshipType></span></small></a></p></div><div ng-if=editable><label for=relationshipType class=sr-only>{{\'rsmRelationshipTypeField.RelationshipType\' | translate}}</label><div class=input-group>{{}}<select class=form-control name=type ng-options="type.value as translate(type.name) group by translate(type.category) for type in detailedRelationshipTypes | filter:{ relType: \'couple\'}" ng-model=relationship.subType ng-change=updateType()></select><span class=input-group-btn><button type=button class="btn btn-default" ng-click=cancelEdit() name=cancelEditRelationshipType><span class="glyphicon glyphicon-remove-circle"></span></button></span></div><hr></div></div>')}]),angular.module("scripts/person/directives/textField/templates/textField.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/person/directives/textField/templates/textField.tpl.html",'<div ng-if="!hide && (loggedIn || (!loggedIn && values.length > 0))"><div class="panel panel-default"><div class=panel-heading><h4 class=panel-title><span name=valueTitle>{{label | translate}}</span><div class=pull-right ng-click=addValue() ng-if=loggedIn><small class=text-muted><span class="glyphicon glyphicon-plus" name=addValue></span></small></div></h4></div><div class=panel-body><div ng-repeat="value in values"><div class=form-group ng-if=loggedIn><div class=input-group><input class=form-control name=value data-ng-model=value.value> <span class=input-group-btn><button type=button class="btn btn-default" ng-click=removeValue(value._tempId) name=removeField><span class="glyphicon glyphicon-remove-circle"></span></button></span></div><div ng-if=!value.showLanguage><p><small><span name=languageLabel>{{\'rsmTextField.Language\' | translate}}</span>: <a ng-click=toggleValueLanguage($index) name=showLanguage>{{value.lang | langName | translate}}</a></small></p></div><div class=input-group ng-if=value.showLanguage><span class=input-group-addon name=languageLabel>{{\'rsmTextField.Language\' | translate}}</span><select class=form-control ng-options="lang.code as lang.name for lang in languages | languageExists:values:value.lang" ng-model=value.lang name=lang></select></div><span class=help-block data-ng-show=FactForm.$error.uniqueValueLang name=languageValidation><small>{{\'rsmTextField.ValueValidation\' | translate}}</small></span></div><div ng-if=!loggedIn class=form-group><p><span name=staticValue>{{value.value}}</span><br><small name=languageLabel>({{value.lang | langName | translate}})</small></p></div></div></div></div></div>')}]),angular.module("scripts/person/templates/abstract.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/person/templates/abstract.tpl.html","<div ui-view autoscroll=false></div>")}]),angular.module("scripts/person/templates/factForm.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/person/templates/factForm.tpl.html",'<div class=card><div><h4><a class="glyphicon glyphicon-arrow-left backArrow" ng-if="!$state.includes(\'relationship.fact\')" ui-sref=person.show.facts></a> <a class="glyphicon glyphicon-arrow-left backArrow" ng-if="$state.includes(\'relationship.fact\')" ui-sref=person.show.relationships></a> <span name=factFormTitle>{{content.title}}</span></h4><div ng-if="$state.includes(\'relationship.fact.show\')"><a ui-sref="person.show({personId: relationship.person._id})" name=relatedPerson>{{relationship.person.primaryName.nameWithDates}}</a><br><span name=relatedPersonFact>{{relationship.relationship.facts[0].value.value | valueName:\'detailedRelationshipTypes\' | translate}}</span></div></div><hr><div class=col-xs-12><form role=form name=FactForm ng-submit=submit(FactForm)><div ng-if=edit.fields.type><div class=form-group><label class=control-label for=type>{{\'Fact.FactCtrl.Type\' | translate}}</label><select class=form-control ng-options="type.value as translate(type.name) group by translate(type.category) for type in factTypes | availableFactTypes:factGroup" ng-model=fact.type name=type ng-change=setType()></select></div></div><div ng-if="fact.type && !FactForm.type.$invalid"><rsm-date-field logged-in={{edit.loggedIn}} show={{factType.showDate}} ng-model=fact.date hide={{hide.date}}></rsm-date-field><span ng-if=FactForm.date.$error.date>{{\'Fact.Error.DataRequired\' | translate}}</span> <rsm-text-field logged-in={{edit.loggedIn}} show={{factType.showValue}} values=fact.values hide={{hide.text}} label={{factType.valueName}}></rsm-text-field><rsm-place-field logged-in={{edit.loggedIn}} show={{factType.showPlace}} ng-model=fact.place hide={{hide.place}}></rsm-place-field><button class="btn btn-primary" type=submit ng-if="edit.loggedIn && (!(hide.date && hide.place && hide.text))" ng-disabled=submitted name=submitFact>{{\'Fact.FactCtrl.Submit\' | translate}}</button> <a class="text-muted hand" ng-click=remove() ng-if=canRemove()><small>{{\'Fact.FactCtrl.Remove\' | translate}}</small></a> </div></form></div></div>')}]),angular.module("scripts/person/templates/nameForm.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/person/templates/nameForm.tpl.html",'<div class=card><div><h4><a class="glyphicon glyphicon-arrow-left backArrow" ui-sref=person.show.edit></a> <span name=nameFormTitle>{{content.title | translate}}</span></h4><ul class="nav nav-pills" id=nameFormTabs ng-if=edit.fields.showLanguageTabs><li ng-repeat="nF in name.nameForms | orderBy:\'lang\'" ng-class="{active: nF._id=== nameForm._id}"><a ui-sref="name.show({nameFormId: nF._id})">{{nF.lang | langName | translate}}</a></li><li ng-repeat-end><a class=text-muted ui-sref="name.createNameForm({nameId: name._id})" ng-if=edit.loggedIn name=createNameForm><small><span class="glyphicon glyphicon-plus"></span></small></a></li></ul><div class=form-group ng-if="edit.loggedIn && edit.fields.showLanguageField"><label class="control-label sr-only" for=lang>{{\'Person.PersonEditCtrl.Language\' | translate}}</label><select class=form-control ng-options="lang.code as lang.name for lang in languages" ng-model=nameForm.lang name=lang></select></div><div class=form-group ng-if="(!edit.loggedIn && !edit.fields.showLanguageTabs) || edit.fields.showLanguageValue"><label class="control-label col-sm-4" for=staticLanguage>{{\'Person.PersonEditCtrl.Language\' | translate}}</label><div class=col-sm-8><p class=form-control-static><a ng-click=toggleShowLanguageField() ng-if="edit.loggedIn && edit.fields.showLanguageValue">{{nameForm.lang | langName | translate}}</a></p></div></div></div><hr><div class=col-xs-12><form role=form name=NameForm ng-submit=submit(NameForm)><div class=form-group ng-if=edit.fields.type><label class=control-label for=type>{{\'Name.NameCtrl.Type\' | translate}}</label><select class=form-control ng-options="type.value as translate(type.name) for type in nameTypes | availableNameTypes:person.names" ng-model=name.type name=type ng-change=setType()></select></div><div ng-if=name.type><rsm-full-text-field logged-in={{edit.loggedIn}} name-form=nameForm></rsm-full-text-field><rsm-name-part-field label="{{\'Name.NameCtrl.TitleDescription\' | translate}}" optional=true logged-in={{edit.loggedIn}} name=prefix ng-model=nameForm.nameParts name-parts={{nameForm.nameParts}} qualifiers="{{qualifiers | inArray:\'partType\':\'prefix\'}}"></rsm-name-part-field><rsm-name-part-field label="{{\'Name.NameCtrl.GivenName\' | translate}}" mandatory=true logged-in={{edit.loggedIn}} name=given ng-model=nameForm.nameParts name-parts={{nameForm.nameParts}} qualifiers="{{qualifiers | inArray:\'partType\':\'given\'}}"></rsm-name-part-field><rsm-name-part-field label="{{\'Name.NameCtrl.MiddleName\' | translate}}" optional=true logged-in={{edit.loggedIn}} name=middle ng-model=nameForm.nameParts name-parts={{nameForm.nameParts}} qualifiers="{{qualifiers | inArray:\'partType\':\'middle\'}}"></rsm-name-part-field><rsm-name-part-field label="{{\'Name.NameCtrl.Surname\' | translate}}" mandatory=true logged-in={{edit.loggedIn}} name=surname ng-model=nameForm.nameParts name-parts={{nameForm.nameParts}} qualifiers="{{qualifiers | inArray:\'partType\':\'surname\'}}"></rsm-name-part-field><rsm-name-part-field label="{{\'Name.NameCtrl.Maiden\' | translate}}" optional=true logged-in={{edit.loggedIn}} name=maiden unique=true ng-model=nameForm.nameParts name-parts={{nameForm.nameParts}} qualifiers="{{qualifiers | inArray:\'partType\':\'maiden\'}}"></rsm-name-part-field><rsm-name-part-field label="{{\'Name.NameCtrl.Suffix\' | translate}}" optional=true logged-in={{edit.loggedIn}} name=suffix ng-model=nameForm.nameParts name-parts={{nameForm.nameParts}} qualifiers="{{qualifiers | inArray:\'partType\':\'suffix\'}}"></rsm-name-part-field><div ng-if=edit.loggedIn><hr><button class="btn btn-primary" type=submit name=submitName ng-disabled=submitted>{{\'Name.NameCtrl.Submit\' | translate}}</button> <small ng-if="edit.loggedIn && nameForm.canRemove"><a class="text-muted hand" ng-click=remove()>{{\'Name.NameCtrl.Remove\' | translate}}</a></small></div></div></form></div></div>')}]),angular.module("scripts/person/templates/person.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/person/templates/person.tpl.html",'<div ui-view autoscroll=false class="personCard col-xs-8 col-sm-5 col-md-4 col-lg-3"></div>')}]),angular.module("scripts/person/templates/personEdit.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/person/templates/personEdit.tpl.html",'<div class=card><h4><a class="glyphicon glyphicon-arrow-left backArrow" ui-sref=person.show></a> <span class=icon-pencil></span> <span name=personEditTitle>{{\'Person.PersonEditCtrl.Title\' | translate}}</span> </h4><hr><div class=col-xs-12><label for=genders class=control-label>{{\'Person.PersonEditCtrl.Gender\' | translate}}</label></div><div class="radio col-xs-12"><label class="checkbox-inline col-xs-5" ng-repeat="g in genders" ng-if=edit.loggedIn><input type=radio ng-model=person.gender.gender ng-value=g.value ng-change=update()> {{g.name | translate}}</label><p class=form-control-static ng-if=!edit.loggedIn>{{ person.gender.gender | gender | translate}}</p></div><div class=col-xs-12><label for=living class=control-label>{{\'Person.PersonEditCtrl.Living\' | translate}}</label></div><div class="radio col-xs-12"><label class="checkbox-inline col-xs-5" ng-repeat="l in living" ng-if=edit.loggedIn><input type=radio ng-model=person.living ng-value=l.value ng-change=update()> {{l.name | translate}}</label><p class=form-control-static ng-if=!edit.loggedIn>{{ person.living | living | translate}}</p></div><div class=col-xs-12><hr><h4><span class=icon-address-book></span> <span name=namesTitle>{{\'Person.PersonEditCtrl.Names\' | translate}}</span> <button class="btn btn-success btn-xs pull-right" ui-sref=name.create ng-if=edit.loggedIn><span class="glyphicon glyphicon-plus"></span></button></h4><hr><form role=form class=form-horizontal ng-if="edit.loggedIn && person.names.length > 1"><div class=form-group><label for=primaryName class="control-label col-sm-4">{{\'Person.PersonEditCtrl.KnownBy\' | translate}}</label><div class=col-sm-8><select name=primaryName class=form-control ng-options="name._id as name.displayName.displayName for name in person.names" ng-model=person._primaryNameId ng-change=updatePrimaryName()></select></div></div></form><div class=container-fluid><div class="row paddedRow" ng-repeat="name in person.names | nameOrder | orderBy:[\'order\', \'displayName.displayName\']"><label class="control-label col-sm-4" for=displayName>{{name.type | valueName:\'nameTypes\' | translate}}</label><div class=col-sm-8><p class=form-control-static><a ui-sref="name.show({nameId: name._id, nameFormId: name.nameForm._id})"><span class="pull-right glyphicon glyphicon-chevron-right"></span> <span name=displayName>{{name.displayName.displayName}}</span></a></p></div></div></div></div></div>')}]),angular.module("scripts/person/templates/personFacts.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/person/templates/personFacts.tpl.html",'<div class=card><h4><a class="glyphicon glyphicon-arrow-left backArrow" ui-sref=person.show></a> <span class=icon-profile></span> <span name=personFactsTitle>{{content.title}}</span> <button class="btn btn-success btn-xs pull-right" ui-sref=fact.create ng-if=edit.loggedIn><span class="glyphicon glyphicon-plus"></span></button></h4><hr><div class=container-fluid><div class="panel panel-default" ng-repeat="category in person.facts | factCategories"><div class=panel-heading><h3 class=panel-title>{{category | translate}}</h3></div><div class=panel-body><div class="row paddedRow" ng-repeat="fact in person.facts | filter:{category:category} | orderBy:[\'order\']"><label class="control-label col-sm-4" for=displayFact>{{fact.type | valueName:\'factTypes\' | translate}}</label><div class=col-sm-8><p class=form-control-static><a ui-sref="fact.show({factId: fact._id})"><span class="pull-right glyphicon glyphicon-chevron-right" name=showFact></span></a> <span ng-if=fact.value><span class="glyphicon glyphicon-edit"></span> <span name=factValue>{{fact.value.value}}</span><br></span> <span ng-if=fact.date><span class=icon-calendar></span> <span name=factDate>{{fact.date | dateFilter}}</span><br></span> <span ng-if=fact.place><span class="glyphicon glyphicon-map-marker"></span> <span name=factPlace>{{fact.place.name.value}}</span></span></p></div></div></div></div></div></div>')}]),angular.module("scripts/person/templates/personHistory.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/person/templates/personHistory.tpl.html",'<div class=card><h4><a class="glyphicon glyphicon-arrow-left backArrow" ui-sref=person.show></a> <span name=personHistoryTitle>{{\'Person.PersonHistoryCtrl.Title\' | translate}}</span></h4><hr><div class=container-fluid><div ng-repeat="record in history"><div class=col-xs-2><span class="icon-{{record | historyIcon}}"></span></div><div class=col-xs-10><p><small am-time-ago=record.timestamp></small></p><a ui-sref="profile.show({profileId: record.user._id})">{{record.user.firstName}} {{record.user.lastName}}</a> {{record | historyAction}}:  <span ng-if=record.name class=sentenceCase><a ui-sref="name.show({nameId: record.name._id, nameFormId: record.nameForm._id, projectId: record.projectId, personId: record.people[0]._id})" ng-if="record.action !== \'remove\'">{{record.name.type | valueName: \'nameTypes\' | translate}}: {{record.nameForm.fullText}} ({{record.nameForm.lang | langName | translate}})</a> <span ng-if="record.action === \'remove\'">{{record.name.type | valueName: \'nameTypes\' | translate}}: {{record.nameForm.fullText}} ({{record.nameForm.lang | langName | translate}})</span></span>  <span ng-if=record.fact><a ui-sref="fact.show({factId: record.fact._id, projectId: record.projectId, personId: record.people[0]._id})" ng-if="record.action !== \'remove\'">{{record.fact.type | valueName: \'factTypes\' | translate}}</a> <span ng-if="record.action === \'remove\'">{{record.fact.type | valueName: \'factTypes\' | translate}}</span></span>  <span ng-if="record.record !== \'History.Person\' && record.record !== \'History.Relationship\'">{{\'History.Actions.OnRecord\' | translate}}</span>  <span ng-if="record.people.length > 0"><span ng-if="record.people.length > 1"><a ui-sref="person.show({personId: record.people[1]._id, projectId: record.projectId})">{{record.people[1].nameForm.fullText}}</a> {{\'History.Actions.Is\' | translate}} <a ui-sref="person.show.relationships({personId: record.people[0]._id, projectId: record.projectId})">{{record.people[1].relType | translate}}</a> {{\'History.Actions.Of\' | translate}}</span> <a ui-sref="person.show({personId: record.people[0]._id, projectId: record.projectId})">{{record.people[0].nameForm.fullText}}</a></span>  <p ng-repeat="(key, value) in record.namePart" ng-if="record.type !== \'update\'" class=text-muted>{{key | translate}} <span ng-if=key>:</span> {{value}}</p><p ng-if="record.value && record.type !== \'update\'" class=text-muted>{{record.value[""]}} ({{record.value.lang | translate}})</p><p ng-repeat="valueRecord in record.values" ng-if="record.type !== \'update\'" class=text-muted>{{valueRecord[""]}} ({{valueRecord.lang | translate}})</p><p ng-repeat="placeRecord in record.place" ng-if="record.type !== \'update\'" class=text-muted>{{placeRecord[""]}} ({{placeRecord.lang | translate}})</p><p ng-if="record.date && record.type !== \'update\'" class=text-muted>{{record.date}}</p><p ng-repeat="(key, value) in record.updates" class="text-muted sentenceCase">{{key | translate}}<span ng-if=key>:</span> {{ value.oldValue | translate}} --> {{ value.newValue | translate}}</p><hr ng-if=!$last></div></div></div></div>')}]),angular.module("scripts/person/templates/personPaths.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/person/templates/personPaths.tpl.html",'<div class=card><h4><a class="glyphicon glyphicon-arrow-left backArrow" ui-sref=person.show></a> <span class=icon-flow-line></span> <span name=personPathTitle>{{\'Person.PersonPathCtrl.Title\' | translate}}</span></h4><hr><div class="col-xs-12 input-group pathSearch"><label for=existingPerson class=sr-only>{{\'Person.PersonPathCtrl.RelatedPerson\' | translate}}</label><input class=form-control ng-model=relatedPerson placeholder="{{\'Project.ProjectViewCtrl.TypeName\' | translate}}" typeahead="person as person.primaryName.nameWithDates for person in projectData.nodes | excludePerson:person._id | filter:$viewValue | limitTo: 8" typeahead-editable=false name=relatedPersonSearch typeahead-on-select=findPath(relatedPerson._id)> <span class=input-group-btn><button type=button class="btn btn-default" ng-if=relatedPerson ui-sref=person.show.path ng-click=removePath()><span class="glyphicon glyphicon-remove-circle"></span></button></span></div><span class=help-block ng-if=!path><small>{{\'Person.PersonPathCtrl.HelpText\' | translate}}</small></span> <div class=col-xs-12><p ng-if=noPath>{{\'Person.PersonPathCtrl.NoPath\' | translate}}</p><div ng-if=path><hr><h4>{{\'Person.PersonPathCtrl.Title\' | translate}}</h4><ol><li ng-repeat="link in path.links"><a ui-sref="person.show({personId: path.nodes[$index]._id})">{{path.nodes[$index].primaryName.nameWithDates}}</a> {{\'History.Actions.Is\' | translate}} {{link | relationshipName:path.nodes[$index + 1]:projectData}} {{\'History.Actions.Of\' | translate}} <a ui-sref="person.show({personId: path.nodes[$index + 1]._id})">{{path.nodes[$index +1].primaryName.nameWithDates}}</a></li></ol></div></div></div>')
}]),angular.module("scripts/person/templates/personRelationships.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/person/templates/personRelationships.tpl.html",'<div class=card><h4><a class="glyphicon glyphicon-arrow-left backArrow" ui-sref=person.show></a> <span class=icon-users></span> <span name=personRelationshipsTitle>{{\'Person.RelationshipCtrl.Relationships\' | translate}}</span>  <button class="btn btn-success btn-xs pull-right" ui-sref=relationship.create ng-if=edit.loggedIn><span class="glyphicon glyphicon-plus"></span></button></h4><hr><div class="panel panel-default" ng-if=relationships.parent><div class=panel-heading><h3 class=panel-title>{{\'Person.RelationshipCtrl.Parents\' | translate}}</h3></div><div class=panel-body><div ng-repeat="parent in relationships.parent"><p><a ui-sref="person.show({personId: parent.person._id})" name=relatedName>{{parent.person.primaryName.nameWithDates}}</a> <span class="pull-right glyphicon glyphicon-remove-circle" ng-if=edit.loggedIn ng-click="removeRelationship(\'parent\', parent.link)" name=removeRelationship></span></p><p ng-repeat="fact in parent.relationship.facts | orderBy:[\'valueOrder\', \'order\']"><span name=relationshipType>{{parent.person.gender | relationshipGender:\'parent\' | valueName:\'detailedRelationshipTypes\' | translate}}</span> <small name=factValue>({{fact.type | valueName:\'relationshipTypeQualifiers\' | translate}})</small></p><hr ng-show=!$last></div></div></div><div class="panel panel-default" ng-if=relationships.child><div class=panel-heading><h3 class=panel-title>{{\'Person.RelationshipCtrl.Children\' | translate}}</h3></div><div class=panel-body><div ng-repeat="child in relationships.child"><p><a ui-sref="person.show({personId: child.person._id})" name=relatedName>{{child.person.primaryName.nameWithDates}}</a> <span class="pull-right glyphicon glyphicon-remove-circle" ng-if=edit.loggedIn ng-click="removeRelationship(\'child\', child.link)" name=removeRelationship></span></p><p ng-repeat="fact in child.relationship.facts | orderBy:[\'valueOrder\', \'order\']"><span name=relationshipType>{{child.person.gender | relationshipGender:\'child\' | valueName:\'detailedRelationshipTypes\' | translate}}</span> <small name=factValue>({{fact.type | valueName:\'relationshipTypeQualifiers\' | translate}})</small></p><hr ng-show=!$last></div></div></div><div class="panel panel-default" ng-if=relationships.couple><div class=panel-heading><h3 class=panel-title>{{\'Person.RelationshipCtrl.Partners\' | translate}}</h3></div><div class=panel-body><div ng-repeat="couple in relationships.couple"><p><a ui-sref="person.show({personId: couple.person._id})" name=relatedName>{{couple.person.primaryName.nameWithDates}}</a> <span class="pull-right glyphicon glyphicon-remove-circle" ng-if=edit.loggedIn ng-click="removeRelationship(\'couple\', couple.link)" name=removeRelationship></span></p><rsm-relationship-type-field logged-in={{edit.loggedIn}} relationship=couple.relationship params={{edit.params}}></rsm-relationship-type-field><div ui-sref="relationship.fact.create({relationshipId: couple.relationship._id})" ng-if=edit.loggedIn name=createRelationshipFact><p class=hand><small class=text-muted><span class="glyphicon glyphicon-plus"></span>{{\'Person.RelationshipCtrl.RelationshipDetails\' | translate}}</small></p></div><p ng-repeat="fact in couple.relationship.facts | orderBy:[\'valueOrder\', \'order\']"><a ui-sref="relationship.fact.show({relationshipId: couple.relationship._id, factId: fact._id})"><span class="pull-right glyphicon glyphicon-chevron-right" name=showFact></span></a> <span name=factType>{{fact.type | valueName:\'factTypes\' | translate}}</span><br><small ng-if=fact.date><span class=icon-calendar></span> <span name=factDate>{{fact.date | dateFilter}}</span><br></small> <small ng-if=fact.value><span class="glyphicon glyphicon-edit"></span> <span name=factValue>{{fact.value.value}}</span><br></small> <small ng-if=fact.place><span class="glyphicon glyphicon-map-marker"></span> <span name=factPlace>{{fact.place.name.value}}</span></small></p><hr ng-show=!$last></div></div></div><div ng-if="(!relationships.parent || relationships.parent.length === 0) && (!relationships.child || relationships.child.length === 0) && (!relationships.couple || relationships.couple.length === 0)"><p name=noRelationships>{{\'Person.RelationshipCtrl.NoRelationships\' | translate}}</p><button class="btn btn-success" ui-sref=relationship.create name=noRelationshipsCreate>{{\'Person.RelationshipCtrl.CreateFirst\' | translate}}</button></div></div>')}]),angular.module("scripts/person/templates/personShow.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/person/templates/personShow.tpl.html",'<div class="card personTitle"><div class="row col-xs-12"><div class=col-xs-8><h4><a ui-sref=person.show>{{person.primaryName.displayName.displayName}}</a></h4><span name=personDates>{{person.dates}}</span><p><span name=personLiving>{{person.living | living | translate}}</span></p></div><div class="col-xs-4 noPadding"><img ng-src=./images/profile-{{person.gender.gender}}.png width=100 height=100 name=profileImage> </div></div><div class=col-xs-12 ng-if="invite.show && edit.loggedIn"><hr><form name=inviteForm ng-submit=inviteUser(inviteForm) class=form-inline><div class=form-group><label class=sr-only for=email>{{\'Person.PersonViewCtrl.Email\' | translate}}</label><input class="form-control input-large" name=email type=email ng-model=invite.email required placeholder="{{\'Person.PersonViewCtrl.Email\' | translate}}"> <span class=help-block ng-show="submitted && inviteForm.email.$invalid"><small class=text-danger name=emailValidation>{{\'Person.PersonViewCtrl.EmailValidation\' | translate}}</small></span> <small class=help-block><span name=emailHelpText>{{\'Relationship.CreateCtrl.EmailHelp\' | translate}}</span> {{person.primaryName.nameForm.nameParts | givenName}}.</small></div><button class="btn btn-primary pull-right" type=submit name=submitInvite>{{\'Person.PersonViewCtrl.Invite\' | translate}}</button></form></div><div class=col-xs-12><hr><div class="col-xs-2 text-center right-border"><a ui-sref=person.show.edit tooltip="{{\'Person.PersonViewCtrl.Edit\' | translate}}"><span class="at-icon icon-pencil"></span></a></div><div class="col-xs-2 text-center right-border"><a ui-sref=person.show.facts tooltip="{{\'Person.PersonViewCtrl.Facts\' | translate}}"><span class="at-icon icon-profile"></span></a></div><div class="col-xs-2 text-center right-border"><a ui-sref=person.show.relationships tooltip="{{\'Person.PersonViewCtrl.Relationships\' | translate}}"><span class="at-icon icon-users"></span></a></div><div class="col-xs-2 text-center right-border"><a ui-sref=person.show.images tooltip="{{\'Person.PersonViewCtrl.Images\' | translate}}"><span class="icon-images text-muted"></span></a></div><div class="col-xs-2 text-center right-border"><a ui-sref=person.show.sources tooltip="{{\'Person.PersonViewCtrl.Sources\' | translate}}"><span class="icon-cabinet text-muted"></span></a></div><div class="col-xs-2 text-center"><a ui-sref=person.show.tales tooltip="{{\'Person.PersonViewCtrl.Tales\' | translate}}"><span class="icon-bubble text-muted"></span></a></div></div></div><div class=personDetailsContainer><div ui-view autoscroll=false class=personDetails><div class=card><div class="col-xs-3 noPadding"><img src=./images/logoGreen.png width=75px height=80px></div><div class=col-xs-9><h4 class=text-muted name=explore>{{\'Person.PersonViewCtrl.Explore\' | translate}}</h4><p><a ui-sref=person.show.path><small><span class=icon-flow-line></span> {{\'Person.PersonViewCtrl.Connections\' | translate}}</small></a></p><p><a ui-sref=person.show.history><small><span class=icon-history></span> {{\'Person.PersonViewCtrl.ProfileChanges\' | translate}}</small></a></p></div></div></div></div>')}]),angular.module("scripts/person/templates/relationshipForm.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/person/templates/relationshipForm.tpl.html",'<div class=card><div><h4><a class="glyphicon glyphicon-arrow-left backArrow" ui-sref=person.show.relationships></a> <span name=RelationshipFormTitle>{{content.title}}</span></h4></div><hr><div class=col-xs-12><form role=form name=RelationshipForm ng-submit=submit(RelationshipForm)><div class=form-group ng-if=edit.fields.type><div><label class=sr-only for=type>{{\'Relationship.CreateCtrl.Type\' | translate}}</label><select class=form-control name=type ng-options="type.value as translate(type.name) group by translate(type.category) for type in detailedRelationshipTypes | availableRelationshipTypes:relationships.parent" ng-model=selected.type ng-change=onTypeChange()></select></div><div ng-if="selected.type && edit.fields.qualifier && edit.fields.showQualifier"><label class=sr-only for=qualifier>{{\'Relationship.CreateCtrl.Qualifier\' | translate}}</label><select class=form-control name=qualifier ng-options="qualifier.value as translate(qualifier.name) for qualifier in typeQualifiers" ng-model=selected.qualifier ng-change=onTypeQualifierChange()></select></div><div ng-if="selected.type && !edit.fields.qualifier && edit.fields.showQualifier"><p><span name=qualifier>{{\'Relationship.CreateCtrl.Qualifier\' | translate}}</span>: <a ng-click="edit.fields.qualifier = true" name=showQualifier>{{selected.qualifier | valueName:typeQualifiers | translate}}</a></p></div></div><div ng-if=selected.qualifier><ul class="nav nav-tabs"><li ng-class="{active: !edit.relatedPerson}" ng-click=edit.newPerson()><a>{{\'Relationship.CreateCtrl.NewPerson\' | translate}}</a></li><li ng-class="{active: edit.relatedPerson}" ng-click=edit.relatedPersonPrep() ng-if="projectData.nodes.length > 1"><a>{{\'Relationship.CreateCtrl.ExistingPerson\' | translate}}</a></li></ul><br><div ng-if=!edit.relatedPerson><div class=form-group><div class=form-inline id=name><div class="form-group col-xs-6 noPadding"><label class=sr-only for=firstName>{{\'Register.RegisterCtrl.FirstName\' | translate}}</label><input class="form-control input-large" name=firstName data-ng-model=relationship.person.names[0].nameForms[0].nameParts[0].value required placeholder="{{\'Register.RegisterCtrl.FirstName\' | translate}}"> <span class=help-block data-ng-show="submitted && RelationshipForm.firstName.$error.required"><small class=text-danger name=firstNameRequired>{{\'Register.RegisterCtrl.RequiredValidation\' | translate}}</small></span></div><div class="form-group col-xs-6 noPadding"><label class=sr-only for=lastName>{{\'Register.RegisterCtrl.LastName\' | translate}}</label><input class="form-control input-large" name=lastName data-ng-model=relationship.person.names[0].nameForms[0].nameParts[1].value required placeholder="{{\'Register.RegisterCtrl.LastName\' | translate}}"> <span class=help-block data-ng-show="submitted && RelationshipForm.lastName.$error.required"><small class=text-danger name=lastNameRequired>{{\'Register.RegisterCtrl.RequiredValidation\' | translate}}</small></span></div></div></div><div class=form-group ng-if="relationship.person.genders[0].gender === \'female\'"><div class=form-inline id=maidenName><div class="form-group col-xs-6 noPadding"><label for=maidenName class=sr-only>{{\'Name.NameCtrl.Maiden\' | translate}}</label></div><div class="form-group col-xs-6 noPadding"><input class=form-control name=maidenName data-ng-model=relationship.person.names[0].nameForms[0].nameParts[2].value placeholder="{{\'Name.NameCtrl.Maiden\' | translate}}"></div></div></div><hr><div class=form-group><label for=gender class=sr-only>{{\'Register.RegisterCtrl.Gender\' | translate}}</label><div class=radio><label class="checkbox-inline col-xs-5" ng-repeat="gender in genders"><input type=radio ng-model=relationship.person.genders[0].gender ng-value=gender.value name=gender required> {{gender.name | translate}}</label><span class=help-block data-ng-show="submitted && RelationshipForm.gender.$error.required"><small class=text-danger name=genderRequired>{{\'Register.RegisterCtrl.GenderValidation\' | translate}}</small></span></div></div><div class=form-group><label for=living class=sr-only>{{\'Relationship.CreateCtrl.Living\' | translate}}</label><div class=radio><label class="checkbox-inline col-xs-5"><input type=radio ng-model=relationship.person.living ng-value=true checked name=living> {{\'ReferenceData.LivingValues.Alive\' | translate}}</label><label class="checkbox-inline col-xs-5"><input type=radio ng-model=relationship.person.living ng-value=false name=deceased> {{\'ReferenceData.LivingValues.Deceased\' | translate}}</label></div></div><div class=form-group ng-if=dates.startDate><hr><h4 name=relationshipDetails>{{\'Relationship.CreateCtrl.RelationshipDetails\' | translate}}</h4><rsm-date-field logged-in=true optional=true label={{dates.startDateName}} ng-model=relationship.facts[0].date show=true></rsm-date-field></div><div class=form-group ng-if=dates.endDate><rsm-date-field logged-in=true optional=true label={{dates.endDateName}} ng-model=relationship.facts[1].date show=true></rsm-date-field></div><hr><h4 name=birthDetails>{{\'Relationship.CreateCtrl.BirthDetails\' | translate}}</h4><rsm-date-field logged-in=true label=Register.RegisterCtrl.DateOfBirth ng-model=relationship.person.facts[0].date optional=true show=true></rsm-date-field><rsm-place-field logged-in=true label=Relationship.CreateCtrl.BirthLocation ng-model=relationship.person.facts[0].place optional=true show=true></rsm-place-field><div ng-if=relationship.person.living><hr><h4 name=currentDetails>{{\'Relationship.CreateCtrl.CurrentDetails\' | translate}}</h4><div class=form-group><label class=sr-only for=email>{{\'Register.RegisterCtrl.Email\' | translate}} <small class=text-muted>({{\'Relationship.CreateCtrl.Optional\' | translate}})</small></label><input class="form-control input-large" name=email data-ng-model=relationship.person.email type=email placeholder="{{\'Register.RegisterCtrl.Email\' | translate}}"> <span class=help-block data-ng-show="submitted && RelationshipForm.email.$invalid"><small class=text-danger name=emailValidation>{{\'Register.RegisterCtrl.EmailValidation\' | translate}}</small></span> <small class=help-block><span name=emailHelpText>{{\'Relationship.CreateCtrl.EmailHelp\' | translate}}</span> {{relationship.person.names[0].nameForms[0].nameParts[0].value}}.</small></div><rsm-place-field logged-in=true label=Relationship.CreateCtrl.CurrentLocation ng-model=relationship.person.facts[1].place optional=true show=true></rsm-place-field></div><div ng-if=!relationship.person.living><hr><h4 name=deathDetails>{{\'Relationship.CreateCtrl.DeathDetails\' | translate}}</h4><rsm-date-field logged-in=true label=Relationship.CreateCtrl.DateofDeath ng-model=relationship.person.facts[2].date optional=true show=true></rsm-date-field><rsm-place-field logged-in=true label=Relationship.CreateCtrl.BurialLocation ng-model=relationship.person.facts[3].place optional=true show=true></rsm-place-field></div></div><div ng-if=edit.relatedPerson><div class=form-group><label for=existingPerson class=sr-only>{{\'Relationship.CreateCtrl.ExistingPerson\' | translate}}</label><input class=form-control ng-model=relationship.existingPerson placeholder="{{\'Project.ProjectViewCtrl.TypeName\' | translate}}" typeahead="person as person.primaryName.nameWithDates for person in projectData.nodes | excludePerson:person._id | filter:$viewValue | limitTo: 8" typeahead-editable=false name=relatedPersonSearch typeahead-on-select=edit.validateRelationships()></div><hr></div><button class="btn btn-primary" type=submit ng-disabled=submitted name=submitRelationship>{{\'Relationship.CreateCtrl.Submit\' | translate}}</button></div></form></div></div>')}]),angular.module("scripts/person/templates/relationshipPotentials.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/person/templates/relationshipPotentials.tpl.html",'<form role=form name=RelationshipPotentialValidationForm ng-submit=ok()><div class=modal-header><h3>{{\'Relationship.CreateCtrl.PotentialRelationships\' | translate}}</h3></div><div class=modal-body><div class="panel panel-default" ng-if=relationship.potentialParents.length><div class=panel-heading><span name=confirmParents>{{\'Relationship.CreateCtrl.Confirm\' | translate}} {{\'Relationship.CreateCtrl.ParentsOptionalPlural\' | translate}}</span></div><div class=panel-body><div ng-repeat="parent in relationship.potentialParents"><span class="col-xs-10 noPadding" name=relatedName>{{parent.person.primaryName.nameWithDates}}</span><div class=col-xs-2><span class="pull-right glyphicon glyphicon-remove-circle" ng-click="removeRelated(parent.person._id, \'potentialParents\')" name=removeRelationship></span></div><select class=form-control name=qualifier ng-options="qualifier.value as translate(qualifier.name) for qualifier in parent.relationship.subType | inArrayValue:\'relationshipTypeQualifiers\':\'relTypes\'" ng-model=parent.factType required></select><br></div></div></div><div class="panel panel-default" ng-if=relationship.potentialChildren.length><div class=panel-heading><span name=confirmChildren>{{\'Relationship.CreateCtrl.Confirm\' | translate}} {{\'Person.RelationshipCtrl.Children\' | translate}}</span></div><div class=panel-body><div ng-repeat="children in relationship.potentialChildren"><span class="col-xs-10 noPadding" name=relatedName>{{children.person.primaryName.nameWithDates}}</span><div class=col-xs-2><span class="pull-right glyphicon glyphicon-remove-circle" ng-click="removeRelated(children.person._id, \'potentialChildren\')" name=removeRelationship></span></div><select class=form-control name=qualifier ng-options="qualifier.value as translate(qualifier.name) for qualifier in children.relationship.subType | inArrayValue:\'relationshipTypeQualifiers\':\'relTypes\'" ng-model=children.factType required></select><br></div></div></div><div class="panel panel-default" ng-if=relationship.potentialPartners.length><div class=panel-heading><span name=confirmPartners>{{\'Relationship.CreateCtrl.Confirm\' | translate}} {{\'Relationship.CreateCtrl.PartnersOptionalPlural\' | translate}}</span></div><div class=panel-body><div ng-repeat="partner in relationship.potentialPartners"><span class="col-xs-10 noPadding" name=relatedName>{{partner.person.primaryName.nameWithDates}}</span><div class=col-xs-2><span class="pull-right glyphicon glyphicon-remove-circle" ng-click="removeRelated(partner.person._id, \'potentialPartners\')" name=removeRelationship></span></div><select class=form-control name=type ng-options="type.value as translate(type.name) for type in detailedRelationshipTypes | byFieldName:\'relType\':\'couple\' " ng-model=partner.relationship.subType required ng-change=partnerTypeChange(partner)></select><select ng-if=partner.relationship.subType class=form-control name=qualifier ng-options="qualifier.value as translate(qualifier.name) for qualifier in partner.relationship.subType | inArrayValue:\'relationshipTypeQualifiers\':\'relTypes\'" ng-model=partner.factType required></select><br></div></div></div></div><div class=modal-footer><button class="btn btn-primary" type=submit name=submitRelationshipPotentials>OK</button> <a class="btn btn-warning" ng-click=cancel()>Cancel</a></div></form>')}]),angular.module("scripts/policies/templates/disputes.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/policies/templates/disputes.tpl.html","<p><strong>This section in a nutshell</strong>: Resolve disputes as soon as they arise. When two editors disagree over what to do with a record, they must talk things through politely and rationally.</p><p>Please remember that Ancestor's Tale is not about winning. In our unique Ancestor's Tale context, a dispute raises a couple of questions: \"What is to be done next? What is to be learned from this?\"</p><p>There are many methods on Ancestor's Tale for resolving disputes. Most methods are not formal processes and do not involve third-party intervention. Respond to all disputes or grievances, in the first instance, by approaching the editor or editors concerned and explaining which of their edits you object to and why you object. Use the record talk page to do so; be civil, polite, and always assume good faith.</p><ul><li>Document rationale when making changes</li><li>Discuss with other party</li><li>Request third opinion</li><li>Request mediation</li></ul><h3>Making Changes</h3><p>To help other editors understand the reasoning behind your edits add a section to the talk page that explains your rationale. Be prepared to justify your changes to other editors on the talk page. If you are reverted, continue to explain yourself; do not start an edit war.</p><h3>Discuss with the other party</h3><p>Talking to other parties is not a mere formality, but an integral part of documenting shared ancestors. Discussing heatedly or poorly  or not at all  will make other editors less sympathetic to your position, and prevent you from effectively using later stages in dispute resolution. Sustained discussion between the parties, even if not immediately successful, demonstrates your good faith and shows you are trying to reach a consensus. Try negotiating a truce or proposing a compromise through negotiation.</p><p>Do not continue edit warring; once sustained discussion begins, productively participating in it is a priority. Uninvolved editors who are subsequently invited into the dispute will be confused and alarmed if there are large numbers of reverts or edits made while discussion is ongoing.</p><p>Talk page discussion is a prerequisite to almost all of Ancestor's Tale's venues of higher dispute resolution. If you wish at any time to request a Third Opinion (3O), use the Dispute Resolution Noticeboard (DRN), or open a request for comment (RFC) or request for mediation (RFM), you will be expected to show there has been talk page discussion of the dispute. Actual discussion is needed; discussion conducted entirely through edit summaries is inadequate. Focus on content Further information: Ancestor's Tale:Editing policy Shortcut: WP:FOC Focus on article content during discussions, not on editor conduct; comment on content, not the contributor. Ancestor's Tale is written through collaboration, and assuming that the efforts of others are in good faith is therefore vital. Bringing up conduct during discussions about content creates a distraction to the discussion and may inflame the situation. Focussing on content, and not bringing up conduct, can be difficult if it seems other editors are being uncivil or stubborn. Stay cool! It is never to your benefit to respond in kind. When it becomes too difficult or exhausting to maintain a civil discussion based on content, you should seriously consider going to an appropriate dispute resolution venue detailed below; but at no juncture should you lose your temper. Ancestor's Tale is not like the rest of the internet: we expect editors to be polite and reasonable at all times. Disengage Policy shortcut: WP:DISENGAGE Most situations are not actually urgent; there are no deadlines on Ancestor's Tale. At all stages during discussion, consider whether you should take a break from the dispute. Taking a deep breath and sleeping on it often helps. You can always return to the discussion later, but at least you will return without an inflamed temper. Take a long-term view of the situation. You will probably be able to return and carry on editing an article when the previous problems no longer exist and the editor you were in dispute with might themselves move on. The disputed article will continue to evolve, other editors may become interested, and they will have different perspectives if the issue comes up again. Even if your position on the article is not accepted, it might be in the future. Disengaging is particularly helpful when in dispute with new users, as it gives them a chance to familiarise themselves with Ancestor's Tale's policies and culture. There are 4,532,020 articles on Ancestor's Tale. Focus your contributions on another article, where you can more easily make constructive edits. Resolving content disputes with outside help Policy shortcut: WP:CONTENTDISPUTE Further information: Ancestor's Tale:Requesting dispute resolution Moderated discussion The Dispute resolution noticeboard (DRN) is place where editors involved in a content dispute can have a moderated discussion in an attempt to find compromise and resolution. DRN moderators are experienced Ancestor's Tale volunteers who sometimes refer dispute participants to more appropriate dispute resolution venue(s). Third opinion Third opinions is an excellent venue for small disputes involving only two editors. Request community input on article content Request for comment (RfC) is a process to request community-wide input on article content. RfCs can be used when there is a content-related dispute, or simply to get input from other editors before making a change. To solicit responses from a large number of editors, RfCs can be publicized via noticeboards or relevant WikiProject talk pages. An RfC bot will also automatically notify the feedback request service pool of editors. RfC discussions related to article content take place on article Talk pages. Noticeboards Policy shortcut: WP:SEEKHELP If your dispute is related to the application of a specific policy or guideline, you may wish to post in one of these noticeboards (below) to get input from uninvolved editors familiar with that topic. Neutrality noticeboard  to raise questions and alerts about the neutrality of an article Reliable Sources noticeboard  for discussion of whether or not a source is reliable No Original Research noticeboard  to raise questions and alerts about material that might be original research or source synthesis Biographies of Living Persons noticeboard  to raise questions and alerts about violations of our biography articles. Fringe theories noticeboard  to report theories that are given undue weight in articles Conflict of Interest (COI) noticeboard  to raise questions and alerts about possible conflicts of interest External links noticeboard  to raise questions and alerts about external links For general content disputes: Dispute resolution noticeboard  A noticeboard dedicated to moderated discussion between participants involved in a general content dispute. Subject-specific help Ask at a subject-specific Ancestor's Tale:WikiProject talk page. Usually, such projects are listed on top of the article talk page. Editor assistance Editor assistance helps editors find someone experienced to provide one-on-one advice and feedback. While not a required part of dispute resolution, it is designed to help you understand how to clearly and civilly express your views and work toward consensus. You may request an assistant's help at any time, whether you're involved in dispute resolution or not. Assistants can also help you find the best way to resolve your dispute or issue. Formal mediation For more difficult disputes, you can request formal mediation from the Mediation Committee. Mediation is a voluntary process in which a neutral person works with the parties and helps them reach a settlement. The mediator helps guide the parties into reaching an agreement that can be acceptable to everyone, and will be an experienced, impartial member of the committee. When requesting formal mediation, be prepared to show that you have tried to discuss the issues but not reached a consensus. Mediation is only for disputes about article content; do not try to use formal mediation to settle grievances about what another user said or did to you. See Ancestor's Tale:Requests for mediation#File if you wish to request formal mediation. Resolving user conduct disputes Policy shortcut: WP:CONDUCTDISPUTE The difference between a conduct and a content dispute is that, in a conduct dispute, the actions of a user (such as how an editor edits or the comments the editor makes about other users) is the overriding issue. If there would be no substantive dispute if the editor was not behaving in a disruptive or unprofessional way, then it is a conduct dispute; if the primary issue is that two editors cannot agree on what the content of an article should be, then it is a content dispute. If the problem is with the editor's conduct, not their position on some matter of article content, then one of the following methods are the solution: Requests for comment on user conduct (RFCU) is the main venue for resolving disputes about user conduct. Requests for comment on user conduct have minimum requirements that need to be satisfied: at least two users must have tried (and failed) to resolve the problem with the user on the user's talk page. Only use RFCU for long-running problems, not isolated instances of misconduct or suboptimal behaviour by another editor. Ask an administrator to evaluate the conduct of the user. You can ask for an administrator's attention at a noticeboard such as the administrators' noticeboard for incidents (ANI). Conduct complaints that fall into certain sub-categories of misconduct have their own administrators' noticeboard; for example, complaints about edit warring must be made at the edit warring noticeboard and not to ANI. Administrators have wide latitude to use their permissions to stop misconduct and damage to the encyclopedia; for example, an editor who is making personal attacks, and does not stop when you ask them, may be warned by an administrator and subsequently blocked. Sockpuppet investigations is for evaluating concerns that two users may be sockpuppets (editors who are operating two accounts pretending to be different people, or blocked editors returning under a different account). Requests for comment on usernames and usernames for administrator attention (UAA) are the main methods of bringing attention to usernames which may be inappropriate. In all cases, and even in the face of serious misconduct, please try to act in a professional and polite manner. Turn the other cheek. Sensitive issues and functionary actions See also: Ancestor's Tale:Arbitration Committee, Ancestor's Tale:CheckUser, Ancestor's Tale:Oversight, Ancestor's Tale:Harassment and Ancestor's Tale:Volunteer Response Team A small number of user conduct grievances involve sensitive or non-public information. These include issues where an arbitrator, checkuser, or oversighter has stated a privacy issue exists in the case, and disputes where there is a concern of a sensitive or private nature. For example: Non-public details: Grievances where the relevant information and evidence are not accessible to all participants or to the community as a whole. This can also happen due to copyright or privacy reasons, BLP, or when the material is on an unsuitable external link. \"Outing\" concerns: When discussion may in effect mean \"outing\", for example if there is a concern that a user is editing with a secret conflict of interest and the evidence would tend to identify them. Serious matters: The issue involves legal concerns, harassment, or allegations that are very serious or perhaps defamatory. Advice on divisive and sensitive issues: The issue may potentially be very divisive and advice is needed on how best to handle it (socking by an administrator is one example). Disputes or issues of this kind should usually be referred to the functionaries mailing list or Arbitration Committee. In some cases it may be possible to seek advice from an uninvolved trusted administrator by IRC, email or other private means. Where an action is marked as CheckUser, Oversight, OTRS or Arbitration Committee, that action should not be reverted without checking beforehand. The presumption is that they have a good reason, and those aware of the reason may need time to recheck, consult, and respond. Sometimes the relevant talk page or other wiki pages will have more details and these are always a good first place to check. Such actions, if disputed, should initially be raised (by email if necessary) with the agent or functionary concerned. Where a dispute about OTRS actions cannot be resolved in this manner, it should be referred to the OTRS administrators. Where a dispute about CheckUser and Oversighter actions cannot be resolved in this manner, it should be referred to the functionaries mailing list or the Audit Subcommittee where appropriate. Disputes about ArbCom actions should be referred to the Arbitration Committee. Last resort: Arbitration Further information: Ancestor's Tale:Arbitration Committee, Ancestor's Tale:Arbitration policy and Ancestor's Tale:Requests for arbitration See also: Ancestor's Tale:Arbitration guide If you have taken all other reasonable steps to resolve the dispute, and the dispute is not over the content of an article, you can request arbitration. Be prepared to show that you tried to resolve the dispute by other means. Arbitration differs from mediation in that the Arbitration Committee will consider the case and issue a decision, instead of merely assisting the parties in reaching an agreement. If the issue is decided by arbitration, you will be expected to abide by the result. If the case involves serious user misconduct, arbitration may result in a number of serious consequences up to totally banning someone from editing, as laid out in the arbitration policy. Note that arbitration is normally for disputes about user conduct, while mediation is normally for disputes about article content. For urgent situations Some situations can be sufficiently urgent or serious that dispute resolution steps are not equipped to resolve the issue. Such situations can be forwarded to the appropriate venue. To request or report: Go to: Permanent deletion of personal information Ancestor's Tale:Requests for oversight Unblocking (if you are blocked) See the Guide to appealing a block Vandalism of an article Ancestor's Tale:Administrator intervention against vandalism Blatantly inappropriate usernames, such as usernames that are obscene or inflammatory Ancestor's Tale:Usernames for administrator attention Suspected sockpuppetry Ancestor's Tale:Sockpuppet investigations Urgent violations of Ancestor's Tale's policies on Personal Attacks Ancestor's Tale:Administrators' noticeboard/Incidents Edit warring Ancestor's Tale:Administrators' noticeboard/3RR Other urgent problems with a user's edits Ancestor's Tale:Administrators' noticeboard The administrators' noticeboards (e.g. AN and ANI) are not the place to raise disputes over content or conduct. Reports that do not belong at these noticeboards will be closed, and discussions will need to be re-posted by you at an appropriate forum  such as the dispute resolution noticeboard (DRN). Words of caution Dispute resolution is sometimes used by editors to try to game the system. This generally backfires badly. Remember that dispute resolution mechanisms are ultimately there to enable editors to collaboratively write an encyclopedia  not to win personal or political battles.</p>")
}]),angular.module("scripts/policies/templates/guidelines.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/policies/templates/guidelines.tpl.html","<h2>Behavioural Guidelines</h2><ul><li>Assume good faith.</li><li>Don't bite the newbies. You were new once.</li><li>Treat others as you would have them treat you.</li><li>Be polite and civil.</li><li>Remember raw text can be ambiguous and seem ruder than said from a person in front of you.</li><li>Argue facts, not intuitions, taste or personalities.</li><li>If someone becomes less civil than you would like, be <em>more civil</em> to them, not less.</li><li>If you are arguing, take a break.</li><li>If you say something you regret, apologise.</li><li>Forgive and forget.</li><li>Remind yourself that these are people with whom you are dealing. They have feelings.</li></ul>")}]),angular.module("scripts/policies/templates/licensing.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/policies/templates/licensing.tpl.html","<h2>Licensing Policy</h2><div class=\"panel panel-primary\"><div class=panel-heading><h1 class=panel-title>Summary</h1></div><div class=panel-body><p class=text-primary><strong>You can share:</strong><ul><li>Content you created.</li><li>Content that the creator has provided permission for you to share.</li></ul></p><p class=text-primary><strong>You cannot share:</strong><ul><li>Content created by another person, where permission has not been provided. This includes:<ul><li>Images found on the internet</li><li>Articles found on the internet</li><li>Photos scanned which are not in the public domain</li></ul></li></ul></p><p class=text-primary><strong>If you identify copyrighted material:</strong><ul><li>Remove the material</li><li>Contact us at legal@ancestorstale.com for permanent removal</li></ul></p><p class=text-primary><strong>If you wish to contest a copyright takedown:</strong><ul><li>Contact us at legal@ancestorstale.com</li></ul></p></div></div><h3>Copyrighted Materials</h3><p>Never use materials that infringe the copyrights of others. This could create legal liabilities and seriously hurt the project.</p><p>One of the most important aspects of Ancestor's Tale is that its content (not media; but that will be discussed shortly) may be freely redistributed, reused and built upon by anyone, under the terms of the <a href=http://en.wikipedia.org/wiki/Wikipedia:Text_of_Creative_Commons_Attribution-ShareAlike_3.0_Unported_License target=_blank>Creative Commons Attribution-Sharealike 3.0 Unported License</a> (CC-BY-SA) and, except where otherwise noted, the <a href=http://en.wikipedia.org/wiki/Wikipedia:Text_of_the_GNU_Free_Documentation_License target=_blank>GNU Free Documentation License</a> (GFDL) (unversioned, with no invariant sections, front-cover texts, or back-cover texts). Contributors agree to release their original content under both licenses when they submit it, and material from public domain sources or other compatibly licensed sources may also be used in accordance with the copyright policy, provided correct attribution is given.</p><p>However, copying material without the permission of the copyright holder from sources that are not public domain or compatibly licensed is likely to be a copyright violation. Even inserting text copied with some changes can be a copyright violation if there's substantial linguistic similarity in creative language or structure; this is known as close paraphrasing (which can also raise problems of plagiarism). Such a situation should be treated seriously, as copyright violations not only harm Ancestor's Tale's redistributability, but also create legal issues.</p><p>The situation for images and other media is slightly different, as a wider variety of licenses is accepted. But, in short, media which is not available under a suitable free license should be assumed to be unacceptable.</p><p>Uploading an image file, audio or video file, or text quotation into Ancestor's Tale, and adding that file to a record, both raise copyright concerns. Editors who do either must make sure their contributions are legal. If there is any doubt as to legality, ask others for help, try to find a free equivalent, or use your own words to make the same point. Also, consider asking the copyright holder to release the work under an appropriate <a href=http://en.wikipedia.org/wiki/Wikipedia:Text_of_Creative_Commons_Attribution-ShareAlike_3.0_Unported_License target=_blank>Creative Commons Attribution-Sharealike 3.0 Unported License</a> (CC-BY-SA) or a CC-BY-SA-compatible license (dual-licensing under a GFDL license is also possible).</p><p>If a work has no copyright or is licensed to Ancestor's Tale under an acceptable \"free\" license, it is a free work and may be used on Ancestor's Tale without copyright concerns. See <a href=http://en.wikipedia.org/wiki/Public_domain target=_blank>public domain</a>, <a href=http://en.wikipedia.org/wiki/Copyright target=_blank>copyright</a>, and <a href=http://www.copyright.cornell.edu/training/Hirtle_Public_Domain.htm target=_blank>Cornell University's guide to copyright terms</a> for discussion of works that are not covered by copyright.</p><p>If a work is not free it cannot be used on or uploaded to Ancestor's Tale.</p><h3>Linking to Copyrighted Materials</h3><p>Most recently-created works are copyrighted. It is not necessary to obtain the permission of a copyright holder before linking to copyrighted material, just as an author of a book does not need permission to cite someone else's work in their bibliography. However, if you know or reasonably suspect that an external Web site is carrying a work in violation of the creator's copyright, do not link to that copy of the work.</p><p>Context is also important; it may be acceptable to link to a reputable website's article, even if it presents an image which may be copyrighted (such uses are generally either explicitly permitted by creators or allowed under fair use). However, linking directly to the image removes the context and the site's justification for permitted use or fair use.</p><h3>Copyright violations</h3><p>Contributors who repeatedly post copyrighted material despite appropriate warnings may be blocked from editing by any administrator to prevent further problems.</p><p>If you suspect a copyright violation, you should at least bring up the issue on that record's discussion page. Others can then examine the situation and take action if needed. Some cases will be false alarms.</p><h3>Guidelines for images and other media files</h3><p>Images, photographs, video and sound files, like written works, are subject to copyright. Someone holds the copyright unless they have explicitly been placed in the public domain. Images, video and sound files on the internet need to be licensed directly from the copyright holder or someone able to license on their behalf.</p><h3>If you are the owner of Ancestor's Tale-hosted content being used without your permission</h3><p>If you are the owner of content that is being used on Ancestor's Tale without your permission, then you may request the content be permanently removed from Ancestor's Tale by emailing legal@ancestorstale.com (it may take up to a week for the material to be deleted). We will, of course, need some evidence to support your claim of ownership.</p>")}]),angular.module("scripts/policies/templates/policies.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/policies/templates/policies.tpl.html",'<div class="container withHeader"><div class=row><div class="col-xs-12 col-sm-3 col-md-3 col-lg-3" data-ng-include data-src="\'scripts/policies/templates/policiesMenu.tpl.html\'"></div><div class="col-xs-12 col-sm-8 col-md-8 col-lg-9" ui-view autoscroll=false></div></div></div>')}]),angular.module("scripts/policies/templates/policiesMenu.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/policies/templates/policiesMenu.tpl.html","<div id=account-nav class=menuHeader><ul class=\"nav nav-pills nav-stacked\"><li><a ui-sref=policies.terms>{{'Policies.PoliciesCtrl.Terms' | translate}}</a></li><li><a ui-sref=policies.privacy>{{'Policies.PoliciesCtrl.Privacy' | translate}}</a></li><li><a ui-sref=policies.licensing>{{'Policies.PoliciesCtrl.Licensing' | translate}}</a></li><li><a ui-sref=policies.guidelines>{{'Policies.PoliciesCtrl.Guidelines' | translate}}</a></li></ul></div>")}]),angular.module("scripts/policies/templates/privacy.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/policies/templates/privacy.tpl.html","<h2>Privacy Policy</h2><div class=\"panel panel-primary\"><div class=panel-heading><h1 class=panel-title>Summary</h1></div><div class=panel-body><p class=text-primary><strong>You don't need to register to:</strong><ul><li>View any family tree on the site.</li></ul></p><p class=text-primary><strong>We require you to register to:</strong><ul><li>Create and edit any record details, relationships or tale information.</li><li>Upload any media content.</li></ul></p><p class=text-primary><strong>We are committed to:</strong><ul><li>Describing how your information may be used or shared in this Privacy Policy.</li><li>Using reasonable measures to keep your information secure.</li></ul></p><p class=text-primary><strong>Be aware:</strong><ul><li>Any content you add or any change you make will be publicly and permanently available.</li></ul></p></div><div class=panel-footer><small>Disclaimer: This summary is not a part of the Privay Policy and is not a legal document. It is simply a handy reference for understanding the full terms. Think of it as the user-friendly interface to the legal language of our Privacy Policy.</small></div></div><h3>Our Privacy Policy explains:</h3><ul><li>What information we collect and why we collect it.</li><li>How we use that information.</li><li>The choices we offer, including how to access and update information.</li></ul><p>Weve tried to keep it as simple as possible, but if youre not familiar with terms like cookies, IP addresses and browsers, then read about these key terms first. Your privacy matters to us so please do take the time to get to know our practices</p><h3>Information we collect</h3><p>We collect information to provide better services to all of our users  from figuring out basic stuff like which language you speak, showing users your contributions and enabling us to provide you with a better user experience.</p><p>We collect information in two ways:</p><ul><li>Information you give us. For example, when you register an account. When you do, well ask for personal information, like your name, email address, photo, telephone number or credit card.</li><li>Information we get from your use of our website. We may collect information about when you visit the website or you view and interact with our content. This information includes:<ul><li>Device information<p>We may collect device-specific information (such as your hardware model, operating system version, unique device identifiers, and mobile network information including phone number). Ancestor's Tale may associate your device identifiers or phone number with your account.</p></li><li>Log information<p>When you use our services or view content provided by Ancestor's Tale, we may automatically collect and store certain information in server logs. This may include:</p><ul><li>details of how you used our service, such as your records viewed.</li><li>Internet protocol address.</li><li>device event information such as crashes, system activity, hardware settings, browser type, browser language, the date and time of your request and referral URL.</li><li>cookies that may uniquely identify your browser or your account.</li></ul></li><li>Local storage<p>We may collect and store information (including personal information) locally on your device using mechanisms such as browser web storage (including HTML 5) and application data caches.</p></li><li>Cookies and anonymous identifiers<p>We and our partners use various technologies to collect and store information when you visit our website, and this may include sending one or more cookies or anonymous identifiers to your device.</p></li></ul></li></ul><h3>How we use information we collect</h3><p>We use the information we collect from our service to provide, maintain, protect and improve it, to develop new features, and to protect Ancestor's Tale and our users.</p><p>When you contact Ancestor's Tale, we may keep a record of your communication to help solve any issues you might be facing. We may use your email address to inform you about our services, such as letting you know about upcoming changes or improvements.</p><p>We use information collected from cookies and other technologies, like pixel tags, to improve your user experience and the overall quality of our service. For example, by saving your language preferences, well be able to have our service appear in the language you prefer.</p><p>We will ask for your consent before using information for a purpose other than those that are set out in this Privacy Policy.</p><p>Ancestor's Tale processes personal information on our servers in many countries around the world. We may process your personal information on a server located outside the country where you live.</p><h3>Information you share</h3><p>Ancestor's Tale was primarily created to help you share your knowledge with the world, and we share your contributions because you have asked us to do so.</p><p>When you make a contribution to the site, including on discussion pages, you are creating a permanent, public record of every piece of content added, removed, or altered by you. The page history will show when your contribution or deletion was made, as well as your username.</p><p>Remember that when you share information publicly, it may be indexable by search engines.</p><h3>Accessing and updating your personal information</h3><p>Whenever you use our service, we aim to provide you with access to your personal information. If that information is wrong, we strive to give you ways to update it quickly or to delete it  unless we have to keep that information for legitimate business or legal purposes. When updating your personal information, we may ask you to verify your identity before we can act on your request.</p><h3>Information we share</h3><p>We do not share personal information with companies, organizations and individuals outside of Ancestor's Tale unless one of the following circumstances applies:</p><ul><li>With your consent<p>We will share personal information with companies, organizations or individuals outside of Ancestor's Tale when we have your consent to do so. We require opt-in consent for the sharing of any sensitive personal information.</p></li><li>For external processing<p>We provide personal information to our affiliates or other trusted businesses or persons to process it for us, based on our instructions and in compliance with our Privacy Policy and any other appropriate confidentiality and security measures.</p></li><li>For legal reasons<p>We will share personal information with companies, organizations or individuals outside of Ancestor's Tale if we have a good-faith belief that access, use, preservation or disclosure of the information is reasonably necessary to:</p><ul><li>meet any applicable law, regulation, legal process or enforceable governmental request.</li><li>enforce applicable Terms of Service, including investigation of potential violations.</li><li>detect, prevent, or otherwise address fraud, security or technical issues.</li><li>protect against harm to the rights, property or safety of Ancestor's Tale, our users or the public as required or permitted by law.</li></ul></li></ul><p>We may share aggregated, non-personally identifiable information publicly and with our partners  like publishers, advertisers or connected sites. For example, we may share information publicly to show trends about the general use of our services.</p><p>If Ancestor's Tale is involved in a merger, acquisition or asset sale, we will continue to ensure the confidentiality of any personal information and give affected users notice before personal information is transferred or becomes subject to a different privacy policy.</p><h3>Information security</h3><p>We work hard to protect Ancestor's Tale and our users from unauthorized access to or unauthorized alteration, disclosure or destruction of information we hold.</p><h3>Compliance and cooperation with regulatory authorities</h3><p>We regularly review our compliance with our Privacy Policy. We also adhere to several self regulatory frameworks. We work with the appropriate regulatory authorities, including local data protection authorities, to resolve any complaints regarding the transfer of personal data that we cannot resolve with our users directly.</p><h3>Changes</h3><p>Our Privacy Policy may change from time to time. We will not reduce your rights under this Privacy Policy without your explicit consent. We will post any privacy policy changes on this page and, if the changes are significant, we will provide a more prominent notice (including, for certain services, email notification of privacy policy changes). We will also keep prior versions of this Privacy Policy in an archive for your review.</p>")}]),angular.module("scripts/policies/templates/terms.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/policies/templates/terms.tpl.html","<h2>Terms of Use</h2><div class=\"panel panel-primary\"><div class=panel-heading><h1 class=panel-title>Summary</h1></div><div class=panel-body><p class=text-primary><strong>Our Mission:</strong><ul><li><strong>Empower and Engage</strong> people around the world to document their portion of our collective human history.</li><li><strong>Disseminate</strong> this content globally, free of charge.</li></ul></p><p class=text-primary><strong>You are free to:</strong><ul><li><strong>Read and Print</strong> any family tree and other media free of charge.</li><li><strong>Share and Reuse</strong> any content under free and open licences.</li><li><strong>Contribute To and Edit</strong> any family tree.</li></ul></p><p class=text-primary><strong>Under the following conditions:</strong><ul><li><strong>Responsibility</strong> - You take responsibility for your edits (we only <em>host</em> your content).</li><li><strong>Civility</strong>  You support a civil environment and do not harass other users.</li><li><strong>Lawful Behaviour</strong>  You do not violate copyright or other laws.</li><li><strong>No Harm</strong>  You do not harm our technology infrastructure.</li><li><strong>Terms of Use</strong>  You adhere to the below Terms of Use when you visit or participate in our site.</li></ul></p><p class=text-primary><strong>With the understanding that:</strong><ul><li><strong>You License Freely Your Contributions</strong>  you must license your contributions and edits to our site under a free and open license (unless your contribution is in the public domain).</li><li><strong>No Professional Advice</strong>  the content of this site is for informational purposes only and does not constitute professional advice.</li></ul></p></div><div class=panel-footer><small>Disclaimer: This summary is not a part of the Terms of Use and is not a legal document. It is simply a handy reference for understanding the full terms. Think of it as the user-friendly interface to the legal language of our Terms of Use.</small></div></div><h2>Our Terms of Use</h2><p>Imagine a world in which every single human being can freely understand their place in human history. That's our commitment.</p><p>Welcome to Ancestor's Tale! Ancestor's Tale (we or us), is an organization whose mission is to empower and engage people around the world to collect and document human relationships under a free license or in the public domain, and to disseminate it effectively and globally, free of charge.</p><p>To support our vibrant community, we provide the essential infrastructure and organizational framework for the documentation of human relationships. We strive to make and keep the documented history of human relationships available on the internet free of charge, in perpetuity.</p><p>We welcome you (you or the user) as a reader, editor, author, or contributor to Ancestor's Tale, and we encourage you to join the Ancestor's Tale community. Before you participate, however, we ask that you please read and agree to the following Terms of Use (Terms of Use).</p><h2>Overview</h2><p>These Terms of Use tell you about our public services at Ancestor's Tale, our relationship to you as a user, and the rights and responsibilities that guide us both. We want you to know that we host an incredible quantity of educational and informational content, all of which is contributed and made possible by users like yourself. Generally we do not contribute, monitor, or delete content (with the rare exception of policies like these Terms of Use or legal compliance for DMCA notices). This means that editorial control is in the hands of you and your fellow users who create and manage the content. We merely host this content.</p><p>The community - the network of users who are constantly building and using the site - are the principal means through which the goals of the mission are achieved. The community contributes to and helps govern our site. The community undertakes the critical function of creating and enforcing policies.</p><p>You are welcome to join as a contributor, editor, or author, but you should follow the policies that govern the site. Because we are dedicated to making content freely accessible to the public, we require that all content you contribute is available under a free license or in the public domain.</p><p>Please be aware that you are legally responsible for all of your contributions, edits, and re-use of Ancestor's Tale content under the laws of the Republic of Ireland and other applicable laws (which may include the laws where you live or where you view or edit content). This means it is important that you use caution when posting content. In light of this responsibility, we have some rules about what you cannot post, most of which is either for your own protection or for the protection of other users like yourself. Please keep in mind that the content we host is for general informational purposes only, so if you need expert advice regarding family ancestry you should seek the help of a licensed or qualified professional. We also include other important notices and disclaimers, so please read these Terms of Use in their entirety.<ol><h3><li>Our Services</li></h3><p>Ancestor's Tale is dedicated to encouraging the growth, development and distribution of human relationship information, and to hosting the full content of this site for the public free of charge. Our role is to host the largest collaboratively edited ancestral resource in the world, which can be found here. However, we act only as a hosting service, maintaining the infrastructure and organizational framework that allows our users to build Ancestor's Tale by contributing and editing content themselves. Because of our unique role, there are a couple of things you should be aware of when considering our relationship to you, the site, and the other users:</p><ol style=\"list-style-type: lower-alpha\"><li><strong>We do not take an editorial role</strong>: Because Ancestor's Tale is collaboratively edited, all of the content that we host is provided by users like yourself, and we do not take an editorial role. This means that we generally do not monitor or edit the content of the site, and we do not take any responsibility for this content. Similarly, we do not endorse any opinions expressed via our services, and we do not represent or guarantee the truthfulness, accuracy, or reliability of any submitted community content. Instead, we simply provide access to the content that your fellow users have contributed and edited.</li><li><strong>You are responsible for your own actions</strong>: You are legally responsible for your edits and contributions on Ancestor's Tale, so for your own protection you should exercise caution and avoid contributing any content that may result in criminal or civil liability under any applicable laws. For clarity, applicable law includes at least the laws of the Republic of Ireland. Although we may not agree with such actions, we warn editors and contributors that authorities may seek to apply other country laws to you, including local laws where you live or where you view or edit content. WMF generally cannot offer any protection, guarantee, immunity or indemnification.</li></ol><h3><li>Privacy Policy</li></h3><p>We ask that you review the terms of our Privacy Policy, so that you are aware of how we collect and use your information. Because our services are used by people all over the world, personal information that we collect may be stored and processed in the Republic of Ireland or any other country in which we or our agents maintain facilities. By using our services, you consent to any such transfer of information outside your country.</p><h3><li>Content We Host</li></h3><p><strong>You may find some material objectionable or erroneous</strong>: Because we provide a wide array of content that is produced or gathered by fellow users, you may encounter material that you find offensive, erroneous, misleading, mislabeled, or otherwise objectionable. We therefore ask that you use common sense and proper judgment when using our services.</p><p><strong>Our content is for general informational purposes only</strong>: Although we host a great deal of human relationship information, this content is presented for general informational purposes only. It should not be taken as professional advice. Please seek independent professional counseling from someone who is licensed or qualified in the applicable area in lieu of acting on any information, opinion, or advice contained in the site.</p><h3><li>Refraining from Certain Activities</li></h3><p>Ancestor's Tale only exists because of the vibrant community of users like you who collaborate to write, edit, and curate the content. We happily welcome your participation in this community. We encourage you to be civil and polite in your interactions with others in the community, to act in good faith, and to make edits and contributions aimed at furthering the mission of the shared site.</p><p>Certain activities, whether legal or illegal, may be harmful to other users and violate our rules, and some activities may also subject you to liability. Therefore, for your own protection and for that of other users, you may not engage in such activities on our sites. These activities include:</p><p><strong>Harassing and Abusing Others</strong></p><ul><li>Engaging in harassment, threats, stalking, spamming, or vandalism; and</li><li>Transmitting chain mail, junk mail, or spam to other users.</li></ul><br><p><strong>Violating the Privacy of Others</strong></p><ul><li>Infringing the privacy rights of others under the laws of the Republic of Ireland or other applicable laws (which may include the laws where you live or where you view or edit content);</li><li>Soliciting personally identifiable information for purposes of harassment, exploitation, violation of privacy, or any promotional or commercial purpose not explicitly approved by Ancestor's Tale; and</li><li>Soliciting personally identifiable information from anyone under the age of 18 for an illegal purpose or violating any applicable law regarding the health or well-being of minors.</li></ul><br><p><strong>Engaging in False Statements, Impersonation, or Fraud</strong></p><ul><li>Intentionally or knowingly posting content that constitutes libel or defamation;</li><li>With the intent to deceive, posting content that is false or inaccurate;</li><li>Attempting to impersonate another user or individual, misrepresenting your affiliation with any individual or entity, or using the username of another user with the intent to deceive; and</li><li>Engaging in fraud.</li></ul><br><p><strong>Committing Infringement</strong></p><ul><li>Infringing copyrights, trademarks, patents, or other proprietary rights under applicable law.</li></ul><br><p><strong>Misusing Our Services for Other Illegal Purposes</strong></p><ul><li>Posting child pornography or any other content that violates applicable law concerning child pornography;</li><li>Posting or trafficking in obscene material that is unlawful under applicable law; and</li><li>Using the services in a manner that is inconsistent with applicable law.</li></ul><br><p><strong>Engaging in Disruptive and Illegal Misuse of Facilities</strong></p><ul><li>Posting or distributing content that contains any viruses, malware, worms, Trojan horses, malicious code, or other device that could harm our technical infrastructure or system or that of our users;</li><li>Engaging in automated uses of the site that are abusive or disruptive of the services and have not been approved by the Ancestor's Tale community;</li><li>Disrupting the services by placing an undue burden on the website or the networks or servers connected with the website;</li><li>Disrupting the services by inundating the website with communications or other traffic that suggests no serious intent to use the website for its stated purpose;</li><li>Knowingly accessing, tampering with, or using any of our non-public areas in our computer systems without authorization; and</li><li>Probing, scanning, or testing the vulnerability of any of our technical systems or networks unless all the following conditions are met:</li><ul><li>such actions do not unduly abuse or disrupt our technical systems or networks;</li><li>such actions are not for personal gain (except for credit for your work);</li><li>you report any vulnerabilities to Ancestor's Tale developers (or fix it yourself); and</li><li>you do not undertake such actions with malicious or destructive intent.</li></ul></ul><br><p>We reserve the right to exercise our enforcement discretion with respect to the above terms.</p><h3><li>Password Security</li></h3><p>You are responsible for safeguarding your own password and should never disclose it to any third party.</p><h3><li>Trademarks</li></h3><p>Although you have considerable freedoms for re-use of the content on the website, it is important that, at Ancestor's Tale, we protect our trademark rights so that we can protect our users from fraudulent impersonators. Because of this, we ask that you please respect our trademarks. All Ancestor's Tale trademarks belong to Ancestor's Tale, and any use of our trade names, trademarks, service marks, logos, or domain names must be in compliance with these Terms of Use and in compliance with our Trademark Policy.</p><h3><li>Licensing of Content</li></h3><p>To grow the commons of free knowledge, all users contributing to the website are required to grant broad permissions to the general public to re-distribute and re-use their contributions freely, so long as that use is properly attributed and the same freedom to re-use and re-distribute is granted to any derivative works. In keeping with our goal of providing free information to the widest possible audience, we require that when necessary all submitted content be licensed so that it is freely reusable by anyone who cares to access it.</p><p>You agree to the following licensing requirements:</p><ol style=\"list-style-type: lower-alpha\"><li><strong>Text to which you hold the copyright</strong>: When you submit text to which you hold the copyright, you agree to license it under:<ul><li><a href=\"http://creativecommons.org/licenses/by-sa/3.0/\" target=_blank>Creative Commons Attribution-ShareAlike 3.0 Unported License (CC BY-SA)</a>, and</li><li><a href=http://www.gnu.org/copyleft/fdl.html target=_blank>GNU Free Documentation License</a> (GFDL) (unversioned, with no invariant sections, front-cover texts, or back-cover texts).</li></ul><p>(Re-users may comply with either license or both.)</p><p>Please note that these licenses do allow commercial uses of your contributions, as long as such uses are compliant with the terms.</p></li><li><strong>Attribution</strong>: Attribution is an important part of these licenses. We consider it giving credit where credit is due  to authors like yourself. When you contribute text, you agree to be attributed in any of the following fashions:<ul><li>Through hyperlink (where possible) or URL to the relevant record to which you contributed (since each record has a history page that lists all authors and editors);</li><li>Through a list of all authors (but please note that any list of authors may be filtered to exclude very small or irrelevant contributions).</li></ul></li><li><strong>Importing text</strong>: You may import text that you have found elsewhere or that you have co-authored with others, but in such case you warrant that the text is available under terms that are compatible with the CC BY-SA 3.0 license. Content available only under GFDL is not permissible.<p>You agree that, if you import text under a CC BY-SA license that requires attribution, you must credit the author(s) in a reasonable fashion. The attribution requirements are sometimes too intrusive for particular circumstances (regardless of the license), and there may be instances where the Ancestor's Tale community decides that imported text cannot be used for that reason.</p></li><li><strong>Non-text media</strong>: Non-text media on the site are available under a variety of different licenses that support the general goal of allowing unrestricted re-use and re-distribution. When you contribute non-text media, you agree to comply with the requirements for such licenses as described in our Licensing Policy.</li><li><strong>No revocation of license</strong>: Except as consistent with your license, you agree that you will not unilaterally revoke or seek invalidation of any license that you have granted under these Terms of Use for text content or non-text media contributed to Ancestor's Tale, even if you terminate use of our services.</li><li><strong>Public domain content</strong>: Content that is in the public domain is welcome! It is important however that you confirm the public domain status of the content under the law of the Republic of Ireland as well as the laws of any other countries as required. When you contribute content that is in the public domain, you warrant that the material is actually in the public domain, and you agree to label it appropriately.</li><li><strong>Re-use</strong>: Re-use of content that we host is welcome, though exceptions exist for content contributed under \"fair use\" or similar exemptions under copyright law. Any re-use must comply with the underlying license(s).<p>When you re-use or re-distribute a text page developed by the Ancestor's Tale community, you agree to attribute the authors in any of the following fashions:</p><ol><li>Through hyperlink (where possible) or URL to the page or pages that you are re-using (since each page has a history page that lists all authors and editors);</li><li>Through a list of all authors (but please note that any list of authors may be filtered to exclude very small or irrelevant contributions).</li></ol><br><p>If the text content was imported from another source, it is possible that the content is licensed under a compatible CC BY-SA license but not GFDL (as described in Importing text, above). In that case, you agree to comply with the compatible CC BY-SA license and do not have the option to re-license it under GFDL. To determine the license that applies to the content that you seek to re-use or re-distribute, you should review the page footer, page history, and discussion page.</p><p>In addition, please be aware that text that originated from external sources and was imported into a tale may be under a license that attaches additional attribution requirements. Users agree to indicate these additional attribution requirements clearly. Such requirements may appear for example in a banner or other notations pointing out that some or all of the content was originally published elsewhere. Where there are such visible notations, re-users should preserve them.</p><p>For any non-text media, you agree to comply with whatever license under which the work has been made available (which can be discovered by clicking on the work and looking at the licensing section on its description page or reviewing an applicable source page for that work). When re-using any content that we host, you agree to comply with the relevant attribution requirements as they pertain to the underlying license or licenses.</p></li><li><strong>Modifications or additions to material that you re-use</strong>: When modifying or making additions to text that you have obtained from the website, you agree to license the modified or added content under CC BY-SA 3.0 or later.<p>When modifying or making additions to any non-text media that you have obtained from the website, you agree to license the modified or added content in accordance with whatever license under which the work has been made available.</p><p>With both text content and non-text media, you agree to clearly indicate that the original work has been modified. If you are re-using text content in a tale, it is sufficient to indicate in the page history that you made a change to the imported text. For each copy or modified version that you distribute, you agree to include a licensing notice stating which license the work is released under, along with either a hyperlink or URL to the text of the license or a copy of the license itself.</p></li></ol><h3><li>DMCA Compliance</li></h3><p>Ancestor's Tale wants to ensure that the content that we host can be re-used by other users without fear of liability and that it is not infringing the proprietary rights of others. In fairness to our users, as well as to other creators and copyright holders, our policy is to respond to notices of alleged infringement that comply with the formalities of the Digital Millennium Copyright Act (DMCA). Pursuant to the DMCA, we will terminate, in appropriate circumstances, users and account holders of our system and network who are repeat infringers.</p><p>However, we also recognize that not every takedown notice is valid or in good faith. In such cases, we strongly encourage users to file counter-notifications when they appropriately believe a DMCA takedown demand is invalid or improper. For more information on what to do if you think a DMCA notice has been improperly filed, you may wish to consult the <a href=\"http://www.chillingeffects.org/\">Chilling Effects</a> website.</p><p>If you are the owner of content that is being improperly used on the website without your permission, you may request that the content be removed under the DMCA. To make such a request, please email us at legal@ancestorstale.com or snail mail our designated agent at this address.</p><h3><li>Third-party Websites and Resources</li></h3><p>You are solely responsible for your use of any third-party websites or resources. Although the website contain links to third-party websites and resources, we do not endorse and are not responsible or liable for their availability, accuracy, or the related content, products, or services (including, without limitation, any viruses or other disabling features), nor do we have any obligation to monitor such third-party content.</p><h3><li>Management of Websites</li></h3><p>The community has the primary role in creating and enforcing policies applying to the website. At Ancestor's Tale, we rarely intervene in community decisions about policy and its enforcement. In an unusual case, the need may arise, or the community may ask us, to address an especially problematic user because of significant disturbance or dangerous behavior. In such cases, we reserve the right, but do not have the obligation to:</p><ul><li>Investigate your use of the service (a) to determine whether a violation of these Terms of Use, policy, or other applicable law or policy has occurred, or (b) to comply with any applicable law, legal process, or appropriate governmental request;</li><li>Detect, prevent, or otherwise address fraud, security, or technical issues or respond to user support requests;</li><li>Refuse, disable, or restrict access to the contribution of any user who violates these Terms of Use;</li><li>Ban a user from editing or contributing or block a user's account or access for actions violating these Terms of Use, including repeat copyright infringement;</li><li>Take legal action against users who violate these Terms of Use (including reports to law enforcement authorities); and</li>li><li>Manage otherwise the website in a manner designed to facilitate their proper functioning and protect the rights, property, and safety of ourselves and our users, licensors, partners, and the public.</li></ul><br><p>In the interests of our users and the website, in the extreme circumstance that any individual has had his or her account or access blocked under this provision, he or she is prohibited from creating or using another account on or seeking access to the website, unless we provide explicit permission. Without limiting the authority of the community, Ancestor's Tale itself will not ban a user from editing or contributing or block a user's account or access solely because of good faith criticism that does not result in actions otherwise violating these Terms of Use or community policies.</p><p>The Ancestor's Tale community and its members may also take action when so allowed by the community policies, including but not limited to warning, investigating, blocking, or banning users who violate those policies. You agree to comply with the final decisions of dispute resolution bodies that are established by the community (such as arbitration committees); these decisions may include sanctions as set out by the policy.</p><p>The blocking of an account or access or the banning of a user under this provision shall be in accordance with Section 12 of these Terms of Use.</p><h3><li>Resolutions and Policies</li></h3><p>Ancestor's Tale releases official policies from time to time. Some of these policies may be mandatory, and, when they are, you agree to abide by them as applicable.</p><h3><li>Termination</li></h3><p>Though we hope you will stay and continue to contribute to the website, you can stop using our services any time. In certain (hopefully unlikely) circumstances it may be necessary for either ourselves or the Ancestor's Tale community or its members (as described in Section 10) to terminate part or all of our services, terminate these Terms of Use, block your account or access, or ban you as a user. If your account or access is blocked or otherwise terminated for any reason, your public contributions will remain publicly available (subject to applicable policies), and, unless we notify you otherwise, you may still access our public pages for the sole purpose of reading publicly available content on the website. In such circumstances, however, you may not be able to access your account or settings. We reserve the right to suspend or end the services at any time, with or without cause, and with or without notice. Even after your use and participation are banned, blocked or otherwise suspended, these Terms of Use will remain in effect with respect to relevant provisions, including Sections 1, 3, 4, 6, 7, 9-15, and 17.</p><h3><li>Disputes and Jurisdiction</li></h3><p>We hope that no serious disagreements arise involving you, but, in the event there is a dispute, we encourage you to seek resolution through the dispute resolution procedures or mechanisms provided by Ancestor's Tale. If you seek to file a legal claim against us, you agree to file and resolve it exclusively in a court located in Dublin, Ireland. You also agree that the laws of the Republic of Ireland will govern these Terms of Use, as well as any legal claim that might arise between you and us (without reference to conflict of laws principles). You agree to submit to the personal jurisdiction of, and agree that venue is proper in, the courts located in Dublin, Ireland, in any legal action or proceeding relating to us or these Terms of Use.</p><p>To ensure that disputes are dealt with soon after they arise, you agree that regardless of any statute or law to the contrary, any claim or cause of action you might have arising out of or related to use of our services or these Terms of Use must be filed within the applicable statute of limitations or, if earlier, one (1) year after the pertinent facts underlying such claim or cause of action could have been discovered with reasonable diligence (or be forever barred).</p><h3><li>Disclaimers</li></h3><p>At Ancestor's Tale, we do our best to provide educational and informational content to a very wide audience, but your use of our services is at your sole risk. We provide these services on an \"as is\" and \"as available\" basis, and we expressly disclaim all express or implied warranties of all kinds, including but not limited to the implied warranties of merchantability, fitness for a particular purpose, and non-infringement. We make no warranty that our services will meet your requirements, be safe, secure, uninterrupted, timely, accurate, or error-free, or that your information will be secure.</p><p>We are not responsible for the content, data, or actions of third parties, and you release us, our directors, officers, employees, and agents from any claims and damages, known and unknown, arising out of or in any way connected with any claim you have against any such third parties. No advice or information, whether oral or written, obtained by you from us or through or from our services creates any warranty not expressly stated in these Terms of Use.</p><p>Any material downloaded or otherwise obtained through your use of our services is done at your own discretion and risk, and you will be solely responsible for any damage to your computer system or loss of data that results from the download of any such material. You agree that we have no responsibility or liability for the deletion of, or the failure to store or to transmit, any content or communication maintained by the service. We retain the right to create limits on use and storage at our sole discretion at any time with or without notice.</p><p>Some states or jurisdictions do not allow the types of disclaimers in this section, so they may not apply to you either in part or in full depending on the law.</p><h3><li>Limitation on Liability</li></h3><p>Ancestor's Tale will not be liable to you or to any other party for any direct, indirect, incidental, special, consequential or exemplary damages, including but not limited to, damages for loss of profits, goodwill, use, data, or other intangible losses, regardless of whether we were advised of the possibility of such damage. In no event shall our liability exceed one thousand U.S. dollars (USD 1000.00) in aggregate. In the case that applicable law may not allow the limitation or exclusion of liability or incidental or consequential damages, the above limitation or exclusion may not apply to you, although our liability will be limited to the fullest extent permitted by applicable law.</p><h3><li>Modifications to these Terms of Use</li></h3><p>Just as the Ancestor's Tale community's input is essential for the growth and maintenance of the website, we believe that community input is essential for these Terms of Use to properly serve our users. It is also essential for a fair contract. Therefore, we will provide these Terms of Use, as well as any substantial future revisions of these Terms of Use, to the community for comment at least thirty (30) days before the end of the comment period. If a future proposed revision is substantial, we will provide an additional 30 days for comments after posting a translation of the proposed revision in at least three languages (selected at our discretion). The community will be encouraged to translate the proposed revision in other languages as appropriate. For changes for legal or administrative reasons, to correct an inaccurate statement, or changes in response to community comments, we will provide at least three (3) days' notice.</p><p>Because it may be necessary to modify these Terms of Use from time to time, we will provide notice of such modifications and the opportunity to comment via the website, and via an email notification. However, we ask that you please periodically review the most up-to-date version of these Terms of Use. Your continued use of our services after the new Terms of Use become official following the notice and review period constitutes an acceptance of these Terms of Use on your part. For the protection of Ancestor's Tale and other users like yourself, if you do not agree with our Terms of Use, you cannot use our services.</p><h3><li>Other Terms</li></h3><p>These Terms of Use do not create an employment, agency, partnership, or joint venture relationship between you and us, Ancestor's Tale. If you have not signed a separate agreement with us, these Terms of Use are the entire agreement between you and us. If there is any conflict between these Terms of Use and a signed written agreement between you and us, the signed agreement will control.</p><p>You agree that we may provide you with notices, including those regarding changes to the Terms of Use, by email, regular mail, or postings on the website.</p><p>If in any circumstance, we do not apply or enforce any provision of these Terms of Use, it is not a waiver of that provision.</p><p>You understand that, unless otherwise agreed to in writing by us, you have no expectation of compensation for any activity, contribution, or idea that you provide to us, the community, or Ancestor's Tale.</p><p>Notwithstanding any provision to the contrary in these Terms of Use, we (Ancestor's Tale) and you agree not to modify the applicable terms and requirements of any free license that is employed on the website when such free license is authorized by these Terms of Use.</p><p>These Terms of Use were written in English (U.S.). While we hope that translations of these Terms of Use are accurate, in the event of any differences in meaning between the original English version and a translation, the original English version takes precedence.</p><p>If any provision or part of a provision of these Terms of Use is found unlawful, void, or unenforceable, that provision or part of the provision is deemed severable from these Terms of Use and will be enforced to the maximum extent permissible, and all other provisions of these Terms of Use will remain in full force and effect.</p></ol><h2>Thank You!</h2></p><p>We appreciate your taking the time to read these Terms of Use, and we are very happy to have you contributing to the website and using our services. Through your contributions, you are helping to build something really big  not only an important collection of collaboratively edited human relationships that provides education and information to millions who might otherwise lack access, but also a vibrant community of like-minded and engaged peers, focused on a very noble goal.</p>")
}]),angular.module("scripts/project/templates/contractLinksModal.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/project/templates/contractLinksModal.tpl.html",'<div class=modal-header><h3>{{content.title | translate}}</h3></div><div class=modal-body><div ng-if="rels.parent.length > 0"><h3>{{\'Project.CollapseLink.Parent\' | translate}}</h3><div class=radio ng-repeat="rel in rels.parent"><label><input type=radio ng-model=selected.rel name=optionsRadios ng-value=rel> {{rel.node.primaryName.displayName}} {{rel.node.primaryName.dates}}</label></div></div><div ng-if="rels.child.length > 0"><h3>{{\'Project.CollapseLink.Child\' | translate}}</h3><div class=radio ng-repeat="rel in rels.child"><label><input type=radio ng-model=selected.rel name=optionsRadios ng-value=rel> {{rel.node.primaryName.displayName}} {{rel.node.primaryName.dates}}</label></div></div><div ng-if="rels.couple.length > 0"><h3>{{\'Project.CollapseLink.Couple\' | translate}}</h3><div class=radio ng-repeat="rel in rels.couple"><label><input type=radio ng-model=selected.rel name=optionsRadios ng-value=rel> {{rel.node.primaryName.displayName}} {{rel.node.primaryName.dates}}</label></div></div></div><div class=modal-footer><button class="btn btn-primary" ng-click=ok() ng-disabled=!selected.rel>{{\'Project.CollapseLink.Ok\' | translate}}</button> <button class="btn btn-warning" ng-click=cancel()>{{\'Project.CollapseLink.Cancel\' | translate}}</button></div>')}]),angular.module("scripts/project/templates/graph.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/project/templates/graph.tpl.html",'<svg ng-click=hideOptions() id=svg><g id=zoomPan><g ng-repeat="link in data.links"><line ng-show=!link.hide class=link ng-attr-stroke-width=2 ng-attr-x1="{{link.source.x + graph.node.width/2 }}" ng-attr-y1="{{link.source.y + graph.node.height/2}}" ng-attr-x2="{{link.target.x + graph.node.width/2}}" ng-attr-y2="{{link.target.y + graph.node.height/2}}" ng-class="{unselected: link.fade, highlight: link.highlight}" ng-click="toggleLinkOptions(link, $event)"></line></g><g ng-repeat="node in data.nodes" ng-click="toggleNodeOptions(node, $event)"><g ng-show=!node.hide><rect class="node {{node.gender}}" ng-attr-width={{graph.node.width}} ng-attr-height={{graph.node.height}} ng-attr-x={{node.x}} ng-attr-y={{node.y}} ng-class="{unselected: node.fade, deceased: !node.living, hiddenLinks: expandableLinksExist(node._id)}"></rect><text ng-attr-dx={{graph.node.width/2}} ng-attr-dy="{{graph.node.height + graph.node.spacing}}" style="text-anchor: middle" ng-attr-x={{node.x}} ng-attr-y={{node.y}} ng-class="{textFade: node.fade}">{{node.primaryName.name}}</text><text ng-if=node.primaryName.maiden ng-attr-dx={{graph.node.width/2}} ng-attr-dy="{{graph.node.height + graph.node.spacing*2}}" style="text-anchor: middle" ng-attr-x={{node.x}} ng-attr-y={{node.y}} ng-class="{textFade: node.fade}">{{node.primaryName.maiden}}</text><text ng-attr-dx={{graph.node.width/2}} ng-attr-dy="{{graph.node.height + graph.node.spacing * (node.primaryName.maiden | iif: 3: 2)}}" style="text-anchor: middle" ng-attr-x={{node.x}} ng-attr-y={{node.y}} ng-class="{textFade: node.fade}">{{node.dates}}</text></g></g><g ng-show=graph.showOptions><g ui-sref="person.show({personId: graph.selectedNode._id})"><rect class=nodeOptions ng-attr-width={{graph.options.width}} ng-attr-height={{graph.options.height}} ng-attr-x={{graph.view.x}} ng-attr-y={{graph.view.y}}></rect><path id=viewIcon d="M622.826 702.736c-22.11-3.518-22.614-64.314-22.614-64.314s64.968-64.316 79.128-150.802c38.090 0 61.618-91.946 23.522-124.296 1.59-34.054 48.96-267.324-190.862-267.324-239.822 0-192.45 233.27-190.864 267.324-38.094 32.35-14.57 124.296 23.522 124.296 14.158 86.486 79.128 150.802 79.128 150.802s-0.504 60.796-22.614 64.314c-71.22 11.332-337.172 128.634-337.172 257.264h896c0-128.63-265.952-245.932-337.174-257.264z"></path></g><g ui-sref="relationship.create({personId: graph.selectedNode._id})"><rect class=nodeOptions ng-attr-width={{graph.options.width}} ng-attr-height={{graph.options.height}} ng-attr-x={{graph.relationship.x}} ng-attr-y={{graph.relationship.y}}></rect><path id=relationshipIcon d="M734.994 805.374c-18.952-2.988-19.384-54.654-19.384-54.654s55.688-54.656 67.824-128.152c32.652 0 52.814-78.138 20.164-105.628 1.362-28.94 41.968-227.176-163.598-227.176-205.564 0-164.958 198.236-163.598 227.176-32.654 27.49-12.488 105.628 20.162 105.628 12.134 73.496 67.826 128.152 67.826 128.152s-0.432 51.666-19.384 54.654c-61.048 9.632-289.006 109.316-289.006 218.626h768c0-109.31-227.958-208.994-289.006-218.626zM344.054 822.81c44.094-27.15 97.626-52.308 141.538-67.424-15.752-22.432-33.294-52.936-44.33-89.062-15.406-12.566-27.944-30.532-35.998-52.602-8.066-22.104-11.122-46.852-8.608-69.684 1.804-16.392 6.478-31.666 13.65-45.088-4.35-46.586-7.414-138.034 52.448-204.732 23.214-25.866 52.556-44.46 87.7-55.686-6.274-64.76-39.16-140.77-166.454-140.77-205.564 0-164.958 198.236-163.598 227.176-32.654 27.49-12.488 105.628 20.162 105.628 12.134 73.496 67.826 128.152 67.826 128.152s-0.432 51.666-19.384 54.654c-61.048 9.634-289.006 109.318-289.006 218.628h329.596c4.71-3.074 9.506-6.14 14.458-9.19z"></path></g><g ng-click=contractLinks(graph.selectedNode._id) ng-show=contractableLinksExist(graph.selectedNode._id)><rect class=nodeOptions ng-attr-width={{graph.options.width}} ng-attr-height={{graph.options.height}} ng-attr-x={{graph.contract.x}} ng-attr-y={{graph.contract.y}}></rect><path id=contractIcon d=M25.979,12.896,5.979,12.896,5.979,19.562,25.979,19.562z></path></g><g ng-click=expandLinks(graph.selectedNode._id) ng-show=expandableLinksExist(graph.selectedNode._id)><rect class=nodeOptions ng-attr-width={{graph.options.width}} ng-attr-height={{graph.options.height}} ng-attr-x={{graph.expand.x}} ng-attr-y={{graph.expand.y}}></rect><path id=expandIcon d="M25.979,12.896 19.312,12.896 19.312,6.229 12.647,6.229 12.647,12.896 5.979,12.896 5.979,19.562 12.647,19.562 12.647,26.229 19.312,26.229 19.312,19.562 25.979,19.562z"></path></g></g></g></svg>')}]),angular.module("scripts/project/templates/project.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/project/templates/project.tpl.html","<div ui-view autoscroll=false id=projectPage></div>")}]),angular.module("scripts/project/templates/projectCreate.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/project/templates/projectCreate.tpl.html","<p>Test Create</p>")}]),angular.module("scripts/project/templates/projectGraph.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/project/templates/projectGraph.tpl.html",'<project-graph data=projectData settings=graphSettings></project-graph><div class="col-xs-8 col-sm-5 col-md-4 col-lg-3 personSearch input-group"><input class=form-control ng-model=selected.person placeholder="{{\'Project.ProjectViewCtrl.TypeName\' | translate}}" typeahead="person as person.primaryName.nameWithDates for person in projectData.nodes | filter:$viewValue | limitTo: 8" typeahead-editable=false typeahead-on-select=navigateToPerson() name=personSearch id=personSearch autofocus> <span class=input-group-btn><button type=button class="btn btn-default" ng-if=selected.person ui-sref=project.show ng-click=deselectPerson()><span class="glyphicon glyphicon-remove-circle"></span></button> </span></div><div ui-view autoscroll=false></div>')}]),angular.module("scripts/security/templates/loginFormModal.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/security/templates/loginFormModal.tpl.html",'<form name=form ng-submit=login(form) role=form id=loginForm><div class=modal-header><h3 name=loginTitle>{{content.title}}</h3><div class=col-12><div ng-if=showResendActivation><hr><a class=hand ng-click=cancelLogin() ui-sref=register.resendActivation>{{\'Login.LoginCtrl.ResendActivationLink\' | translate}}</a></div></div></div><div class=modal-body><div class="alert alert-danger" ng-show=authReason>{{authReason}}</div><div class=form-group><label for=email>{{\'Login.LoginCtrl.Email\' | translate}}</label><input type=email name=email class="form-control input-large" ng-model=user.email required> <span class=help-block ng-show="submitted && form.email.$invalid"><small class=text-danger name=emailValidation>{{\'Login.LoginCtrl.EmailValidation\' | translate}}</small></span></div><div class=form-group><label for=password>{{\'Login.LoginCtrl.Password\' | translate}}</label><input type=password name=password class="form-control input-large" ng-model=user.password required> <span class=help-block ng-show="submitted && form.password.$error.required"><small class=text-danger name=passwordRequired>{{\'Login.LoginCtrl.RequiredValidation\' | translate}}</small></span><br><a class=hand data-ng-click=cancelLogin() ui-sref=register.forgotPassword>{{\'Login.LoginCtrl.ForgotPassword\' | translate}}</a></div><label class=checkbox for=rememberMe>{{\'Login.LoginCtrl.RememberMe\' | translate}} <input class="check_boxes optional" ng-model=user.rememberMe type=checkbox name=rememberMe></label></div><div class=modal-footer><div class=col-xs-8><button class="btn btn-primary" id=loginButton type=submit><span class="glyphicon glyphicon-lock"></span> {{\'Login.LoginCtrl.SubmitButton\' | translate}}</button> <button class="btn btn-warning" id=cancelLoginButton ng-click=cancelLogin()>{{\'Login.LoginCtrl.Cancel\' | translate}}</button></div><div class=col-xs-4><a class=hand ng-click="oAuth(\'facebook\')"><span class="icon-facebook socialIcon facebookIcon"></span></a> <a class=hand ng-click="oAuth(\'google\')"><span class="icon-googleplus socialIcon googleplusIcon"></span></a></div></div></form>')}]),angular.module("scripts/security/templates/loginToolbar.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/security/templates/loginToolbar.tpl.html","<ul class=\"navbar-right nav\"><li class=divider-vertical></li><li data-ng-if=currentUser class=dropdown data-ng-class=\"{active: $state.includes('account'), open:accountNavOpen}\"><a href id=accountMenu role=button class=dropdown-toggle data-ng-click=\"accountNavOpen=!accountNavOpen\">{{currentUser.firstName}} {{currentUser.lastName}}</a><ul class=dropdown-menu role=menu aria-labelledby=accountMenu><li><a tabindex=-1 ui-sref=account.show>{{'Login.LoginToolbarCtrl.Profile' | translate}}</a></li><li><a tabindex=-1 ui-sref=account.editPassword>{{'Login.LoginToolbarCtrl.Password' | translate}}</a></li><li><a tabindex=-1 ui-sref=\"profile.show({profileId: currentUser._id})\">{{'Profile.ProfileCtrl.Profile' | translate}}</a></li><li class=divider></li><li><a tabindex=-1 id=logout data-ng-click=\"logout('home')\">{{'Login.LoginToolbarCtrl.Logout' | translate}}</a></li></ul></li><li data-ng-if=!currentUser class=login><form class=navbar-form><button class=\"btn btn-success navbar-button\" ui-sref=register.show>{{'Login.LoginToolbarCtrl.Register' | translate}}</button> <button class=\"btn navbar-button\" id=login data-ng-click=login()>{{'Login.LoginToolbarCtrl.Login' | translate}}</button> </form></li></ul>")}]),angular.module("scripts/user/templates/account.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/user/templates/account.tpl.html",'<div class="container withHeader"><div class=row><div class="col-xs-12 col-sm-3 col-md-3 col-lg-3" data-ng-include data-src="\'scripts/user/templates/accountMenu.tpl.html\'"></div><div class="col-xs-12 col-sm-8 col-md-8 col-lg-9" ui-view autoscroll=false></div></div></div>')}]),angular.module("scripts/user/templates/accountMenu.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/user/templates/accountMenu.tpl.html","<div id=account-nav class=menuHeader><ul class=\"nav nav-pills nav-stacked\"><li><a ui-sref=account.show>{{'Account.AccountCtrl.Profile' | translate}}</a></li><li><a ui-sref=account.editPassword>{{'Account.AccountCtrl.Password' | translate}}</a></li></ul></div>")}]),angular.module("scripts/user/templates/accountPassword.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/user/templates/accountPassword.tpl.html","<h3>{{'Account.AccountCtrl.Password' | translate}}</h3><div ng-if=account.hasPassword><form class=form-horizontal name=PasswordChange ng-submit=update(PasswordChange)><div class=form-group><label for=currentPassword class=\"col-lg-3 control-label\">{{'Account.AccountPasswordCtrl.CurrentPassword' | translate}}</label><div class=col-lg-9><input type=password name=currentPassword class=form-control required ng-model=password.currentPassword> <span class=help-block data-ng-show=\"submitted && PasswordChange.currentPassword.$error.required\"><small class=text-danger name=currentPasswordValidation>{{'Account.AccountPasswordCtrl.RequiredValidation' | translate}}</small></span></div></div><hr><div class=form-group><label for=newPassword class=\"col-lg-3 control-label\">{{'Account.AccountPasswordCtrl.NewPassword' | translate}}</label><div class=col-lg-9><input type=password name=newPassword class=form-control required data-ng-minlength=6 ng-model=password.newPassword> <span class=help-block data-ng-show=\"submitted && PasswordChange.newPassword.$invalid\"><small class=text-danger name=newPasswordValidation>{{'Account.AccountPasswordCtrl.PasswordValidation' | translate}}</small></span></div></div><div class=form-group><label for=newPasswordConfirm class=\"col-lg-3 control-label\">{{'Account.AccountPasswordCtrl.ConfirmNewPassword' | translate}}</label><div class=col-lg-9><input type=password name=newPasswordConfirm class=form-control required ng-model=password.passwordConfirm at-match-field=newPassword> <span class=help-block data-ng-show=\"submitted && PasswordChange.newPasswordConfirm.$error.required\"><small class=text-danger name=newPasswordConfirmRequired>{{'Account.AccountPasswordCtrl.RequiredValidation' | translate}}</small></span> <span class=help-block data-ng-show=\"PasswordChange.newPasswordConfirm.$error.match && PasswordChange.newPasswordConfirm.$dirty\"><small class=text-danger name=newPasswordConfirmValidation>{{'Account.AccountPasswordCtrl.ConfirmPasswordValidation' | translate}}</small></span></div></div><button class=\"btn btn-primary\" type=submit>{{'Account.AccountPasswordCtrl.Update' | translate}}</button></form></div><div class=\"col-12 col-sm-8 col-lg-6\" ng-if=!account.hasPassword><h3 name=requestPasswordTitle>{{'Account.AccountPasswordCtrl.RequestPassword' | translate}}</h3><p name=requestPasswordText>{{'Account.AccountPasswordCtrl.RequestPasswordText' | translate}}</p><button class=\"btn btn-primary\" ng-click=sendPasswordLink(account.email) ng-disabled=sent name=sendPasswordLink>{{'Account.AccountPasswordCtrl.SendPasswordLink' | translate}}</button></div>")}]),angular.module("scripts/user/templates/accountShow.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/user/templates/accountShow.tpl.html","<h3>{{'Account.AccountCtrl.Profile' | translate}}</h3><form class=form-horizontal name=EditProfile ng-submit=update(EditProfile)><div class=form-group><label for=firstName class=\"col-lg-2 control-label\">{{'Account.AccountViewCtrl.FirstName' | translate}}</label><div class=col-lg-10><input name=firstName class=form-control ng-model=account.firstName required ng-disabled=!editable> <span class=help-block data-ng-show=\"submitted && EditProfile.firstName.$error.required\"><small class=text-danger name=firstNameRequired>{{'Account.AccountViewCtrl.RequiredValidation' | translate}}</small></span></div></div><div class=form-group><label for=lastName class=\"col-lg-2 control-label\">{{'Account.AccountViewCtrl.LastName' | translate}}</label><div class=col-lg-10><input name=lastName class=form-control ng-model=account.lastName required ng-disabled=!editable> <span class=help-block data-ng-show=\"submitted && EditProfile.firstName.$error.required\"><small class=text-danger name=lastNameRequired>{{'Account.AccountViewCtrl.RequiredValidation' | translate}}</small></span></div></div><div class=form-group><label for=email class=\"col-lg-2 control-label\">{{'Account.AccountViewCtrl.Email' | translate}}</label><div class=col-lg-10><input name=email class=form-control type=email ng-model=account.email required ng-disabled=!editable> <span class=help-block data-ng-show=\"submitted && EditProfile.email.$invalid\"><small class=text-danger name=emailValidation>{{'Account.AccountViewCtrl.EmailValidation' | translate}}</small></span></div></div><div class=form-group><label for=gender class=\"col-lg-2 control-label\">{{'Account.AccountViewCtrl.Gender' | translate}}</label><div class=\"col-lg-10 radio\"><label class=\"checkbox-inline col-xs-3\" ng-repeat=\"gender in genders | translate\"><input type=radio ng-model=account.gender ng-value=gender.value name=gender required ng-disabled=!editable> {{gender.name | translate}}</label><span class=help-block data-ng-show=\"submitted && EditProfile.gender.$error.required\"><small class=text-danger name=genderValidation>{{'Account.AccountViewCtrl.GenderValidation' | translate}}</small></span></div></div><div ng-if=editable><hr><p name=changeConfirmation>{{'Account.AccountViewCtrl.ChangeConfirmation' | translate}}</p><div class=form-group><label for=password class=\"col-lg-2 control-label\">{{'Account.AccountViewCtrl.Password' | translate}}</label><div class=col-lg-10><input name=password class=form-control type=password ng-model=account.password required> <span class=help-block data-ng-show=\"submitted && EditProfile.password.$error.required\"><small class=text-danger name=passwordValidation>{{'Account.AccountViewCtrl.RequiredValidation' | translate}}</small></span></div></div><button class=\"btn btn-primary\" type=submit>{{'Account.AccountViewCtrl.Update' | translate}}</button> <span><span name=or>{{'Account.AccountViewCtrl.Or' | translate}}</span> <a class=hand ng-click=cancelEdit() name=cancel>{{'Account.AccountViewCtrl.Cancel' | translate}}</a></span></div></form><div ng-if=!editable><button class=\"btn btn-primary\" ng-if=account.hasPassword ng-click=edit() name=edit>{{'Account.AccountViewCtrl.Edit' | translate}}</button></div><div class=\"col-md-12 col-sm-12 col-lg-12 col-xs-12\" ng-if=!account.hasPassword><p name=noPasswordText>{{'Account.AccountViewCtrl.NoPasswordText' | translate}}</p><button class=\"btn btn-large btn-primary\" ng-controller=AccountPasswordCtrl ng-click=sendPasswordLink(account.email) ng-disabled=sent name=sendPasswordLink>{{'Account.AccountViewCtrl.SendPasswordLink' | translate}}</button></div>")}]),angular.module("scripts/user/templates/changeForgottenPassword.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/user/templates/changeForgottenPassword.tpl.html","<form name=form ng-submit=changeForgottenPassword(form)><div><h2>{{'Register.ChangeForgottenPasswordCtrl.Title' | translate}}</h2><div class=form-group><label class=control-label for=password>{{'Register.ChangeForgottenPasswordCtrl.Password' | translate}}</label><input class=form-control name=password data-ng-model=user.password type=password data-ng-minlength=6 required> <span class=help-block ng-show=\"submitted && form.password.$invalid\"><small class=text-danger name=passwordValidation>{{'Register.ChangeForgottenPasswordCtrl.PasswordValidation' | translate}}</small></span></div><div class=form-group><label class=control-label for=passwordConfirm>{{'Register.ChangeForgottenPasswordCtrl.ConfirmPassword' | translate}}</label><input class=form-control name=passwordConfirm data-ng-model=user.passwordConfirm type=password required at-match-field=password> <span class=help-block ng-show=\"submitted && form.passwordConfirm.$error.required\"><small class=text-danger name=passwordConfirmRequired>{{'Register.ChangeForgottenPasswordCtrl.RequiredValidation' | translate}}</small></span> <span class=help-block data-ng-show=\"form.passwordConfirm.$error.match && form.passwordConfirm.$dirty\"><small class=text-danger name=passwordConfirmValidation>{{'Register.ChangeForgottenPasswordCtrl.ConfirmPasswordValidation' | translate}}</small></span></div><button class=\"btn btn-primary\" type=submit>{{'Register.ChangeForgottenPasswordCtrl.SubmitButton' | translate}}</button> <span name=or>{{'Register.ChangeForgottenPasswordCtrl.Or' | translate}}</span> <a class=show-signup ui-sref=register.show>{{'Register.ChangeForgottenPasswordCtrl.Cancel' | translate}}</a></div></form>")}]),angular.module("scripts/user/templates/checkEmail.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/user/templates/checkEmail.tpl.html","<div><h2>{{'Register.RegisterCtrl.RegistrationSuccessTitle' | translate}}</h2><p>{{'Register.RegisterCtrl.RegistrationSuccessText' | translate}}</p></div>")}]),angular.module("scripts/user/templates/forgotPassword.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/user/templates/forgotPassword.tpl.html","<div><form name=form ng-submit=forgotPassword(form)><h2>{{'Register.ForgotPasswordCtrl.Title' | translate}}</h2><div class=form-group><label class=control-label for=email>{{'Register.ForgotPasswordCtrl.Email' | translate}}</label><input class=form-control type=email data-ng-model=user.email required> <span class=help-block ng-show=\"submitted && form.email.$invalid\"><small class=text-danger name=emailValidation>{{'Register.ForgotPasswordCtrl.EmailValidation' | translate}}</small></span></div><button class=\"btn btn-primary\" type=submit>{{'Register.ForgotPasswordCtrl.SubmitButton' | translate}}</button> <span name=or>{{'Register.ForgotPasswordCtrl.Or' | translate}}</span> <a class=show-signup ui-sref=register.show>{{'Register.ForgotPasswordCtrl.Cancel' | translate}}</a></form></div>")}]),angular.module("scripts/user/templates/profile.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/user/templates/profile.tpl.html",'<div class="container withHeader"><div class=row><div class="col-xs-12 col-sm-4 col-md-4 col-lg-3" data-ng-include data-src="\'scripts/user/templates/profileMenu.tpl.html\'"></div><div class="col-xs-12 col-sm-8 col-md-8 col-lg-9" ui-view autoscroll=false></div></div></div>')}]),angular.module("scripts/user/templates/profileMenu.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/user/templates/profileMenu.tpl.html","<div><img ng-src=./images/profile-{{profile.gender}}.png><h2>{{profile.firstName}} {{profile.lastName}}</h2><h5>{{'Profile.ProfileCtrl.Joined' | translate}}: <span am-time-ago=profile.createdDate></span></h5><hr></div>")}]),angular.module("scripts/user/templates/profileShow.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/user/templates/profileShow.tpl.html",'<div><h4><span name=personHistoryTitle>{{\'Profile.ProfileCtrl.Activity\' | translate}}</span></h4><hr><div class=container-fluid><div ng-repeat="record in history"><div class=col-xs-1><span class="glyphicon {{record | historyIcon}}"></span></div><div class=col-xs-11><p><small am-time-ago=record.timestamp></small></p><a ui-sref="profile.show({profileId: record.user._id})">{{record.user.firstName}} {{record.user.lastName}}</a> {{record | historyAction}}:  <span ng-if=record.name class=sentenceCase><a ui-sref="name.show({nameId: record.name._id, nameFormId: record.nameForm._id, projectId: record.projectId, personId: record.people[0]._id})" ng-if="record.action !== \'remove\'">{{record.name.type | valueName: \'nameTypes\' | translate}}: {{record.nameForm.fullText}} ({{record.nameForm.lang | langName | translate}})</a> <span ng-if="record.action === \'remove\'">{{record.name.type | valueName: \'nameTypes\' | translate}}: {{record.nameForm.fullText}} ({{record.nameForm.lang | langName | translate}})</span></span>  <span ng-if=record.fact><a ui-sref="fact.show({factId: record.fact._id, projectId: record.projectId, personId: record.people[0]._id})" ng-if="record.action !== \'remove\'">{{record.fact.type | valueName: \'factTypes\' | translate}}</a> <span ng-if="record.action === \'remove\'">{{record.fact.type | valueName: \'factTypes\' | translate}}</span></span>  <span ng-if="record.record !== \'History.Person\' && record.record !== \'History.Relationship\'">{{\'History.Actions.OnRecord\' | translate}}</span>  <span ng-if="record.people.length > 0"><span ng-if="record.people.length > 1"><a ui-sref="person.show({personId: record.people[1]._id, projectId: record.projectId})">{{record.people[1].nameForm.fullText}}</a> {{\'History.Actions.Is\' | translate}} <a ui-sref="person.show.relationships({personId: record.people[0]._id, projectId: record.projectId})">{{record.people[1].relType | translate}}</a> {{\'History.Actions.Of\' | translate}}</span> <a ui-sref="person.show({personId: record.people[0]._id, projectId: record.projectId})">{{record.people[0].nameForm.fullText}}</a></span>  <p ng-repeat="(key, value) in record.namePart" ng-if="record.type !== \'update\'" class=text-muted>{{key | translate}} <span ng-if=key>:</span> {{value}}</p><p ng-if="record.value && record.type !== \'update\'" class=text-muted>{{record.value[""]}} ({{record.value.lang | translate}})</p><p ng-repeat="valueRecord in record.values" ng-if="record.type !== \'update\'" class=text-muted>{{valueRecord[""]}} ({{valueRecord.lang | translate}})</p><p ng-repeat="placeRecord in record.place" ng-if="record.type !== \'update\'" class=text-muted>{{placeRecord[""]}} ({{placeRecord.lang | translate}})</p><p ng-if="record.date && record.type !== \'update\'" class=text-muted>{{record.date}}</p><p ng-repeat="(key, value) in record.updates" class="text-muted sentenceCase">{{key | translate}}<span ng-if=key>:</span> {{ value.oldValue | translate}} --> {{ value.newValue | translate}}</p><hr ng-if=!$last></div></div></div></div>')}]),angular.module("scripts/user/templates/register.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/user/templates/register.tpl.html",'<div class="container withHeader"><div class=row><div class="col-xs-12 col-sm-6 col-md-8" data-ng-include data-src="\'scripts/home/templates/benefits.tpl.html\'"></div><div class="col-xs-12 col-sm-6 col-md-4" ui-view autoscroll=false></div></div></div>')}]),angular.module("scripts/user/templates/registerShow.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/user/templates/registerShow.tpl.html",'<div><form role=form name=RegisterForm novalidate ng-submit=registerUser(RegisterForm)><h2>{{\'Register.RegisterCtrl.Title\' | translate}}</h2><div class=form-group><div class=form-inline id=name><div class="form-group col-xs-12 col-sm-6 col-md-6 col-lg-6 noPadding"><label class=sr-only for=firstName>{{\'Register.RegisterCtrl.FirstName\' | translate}}</label><input class="form-control input-large" name=firstName data-ng-model=user.firstName required placeholder="{{\'Register.RegisterCtrl.FirstName\' | translate}}"> <span class=help-block data-ng-show="submitted && RegisterForm.firstName.$error.required"><small class=text-danger name=firstNameRequired>{{\'Register.RegisterCtrl.RequiredValidation\' | translate}}</small></span></div><div class="form-group col-xs-12 col-sm-6 col-md-6 col-lg-6 noPadding"><label class=sr-only for=lastName>{{\'Register.RegisterCtrl.LastName\' | translate}}</label><input class="form-control input-large" name=lastName data-ng-model=user.lastName required placeholder="{{\'Register.RegisterCtrl.LastName\' | translate}}"> <span class=help-block data-ng-show="submitted && RegisterForm.lastName.$error.required"><small class=text-danger name=lastNameRequired>{{\'Register.RegisterCtrl.RequiredValidation\' | translate}}</small></span></div></div></div><div class=form-group><label class=sr-only for=email>{{\'Register.RegisterCtrl.Email\' | translate}}</label><input class="form-control input-large" name=email data-ng-model=user.email type=email required placeholder="{{\'Register.RegisterCtrl.Email\' | translate}}"> <span class=help-block data-ng-show="submitted && RegisterForm.email.$invalid"><small class=text-danger name=emailValidation>{{\'Register.RegisterCtrl.EmailValidation\' | translate}}</small></span></div><div class=form-group><label class=sr-only for=password>{{\'Register.RegisterCtrl.Password\' | translate}}</label><input class="form-control input-large" name=password data-ng-model=user.password type=password data-ng-minlength=6 required placeholder="{{\'Register.RegisterCtrl.Password\' | translate}}"> <span class=help-block data-ng-show="submitted && RegisterForm.password.$invalid"><small class=text-danger name=passwordValidation>{{\'Register.RegisterCtrl.PasswordValidation\' | translate}}</small></span></div><div class=form-group><label class=sr-only for=gender>{{\'Register.RegisterCtrl.Gender\' | translate}}</label><div class=radio><label class="checkbox-inline col-xs-3" ng-repeat="gender in genders"><input type=radio ng-model=user.gender ng-value=gender.value name=gender required> {{gender.name | translate}}</label><span class=help-block data-ng-show="submitted && RegisterForm.gender.$error.required"><small class=text-danger name=genderRequired>{{\'Register.RegisterCtrl.GenderValidation\' | translate}}</small></span></div></div><div class="col-xs-12 noPadding form-group"><label for=birthday class=col-xs-12>{{\'Register.RegisterCtrl.Birthday\' | translate}}</label><div class="form-group col-xs-3 noPadding"><select name=birthdayDay data-ng-model=birthdayField.startDateDay class=form-control ng-options="day for day in days" ng-change=checkDate(birthdayField) required></select></div><div class="form-group col-xs-5 noPadding"><select name=birthdayMonth data-ng-model=birthdayField.startDateMonth class=form-control ng-options="month.value as translate(month.name) for month in months" ng-change=checkDate(birthdayField) required></select></div><div class="form-group col-xs-4 noPadding"><input name=birthdayYear data-ng-model=birthdayField.startDateYear placeholder=Year class=form-control ng-change=checkDate(birthdayField) required></div><span class=help-block data-ng-show="submitted && (RegisterForm.birthdayDay.$error.required || RegisterForm.birthdayMonth.$error.required || RegisterForm.birthdayYear.$error.required)"><small class=text-danger name=dateRequired>{{\'Register.RegisterCtrl.BirthdayValidation\' | translate}}</small></span></div><button class="btn btn-primary" name=registerBtn type=submit>{{\'Register.RegisterCtrl.SubmitButton\' | translate}}</button><br><br><p align=center><small id=socialSignupOptions>{{\'Register.RegisterCtrl.SocialSignupOption\' | translate}}</small><br><a class=hand ng-click="oAuth(\'facebook\')"><span class="icon-facebook socialIcon facebookIcon"></span></a> <a class=hand ng-click="oAuth(\'google\')"><span class="icon-googleplus socialIcon googleplusIcon"></span></a></p><p><small name=userAgreementIntro>{{\'Register.RegisterCtrl.UserAgreementIntro\' | translate}}<a href id=terms data-ng-click=terms()>{{\'Register.RegisterCtrl.UserAgreement\' | translate}}</a>.</small></p></form></div>')}]),angular.module("scripts/user/templates/resendActivation.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/user/templates/resendActivation.tpl.html","<form name=form ng-submit=resendActivation(form)><div><h2>{{'Register.ResendActivationCtrl.Title' | translate}}</h2><div class=form-group><label for=email>{{'Register.ResendActivationCtrl.Email' | translate}}</label><input id=email class=form-control type=email name=email data-ng-model=user.email required> <span class=help-block ng-show=\"submitted && form.email.$invalid\"><small class=text-danger name=emailValidation>{{'Register.ResendActivationCtrl.EmailValidation' | translate}}</small></span></div><button class=\"btn btn-primary\" type=submit>{{'Register.ResendActivationCtrl.SubmitButton' | translate}}</button> <span name=or>{{'Register.ResendActivationCtrl.Or' | translate}}</span> <a ui-sref=register.show>{{'Register.ResendActivationCtrl.Cancel' | translate}}</a></div></form>")}]),angular.module("scripts/user/templates/terms.tpl.html",[]).run(["$templateCache",function(a){a.put("scripts/user/templates/terms.tpl.html","<div ng-controller=RegisterCtrl><div class=modal-header><h2>{{'Register.RegisterCtrl.UserAgreement' | translate}}</h2></div><div class=modal-body><div data-ng-include data-src=\"'scripts/policies/templates/terms.tpl.html'\"></div></div><div class=modal-footer><button class=\"btn btn-primary cancel\" ng-click=close() name=modalClose>{{'Register.RegisterCtrl.Close' | translate}}</button></div></div>")
}]),angular.module("templates/404.tpl.html",[]).run(["$templateCache",function(a){a.put("templates/404.tpl.html","<div class=\"container withHeader\"><h1>Not found <span>:(</span></h1><p>Sorry, but the page you were trying to view does not exist.</p><p>It looks like this was the result of either:</p><ul><li>a mistyped address</li><li>an out-of-date link</li></ul><script>var GOOG_FIXURL_LANG = (navigator.language || '').slice(0,2),GOOG_FIXURL_SITE = location.host;</script><script src=//linkhelp.clients.google.com/tbproxy/lh/wm/fixurl.js></script></div>")}]),angular.module("templates/500.tpl.html",[]).run(["$templateCache",function(a){a.put("templates/500.tpl.html",'<div class="container withHeader"><h1>Computer says No <span>:(</span></h1><p>Sorry, but the something went wrong.</p><p>We\'ll get right on top of that now.</p></div>')}]),angular.module("templates/main.tpl.html",[]).run(["$templateCache",function(a){a.put("templates/main.tpl.html","<p>This is the main page</p>")}]),angular.module("security",["security.service","security.interceptor","security.authorization"]),angular.module("security.authorization",["security.service"]).provider("securityAuthorization",{requireAdminUser:["securityAuthorization",function(a){return a.requireAdminUser()}],requireAuthenticatedUser:["securityAuthorization",function(a){return a.requireAuthenticatedUser()}],$get:["security","securityRetryQueue",function(a,b){var c={requireAuthenticatedUser:function(){var d=a.requestCurrentUser().then(function(){return a.isAuthenticated()?void 0:b.pushRetryFn("unauthenticated-client",c.requireAuthenticatedUser)});return d},requireAdminUser:function(){var d=a.requestCurrentUser().then(function(){return a.isAdmin()?void 0:b.pushRetryFn("unauthorized-client",c.requireAdminUser)});return d}};return c}]}),angular.module("security.interceptor",["security.retryQueue"]).factory("securityInterceptor",["$injector","securityRetryQueue",function(a,b){return function(c){return c.then(null,function(d){return 401===d.status&&(c=b.pushRetryFn("unauthorized-server",function(){return a.get("$http")(d.config)})),c})}}]).config(["$httpProvider",function(a){a.responseInterceptors.push("securityInterceptor")}]);var apiVersion;angular.module("security.service",["security.retryQueue","security.loginToolbar","security.loginCtrl","ui.bootstrap.modal","config"]).factory("security",["$http","$q","securityRetryQueue","$modal","$state","server","api",function(a,b,c,d,e,f,g){function h(){var a=d.open({templateUrl:"scripts/security/templates/loginFormModal.tpl.html",controller:"LoginFormCtrl"});a.result.then(function(){c.retryAll(),("register"===e.current.name.substring(0,8)||"login"===e.current.name)&&e.go("home")},function(){c.hasMore()&&(c.cancelAll(),e.go("register.show"))})}apiVersion=f+g,c.onItemAddedCallbacks.push(function(){c.hasMore()&&i.showLogin()});var i={getLoginReason:function(){return c.retryReason()},showLogin:function(){h()},login:function(b,c,d){var e=a.post(apiVersion+"/user/login",{email:b.email,password:b.password,rememberMe:b.rememberMe},{tracker:d});return e.then(function(a){i.currentUser=a.data,i.isAuthenticated()&&c.close(!0)})},cancelLogin:function(a){a.dismiss("cancel")},logout:function(b){a.get(apiVersion+"/user/logout").then(function(){i.currentUser=null,e.go(b)})},requestCurrentUser:function(c){return!i.isAuthenticated()||c&&c.force?a.get(apiVersion+"/user/current-user").then(function(a){return i.currentUser=a.data&&(a.data._id||0===a.data._id)?a.data:null,i.currentUser},function(){return i.currentUser=null,i.currentUser}):b.when(i.currentUser)},currentUser:null,isAuthenticated:function(){return!!i.currentUser},isAdmin:function(){return!(!i.currentUser||!i.currentUser.admin)}};return i}]),angular.module("security.retryQueue",[]).factory("securityRetryQueue",["$q","$log",function(a,b){var c=[],d={onItemAddedCallbacks:[],hasMore:function(){return c.length>0},push:function(a){c.push(a),angular.forEach(d.onItemAddedCallbacks,function(c){try{c(a)}catch(d){b.error("securityRetryQueue.push(retryItem): callback threw an error"+d)}})},pushRetryFn:function(b,c){1===arguments.length&&(c=b,b=void 0);var e=a.defer(),f={reason:b,retry:function(){a.when(c()).then(function(a){e.resolve(a)},function(a){e.reject(a)})},cancel:function(){e.reject()}};return d.push(f),e.promise},retryReason:function(){return d.hasMore()&&c[0].reason},cancelAll:function(){for(;d.hasMore();)c.shift().cancel()},retryAll:function(){for(;d.hasMore();)c.shift().retry()}};return d}]),angular.module("security.loginCtrl",[]).controller("LoginFormCtrl",["$scope","$state","security","titleService","$window","$modalInstance","$translate","growl","server","api",function(a,b,c,d,e,f,g,h,i,j){function k(){a.content={title:g("Login.LoginCtrl.Title")},d.setTitle(a.content.title)}k(),a.$on("$translateChangeSuccess",function(){k()}),a.user={},a.authReason=null,c.getLoginReason()&&(a.authReason=g(c.isAuthenticated()?"Login.Error.NotAuthorised":"Login.Error.NotAuthenticated")),a.submitted=!1,a.login=function(b){a.submitted=!0,b.$invalid||c.login(a.user,f).then(function(b){a.submitted=!1,c.currentUser||(b&&b.data?h.addServerMessages(b.data):h.addErrorMessage(g("Login.Error.LoginFailed")))},function(b){b.data?("Login.Error.NotActive"===b.data.code&&(a.showResendActivation=!0),h.addServerMessages(b.data)):h.addErrorMessage(g("Login.Error.LoginFailed")),a.user.password=null})},a.oAuth=function(a){e.location.href=i+j+"/auth/"+a},a.cancelLogin=function(){c.cancelLogin(f),a.user={}}}]),angular.module("security.loginToolbar",[]).directive("loginToolbar",["security",function(a){return{templateUrl:"scripts/security/templates/loginToolbar.tpl.html",restrict:"E",replace:!0,scope:!0,link:function(b){b.login=a.showLogin,b.logout=a.logout,b.$watch(function(){return a.currentUser},function(a){b.currentUser=a}),b.accountNavOpen=!1,b.$on("$stateChangeStart",function(){b.accountNavOpen=!1})}}}]),angular.module("services.titleService",[]).factory("titleService",["$document",function(a){var b,c,d,e={setSuffix:function(a){b=a},getSuffix:function(){return b},setPrefix:function(a){c=a},getPrefix:function(){return c},setTitle:function(e){d=angular.isDefined(b)?e+" "+b:angular.isDefined(c)?c+" "+e:e,a.prop("title",d)},getTitle:function(){return a.prop("title")}};return e}]),angular.module("services.referenceData",[]).factory("referenceData",function(){this.genders=[{name:"ReferenceData.Genders.Male",value:"male"},{name:"ReferenceData.Genders.Female",value:"female"}],this.months=[{name:"ReferenceData.Months.January",value:0},{name:"ReferenceData.Months.February",value:1},{name:"ReferenceData.Months.March",value:2},{name:"ReferenceData.Months.April",value:3},{name:"ReferenceData.Months.May",value:4},{name:"ReferenceData.Months.June",value:5},{name:"ReferenceData.Months.July",value:6},{name:"ReferenceData.Months.August",value:7},{name:"ReferenceData.Months.September",value:8},{name:"ReferenceData.Months.October",value:9},{name:"ReferenceData.Months.November",value:10},{name:"ReferenceData.Months.December",value:11}],this.livingValues=[{name:"ReferenceData.LivingValues.Alive",value:!0},{name:"ReferenceData.LivingValues.Deceased",value:!1}],this.factTypes=[{value:"birth",name:"ReferenceData.FactTypes.Birth",relType:"person",category:"ReferenceData.FactTypes.Categories.Personal",primary:!0,showDate:!0,showValue:!1,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!0,unique:!0,order:1},{value:"ethnicity",name:"ReferenceData.FactTypes.Ethnicity",relType:"person",category:"ReferenceData.FactTypes.Categories.Personal",primary:!0,showDate:!1,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Ethnicity",showPlace:!1,unique:!0,order:2},{value:"religion",name:"ReferenceData.FactTypes.Religion",relType:"person",category:"ReferenceData.FactTypes.Categories.Personal",primary:!0,showDate:!1,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Religion",showPlace:!1,unique:!1,order:3},{value:"nationality",name:"ReferenceData.FactTypes.Nationality",relType:"person",category:"ReferenceData.FactTypes.Categories.Personal",primary:!0,showDate:!1,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Nationality",showPlace:!1,unique:!1,order:4},{value:"residence",name:"ReferenceData.FactTypes.Residence",relType:"person",category:"ReferenceData.FactTypes.Categories.Personal",primary:!0,showDate:!0,showValue:!1,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!0,unique:!1,order:5},{value:"adoption",name:"ReferenceData.FactTypes.Adoption",relType:"person",category:"ReferenceData.FactTypes.Categories.Personal",primary:!0,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!1,order:6},{value:"nationalId",name:"ReferenceData.FactTypes.NationalId",relType:"person",category:"ReferenceData.FactTypes.Categories.Personal",primary:!1,showDate:!1,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!1,order:7},{value:"occupation",name:"ReferenceData.FactTypes.Occupation",relType:"person",category:"ReferenceData.FactTypes.Categories.Personal",primary:!1,showDate:!1,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Occupation",showPlace:!1,unique:!1,order:8},{value:"physicalDescription",name:"ReferenceData.FactTypes.PhysicalDescription",relType:"person",category:"ReferenceData.FactTypes.Categories.Personal",primary:!1,showDate:!1,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.PhysicalDescription",showPlace:!1,unique:!1,order:9},{value:"multipleBirth",name:"ReferenceData.FactTypes.MultipleBirth",relType:"person",category:"ReferenceData.FactTypes.Categories.Personal",primary:!1,showDate:!1,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:10},{value:"medical",name:"ReferenceData.FactTypes.Medical",relType:"person",category:"ReferenceData.FactTypes.Categories.Personal",primary:!1,showDate:!1,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!1,order:11},{value:"retirement",name:"ReferenceData.FactTypes.Retirement",relType:"person",category:"ReferenceData.FactTypes.Categories.Personal",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Retirement",showPlace:!1,unique:!1,order:12},{value:"death",name:"ReferenceData.FactTypes.Death",relType:"person",category:"ReferenceData.FactTypes.Categories.Death",primary:!0,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.CauseOfDeath",showPlace:!0,unique:!0,order:13},{value:"burial",name:"ReferenceData.FactTypes.Burial",relType:"person",category:"ReferenceData.FactTypes.Categories.Death",primary:!0,showDate:!0,showValue:!1,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!0,unique:!0,order:14},{value:"will",name:"ReferenceData.FactTypes.Will",relType:"person",category:"ReferenceData.FactTypes.Categories.Death",primary:!1,showDate:!1,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:15},{value:"funeral",name:"ReferenceData.FactTypes.Funeral",relType:"person",category:"ReferenceData.FactTypes.Categories.Death",primary:!1,showDate:!0,showValue:!1,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:16},{value:"cremation",name:"ReferenceData.FactTypes.Cremation",relType:"person",category:"ReferenceData.FactTypes.Categories.Death",primary:!1,showDate:!0,showValue:!1,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:17},{value:"stillbirth",name:"ReferenceData.FactTypes.Stillbirth",relType:"person",category:"ReferenceData.FactTypes.Categories.Death",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:18},{value:"baptism",name:"ReferenceData.FactTypes.Baptism",relType:"person",category:"ReferenceData.FactTypes.Categories.Religious",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:27},{value:"circumcision",name:"ReferenceData.FactTypes.Circumcision",relType:"person",category:"ReferenceData.FactTypes.Categories.Religious",primary:!1,showDate:!0,showValue:!1,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:28},{value:"christening",name:"ReferenceData.FactTypes.Christening",relType:"person",category:"ReferenceData.FactTypes.Categories.Religious",primary:!0,showDate:!0,showValue:!1,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!0,unique:!0,order:29},{value:"firstCommunion",name:"ReferenceData.FactTypes.FirstCommunion",relType:"person",category:"ReferenceData.FactTypes.Categories.Religious",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:30},{value:"barMitzvah",name:"ReferenceData.FactTypes.BarMitzvah",relType:"person",category:"ReferenceData.FactTypes.Categories.Religious",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!0,unique:!0,order:31},{value:"batMitzvah",name:"ReferenceData.FactTypes.BatMitzvah",relType:"person",category:"ReferenceData.FactTypes.Categories.Religious",primary:!1,showDate:!1,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:32},{value:"confirmation",name:"ReferenceData.FactTypes.Confirmation",relType:"person",category:"ReferenceData.FactTypes.Categories.Religious",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:33},{value:"adultChristening",name:"ReferenceData.FactTypes.AdultChristening",relType:"person",category:"ReferenceData.FactTypes.Categories.Religious",primary:!1,showDate:!0,showValue:!1,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!0,unique:!0,order:34},{value:"blessing",name:"ReferenceData.FactTypes.Blessing",relType:"person",category:"ReferenceData.FactTypes.Categories.Religious",primary:!1,showDate:!0,showValue:!1,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!0,unique:!1,order:35},{value:"mission",name:"ReferenceData.FactTypes.Mission",relType:"person",category:"ReferenceData.FactTypes.Categories.Religious",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Mission",showPlace:!0,unique:!1,order:36},{value:"ordination",name:"ReferenceData.FactTypes.Ordination",relType:"person",category:"ReferenceData.FactTypes.Categories.Religious",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:37},{value:"probate",name:"ReferenceData.FactTypes.Probate",relType:"person",category:"ReferenceData.FactTypes.Categories.Religious",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:38},{value:"excommunication",name:"ReferenceData.FactTypes.Excommunication",relType:"person",category:"ReferenceData.FactTypes.Categories.Religious",primary:!1,showDate:!0,showValue:!1,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:39},{value:"census",name:"ReferenceData.FactTypes.Census",relType:"person",category:"ReferenceData.FactTypes.Categories.Other",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!0,unique:!1,order:40},{value:"property",name:"ReferenceData.FactTypes.Property",relType:"person",category:"ReferenceData.FactTypes.Categories.Other",primary:!1,showDate:!1,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Property",showPlace:!0,unique:!1,order:41},{value:"landTransaction",name:"ReferenceData.FactTypes.LandTransaction",relType:"person",category:"ReferenceData.FactTypes.Categories.Other",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!0,unique:!1,order:42},{value:"living",name:"ReferenceData.FactTypes.Living",relType:"person",category:"ReferenceData.FactTypes.Categories.Other",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!0,unique:!1,order:43},{value:"visit",name:"ReferenceData.FactTypes.Visit",relType:"person",category:"ReferenceData.FactTypes.Categories.Other",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Country",showPlace:!0,unique:!1,order:44},{value:"emigration",name:"ReferenceData.FactTypes.Emigration",relType:"person",category:"ReferenceData.FactTypes.Categories.Other",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Country",showPlace:!0,unique:!1,order:45},{value:"immigration",name:"ReferenceData.FactTypes.Immigration",relType:"person",category:"ReferenceData.FactTypes.Categories.Other",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Country",showPlace:!0,unique:!1,order:46},{value:"naturalization",name:"ReferenceData.FactTypes.Naturalization",relType:"person",category:"ReferenceData.FactTypes.Categories.Other",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Country",showPlace:!0,unique:!1,order:47},{value:"arrest",name:"ReferenceData.FactTypes.Arrest",relType:"person",category:"ReferenceData.FactTypes.Categories.Other",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!0,unique:!1,order:48},{value:"imprisonment",name:"ReferenceData.FactTypes.Imprisonment",relType:"person",category:"ReferenceData.FactTypes.Categories.Other",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!0,unique:!1,order:49},{value:"amnesty",name:"ReferenceData.FactTypes.Amnesty",relType:"person",category:"ReferenceData.FactTypes.Categories.Other",primary:!1,showDate:!0,showValue:!1,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!1,order:50},{value:"pardon",name:"ReferenceData.FactTypes.Pardon",relType:"person",category:"ReferenceData.FactTypes.Categories.Other",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!1,order:51},{value:"militaryDraftRegistration",name:"ReferenceData.FactTypes.MilitaryDraftRegistration",relType:"person",category:"ReferenceData.FactTypes.Categories.Military",primary:!1,showDate:!0,showValue:!1,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!1,order:52},{value:"militaryService",name:"ReferenceData.FactTypes.MilitaryService",relType:"person",category:"ReferenceData.FactTypes.Categories.Military",primary:!1,showDate:!0,showValue:!1,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!1,order:53},{value:"militaryInduction",name:"ReferenceData.FactTypes.MilitaryInduction",relType:"person",category:"ReferenceData.FactTypes.Categories.Military",primary:!1,showDate:!0,showValue:!1,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!1,order:54},{value:"militaryAward",name:"ReferenceData.FactTypes.MilitaryAward",relType:"person",category:"ReferenceData.FactTypes.Categories.Military",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.MilitaryAward",showPlace:!1,unique:!1,order:55},{value:"militaryDischarge",name:"ReferenceData.FactTypes.MilitaryDischarge",relType:"person",category:"ReferenceData.FactTypes.Categories.Military",primary:!1,showDate:!0,showValue:!1,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!1,order:56},{value:"education",name:"ReferenceData.FactTypes.Education",relType:"person",category:"ReferenceData.FactTypes.Categories.Education",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Education",showPlace:!1,unique:!1,order:57},{value:"apprenticeship",name:"ReferenceData.FactTypes.Apprenticeship",relType:"person",category:"ReferenceData.FactTypes.Categories.Education",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Apprenticeship",showPlace:!1,unique:!1,order:58},{value:"engagement",name:"ReferenceData.FactTypes.Engagement",relType:"couple",category:"Couple",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!0,unique:!0,order:62},{value:"other",name:"ReferenceData.FactTypes.Other",relType:"couple",category:"Couple",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:63},{value:"marriage",name:"ReferenceData.FactTypes.Marriage",relType:"couple",category:"Couple",primary:!0,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!0,unique:!0,order:64},{value:"marriageLicense",name:"ReferenceData.FactTypes.MarriageLicense",relType:"couple",category:"Couple",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:65},{value:"marriageContract",name:"ReferenceData.FactTypes.MarriageContract",relType:"couple",category:"Couple",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:66},{value:"marriageNotice",name:"ReferenceData.FactTypes.MarriageNotice",relType:"couple",category:"Couple",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:67},{value:"marriageBanns",name:"ReferenceData.FactTypes.MarriageBahns",relType:"couple",category:"Couple",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:68},{value:"commonLawMarriage",name:"ReferenceData.FactTypes.CommonLawMarriage",relType:"couple",category:"Couple",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:69},{value:"civilUnion",name:"ReferenceData.FactTypes.CivilUnion",relType:"couple",category:"Couple",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:70},{value:"domesticPartnership",name:"ReferenceData.FactTypes.DomesticPartnership",relType:"couple",category:"Couple",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:71},{value:"separation",name:"ReferenceData.FactTypes.Separation",relType:"couple",category:"Couple",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:72},{value:"divorce",name:"ReferenceData.FactTypes.Divorce",relType:"couple",category:"Couple",primary:!0,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:73},{value:"divorceFiling",name:"ReferenceData.FactTypes.DivorceFiling",relType:"couple",category:"Couple",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:74},{value:"annulment",name:"ReferenceData.FactTypes.Annulment",relType:"couple",category:"Couple",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:76},{value:"biologicalParent",name:"ReferenceData.FactTypes.BiologicalParent",relType:"parentChild",category:"ParentChild",primary:!1,showDate:!1,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:77},{value:"stepParent",name:"ReferenceData.FactTypes.StepParent",relType:"parentChild",category:"ParentChild",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:78},{value:"adoptiveParent",name:"ReferenceData.FactTypes.AdoptiveParent",relType:"parentChild",category:"ParentChild",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:79},{value:"guardianParent",name:"ReferenceData.FactTypes.GuardianParent",relType:"parentChild",category:"ParentChild",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:80},{value:"fosterParent",name:"ReferenceData.FactTypes.FosterParent",relType:"parentChild",category:"ParentChild",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:81},{value:"surrogateParent",name:"ReferenceData.FactTypes.SurrogateParent",relType:"parentChild",category:"ParentChild",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:82},{value:"sociologicalParent",name:"ReferenceData.FactTypes.SociologicalParent",relType:"parentChild",category:"ParentChild",primary:!1,showDate:!0,showValue:!0,valueName:"ReferenceData.FactTypes.ValueNames.Description",showPlace:!1,unique:!0,order:83}],this.factCategories=["ReferenceData.FactTypes.Categories.Personal","ReferenceData.FactTypes.Categories.Death","ReferenceData.FactTypes.Categories.Religious","ReferenceData.FactTypes.Categories.Education","ReferenceData.FactTypes.Categories.Military","ReferenceData.FactTypes.Categories.Other"],this.factQualifiers=[{name:"ReferenceData.FactQualifiers.Age",value:"age"},{name:"ReferenceData.FactQualifiers.Cause",value:"cause"},{name:"ReferenceData.FactQualifiers.Religion",value:"religion"}],this.nameTypes=[{name:"ReferenceData.NameTypes.BirthName",value:"birthName",order:1},{name:"ReferenceData.NameTypes.AdoptiveName",value:"adoptiveName",order:2},{name:"ReferenceData.NameTypes.AlsoKnownAs",value:"alsoKnownAs",order:3},{name:"ReferenceData.NameTypes.ReligiousName",value:"religiousName",order:4}],this.namePartTypes=[{name:"ReferenceData.NamePartTypes.Prefix",value:"prefix",order:1},{name:"ReferenceData.NamePartTypes.Given",value:"given",order:2},{name:"ReferenceData.NamePartTypes.Middle",value:"middle",order:3},{name:"ReferenceData.NamePartTypes.Surname",value:"surname",order:4},{name:"ReferenceData.NamePartTypes.Maiden",value:"maiden",order:5},{name:"ReferenceData.NamePartTypes.Suffix",value:"suffix",order:6},{name:"ReferenceData.NamePartTypes.Familiar",value:"familiar",order:7}],this.namePartQualifiers=[{name:"ReferenceData.NamePartQualifiers.Particle",value:"particle",order:1,partType:["prefix"]},{name:"ReferenceData.NamePartQualifiers.Title",value:"title",order:2,partType:["prefix","suffix"]},{name:"ReferenceData.NamePartQualifiers.Primary",value:"primary",order:3,partType:["given"]},{name:"ReferenceData.NamePartQualifiers.Secondary",value:"secondary",order:4,partType:["given"]},{name:"ReferenceData.NamePartQualifiers.Postnom",value:"postnom",order:5,partType:["given"]},{name:"ReferenceData.NamePartQualifiers.Middle",value:"middle",order:6,partType:["middle"]},{name:"ReferenceData.NamePartQualifiers.Familiar",value:"familiar",order:7,partType:["familiar"]},{name:"ReferenceData.NamePartQualifiers.Family",value:"family",order:8,partType:["surname"]},{name:"ReferenceData.NamePartQualifiers.Religious",value:"religious",order:9,partType:["surname","middle"]},{name:"ReferenceData.NamePartQualifiers.Patronymic",value:"patronymic",order:10,partType:["surname"]},{name:"ReferenceData.NamePartQualifiers.Matronymic",value:"matronymic",order:11,partType:["surname"]},{name:"ReferenceData.NamePartQualifiers.Geographic",value:"geographic",order:12,partType:["surname"]},{name:"ReferenceData.NamePartQualifiers.Occupational",value:"occupational",order:13,partType:["surname"]},{name:"ReferenceData.NamePartQualifiers.Characteristic",value:"characteristic",order:14,partType:["surname"]},{name:"ReferenceData.NamePartQualifiers.Maiden",value:"maiden",order:15,partType:["maiden"]}],this.relationshipTypes=[{name:"ReferenceData.RelationshipTypes.Couple",value:"couple"},{name:"ReferenceData.RelationshipTypes.ParentChild",value:"parentChild"}],this.detailedRelationshipTypes=[{name:"ReferenceData.DetailedRelationshipTypes.Mother",value:"mother",order:1,category:"ReferenceData.DetailedRelationshipTypes.Categories.Parent",relType:"parentChild",gender:"female",personType:"parent"},{name:"ReferenceData.DetailedRelationshipTypes.Father",value:"father",order:2,category:"ReferenceData.DetailedRelationshipTypes.Categories.Parent",relType:"parentChild",gender:"male",personType:"parent"},{name:"ReferenceData.DetailedRelationshipTypes.Son",value:"son",order:3,category:"ReferenceData.DetailedRelationshipTypes.Categories.Child",relType:"parentChild",gender:"male",personType:"child"},{name:"ReferenceData.DetailedRelationshipTypes.Daughter",value:"daughter",order:4,category:"ReferenceData.DetailedRelationshipTypes.Categories.Child",relType:"parentChild",gender:"female",personType:"child"},{name:"ReferenceData.DetailedRelationshipTypes.Brother",value:"brother",order:5,category:"ReferenceData.DetailedRelationshipTypes.Categories.Sibling",relType:"parentChild",gender:"male",personType:"sibling"},{name:"ReferenceData.DetailedRelationshipTypes.Sister",value:"sister",order:6,category:"ReferenceData.DetailedRelationshipTypes.Categories.Sibling",relType:"parentChild",gender:"female",personType:"sibling"},{name:"ReferenceData.DetailedRelationshipTypes.Wife",value:"wife",order:7,category:"ReferenceData.DetailedRelationshipTypes.Categories.Partner",relType:"couple",gender:"female",personType:"couple",startDateName:"ReferenceData.DetailedRelationshipTypes.Dates.StartDateMarriage"},{name:"ReferenceData.DetailedRelationshipTypes.Husband",value:"husband",order:8,category:"ReferenceData.DetailedRelationshipTypes.Categories.Partner",relType:"couple",gender:"male",personType:"couple",startDateName:"ReferenceData.DetailedRelationshipTypes.Dates.StartDateMarriage"},{name:"ReferenceData.DetailedRelationshipTypes.Partner",value:"partner",order:9,category:"ReferenceData.DetailedRelationshipTypes.Categories.Partner",relType:"couple",personType:"couple",startDateName:"ReferenceData.DetailedRelationshipTypes.Dates.StartDateRelationship"},{name:"ReferenceData.DetailedRelationshipTypes.ExWife",value:"exWife",order:10,category:"ReferenceData.DetailedRelationshipTypes.Categories.Ex-Partner",relType:"couple",gender:"female",personType:"couple",startDateName:"ReferenceData.DetailedRelationshipTypes.Dates.StartDateMarriage",endDateName:"ReferenceData.DetailedRelationshipTypes.Dates.EndDateMarriage"},{name:"ReferenceData.DetailedRelationshipTypes.ExHusband",value:"exHusband",order:11,category:"ReferenceData.DetailedRelationshipTypes.Categories.Ex-Partner",relType:"couple",gender:"male",personType:"couple",startDateName:"ReferenceData.DetailedRelationshipTypes.Dates.StartDateMarriage",endDateName:"ReferenceData.DetailedRelationshipTypes.Dates.EndDateMarriage"},{name:"ReferenceData.DetailedRelationshipTypes.ExPartner",value:"exPartner",order:12,category:"ReferenceData.DetailedRelationshipTypes.Categories.Ex-Partner",relType:"couple",personType:"couple",startDateName:"ReferenceData.DetailedRelationshipTypes.Dates.StartDateRelationship",endDateName:"ReferenceData.DetailedRelationshipTypes.Dates.EndDateRelationship"}],this.relationshipTypeQualifiers=[{name:"ReferenceData.RelationshipTypeQualifiers.CivilUnion",value:"civilUnion",order:1,relTypes:["partner","exPartner"]},{name:"ReferenceData.RelationshipTypeQualifiers.DomesticPartnership",value:"domesticPartnership",order:2,relTypes:["partner","exPartner"]},{name:"ReferenceData.RelationshipTypeQualifiers.CommonLawMarriage",value:"commonLawMarriage",order:3,relTypes:["partner","exPartner"]},{name:"ReferenceData.RelationshipTypeQualifiers.Engagement",value:"engagement",order:4,relTypes:["partner","exPartner"]},{name:"ReferenceData.RelationshipTypeQualifiers.Other",value:"other",order:5,relTypes:["partner","exPartner"]},{name:"ReferenceData.RelationshipTypeQualifiers.Marriage",value:"marriage",order:6,relTypes:["wife","husband","exWife","exHusband"]},{name:"ReferenceData.RelationshipTypeQualifiers.BiologicalParent",value:"biologicalParent",order:7,relTypes:["mother","father","son","daughter"]},{name:"ReferenceData.RelationshipTypeQualifiers.StepParent",value:"stepParent",order:8,relTypes:["mother","father","son","daughter"]},{name:"ReferenceData.RelationshipTypeQualifiers.AdoptiveParent",value:"adoptiveParent",order:9,relTypes:["mother","father","son","daughter"]},{name:"ReferenceData.RelationshipTypeQualifiers.GuardianParent",value:"guardianParent",order:10,relTypes:["mother","father","son","daughter"]},{name:"ReferenceData.RelationshipTypeQualifiers.FosterParent",value:"fosterParent",order:11,relTypes:["mother","father","son","daughter"]},{name:"ReferenceData.RelationshipTypeQualifiers.SurrogateParent",value:"surrogateParent",order:12,relTypes:["mother","father","son","daughter"]},{name:"ReferenceData.RelationshipTypeQualifiers.SociologicalParent",value:"sociologicalParent",order:13,relTypes:["mother","father","son","daughter"]}];
var a=this;return{get:function(b){return a[b]}}}),angular.module("rorymadden.languages",["pascalprecht.translate"]).factory("languages",["$window","security","$translate",function(a,b,c){this.langs={attribute:{name:0,nativeName:1},rtl:{ar:1,dv:1,fa:1,ha:1,he:1,ks:1,ku:1,ps:1,ur:1,yi:1},lang:["aa","ab","af","ak","am","an","ar","as","av","ay","az","ba","be","bg","bh","bi","bm","bn","bo","br","bs","ca","ce","ch","co","cr","cs","cu","cv","cy","da","de","dv","dz","ee","el","en","eo","es","et","eu","fa","ff","fi","fj","fo","fr","fy","ga","gd","gl","gn","gu","gv","ha","he","hi","ho","hr","ht","hu","hy","hz","ia","id","ie","ig","ii","ik","io","is","it","iu","ja","jv","ka","kg","ki","kj","kk","kl","km","kn","ko","kr","ks","ku","kv","kw","ky","la","lb","lg","li","ln","lo","lt","lv","mg","mh","mi","mk","ml","mn","mo","mr","ms","mt","my","na","nd","ne","ng","nl","nn","no","nr","nv","ny","oc","oj","om","or","os","pa","pi","pl","ps","pt","qu","rm","rn","ro","ru","rw","sa","sc","sd","se","sg","sh","si","sk","sl","sm","sn","so","sq","sr","ss","st","su","sv","sw","ta","te","tg","th","ti","tk","tl","tn","to","tr","ts","tt","tw","ty","ug","uk","ur","uz","ve","vi","vo","wa","wo","xh","yi","yo","za","zh","zu"]};var d=this;return{isValid:function(a){return-1!==d.langs.lang.indexOf(a)},getAllLanguageCodes:function(){var a=[];return angular.forEach(d.langs.lang,function(b){a.push({code:b,name:c("LanguagesService."+b)})}),a.sort(function(a,b){var c=a.name.toLowerCase(),d=b.name.toLowerCase();return d>c?-1:c>d?1:0}),a},parseLanguage:function(a){return-1!==a.indexOf("-")?a.slice(0,a.indexOf("-")):-1!==a.indexOf("_")?a.slice(0,a.indexOf("_")):a},getBrowserLanguage:function(){return this.parseLanguage(a.navigator.language)},getUserLanguage:function(){var a=b.currentUser;return a?this.parseLanguage(a.locale):this.getBrowserLanguage()},getLanguageArray:function(a){var b=this,c=[];return angular.forEach(a,function(a){var d=b.parseLanguage(a.lang);-1===c.indexOf(d)&&c.push(d)}),c},getDefaultLanguage:function(a,b){return-1!==b.indexOf(a)?a:-1!==b.indexOf("en")?"en":b[0]},getDefaultLangValue:function(a,b,c){var d,e,f,g,h=this,i=this.getUserLanguage(),j=h.getLanguageArray(a),k=h.getDefaultLanguage(i,j);return b&&(f=Object.keys(b)[0],g=b[f]),angular.forEach(a,function(a){var b=h.parseLanguage(a.lang);if(!f||f&&a[f]===g){var i=c?a[c]:a;e||(e=i),b===k&&(d=i)}}),d?d:e}}}]).filter("langName",["languages",function(a){return function(b){var c=a.parseLanguage(b);return a.isValid(c)?"LanguagesService."+c:"Invalid Language"}}]),angular.module("rorymadden.confirmModal",["ui.bootstrap"]).factory("rsmConfirmModal",["$modal",function(a){var b,c={open:function(c,d,e){return e||(e=angular.noop),b=a.open({templateUrl:"scripts/common/services/confirmModal/templates/confirmModal.tpl.html",controller:"rsmConfirmModalCtrl",resolve:{options:function(){return c},ok:function(){return d},cancel:function(){return e}}})}};return c}]).controller("rsmConfirmModalCtrl",["$scope","$modalInstance","options","ok","cancel",function(a,b,c,d,e){"Unsaved"===c.action&&(a.content="rsmConfirmModal.Unsaved"),"Remove"===c.action&&(a.content="rsmConfirmModal.Remove",a.type=c.type),a.ok=function(){b.close(),d()},a.cancel=function(){b.dismiss("cancel"),e()}}]),angular.module("rorymadden.dateUtils",["services.referenceData"]).factory("rsmDateUtils",["referenceData",function(a){function b(a,b){var c=new Date(Date.UTC(a[b.year],a[b.month],a[b.day]));return c&&c.getMonth()===a[b.month]&&c.getDate()===Number(a[b.day])}function c(a,b){return a[b.day]>28?(a[b.day]--,a):a.month>11?(a[b.day]=31,a[b.month]--,a):void 0}var d=this;return this.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],this.months=a.get("months"),this.dateParts={day:"ReferenceData.DateParts.Day",month:"ReferenceData.DateParts.Month",year:"ReferenceData.DateParts.Year"},{checkDate:function(a,d){return a[d.day]&&a[d.month]&&a[d.year]?b(a,d)?a:void this.checkDate(c(a,d),d):!1},get:function(a){return d[a]}}}]),angular.module("policies",[]).controller("PoliciesTermsCtrl",["$scope","$translate","titleService",function(a,b,c){function d(){a.content={title:b("Policies.PoliciesCtrl.Terms")},c.setTitle(a.content.title)}d(),a.$on("$translateChangeSuccess",function(){d()})}]).controller("PoliciesPrivacyCtrl",["$scope","$translate","titleService",function(a,b,c){function d(){a.content={title:b("Policies.PoliciesCtrl.Privacy")},c.setTitle(a.content.title)}d(),a.$on("$translateChangeSuccess",function(){d()})}]).controller("PoliciesLicensingCtrl",["$scope","$translate","titleService",function(a,b,c){function d(){a.content={title:b("Policies.PoliciesCtrl.Licensing")},c.setTitle(a.content.title)}d(),a.$on("$translateChangeSuccess",function(){d()})}]).controller("PoliciesGuidelinesCtrl",["$scope","$translate","titleService",function(a,b,c){function d(){a.content={title:b("Policies.PoliciesCtrl.Guidelines")},c.setTitle(a.content.title)}d(),a.$on("$translateChangeSuccess",function(){d()})}]).controller("PoliciesDisputesCtrl",["$scope","$translate","titleService",function(a,b,c){function d(){a.content={title:b("Policies.PoliciesCtrl.Disputes")},c.setTitle(a.content.title)}d(),a.$on("$translateChangeSuccess",function(){d()})}]).config(["$stateProvider",function(a){a.state("policies",{url:"/policies","abstract":!0,templateUrl:"scripts/policies/templates/policies.tpl.html"}).state("policies.terms",{url:"/terms",templateUrl:"scripts/policies/templates/terms.tpl.html",controller:"PoliciesTermsCtrl"}).state("policies.privacy",{url:"/privacy",templateUrl:"scripts/policies/templates/privacy.tpl.html",controller:"PoliciesPrivacyCtrl"}).state("policies.licensing",{url:"/licensing",templateUrl:"scripts/policies/templates/licensing.tpl.html",controller:"PoliciesLicensingCtrl"}).state("policies.guidelines",{url:"/guidelines",templateUrl:"scripts/policies/templates/guidelines.tpl.html",controller:"PoliciesGuidelinesCtrl"})}]),angular.module("user",["user.account","user.register","user.directives","user.profile"]);var apiVersion,accountModule=angular.module("user.account",["config"]);accountModule.controller("AccountCtrl",["$scope","security","server","api",function(a,b,c,d){apiVersion=c+d,b.requestCurrentUser().then(function(b){a.account=angular.copy(b)}),a.$on("UserUpdateCancelled",function(b,c){a.account=c})}]),accountModule.controller("AccountViewCtrl",["$scope","$http","growl","titleService","security","referenceData","$translate",function(a,b,c,d,e,f,g){function h(){a.content={title:g("Account.AccountViewCtrl.Title")},d.setTitle(a.content.title),a.genders=f.get("genders")}h(),a.$on("$translateChangeSuccess",function(){h()});var i;a.editable=!1,a.edit=function(){i=angular.copy(a.account),a.editable=!0},a.cancelEdit=function(){a.editable=!1,a.$emit("UserUpdateCancelled",i)},a.submitted=!1,a.update=function(d){a.submitted=!0,d.$invalid||b.put(apiVersion+"/account",a.account).success(function(){a.submitted=!1,c.addSuccessMessage("Account.AccountViewCtrl.AccountUpdated"),delete a.account.password,e.currentUser=angular.copy(a.account),a.editable=!1}).error(function(b){a.account.password=null,c.addServerMessages(b)})}}]),accountModule.controller("AccountPasswordCtrl",["$scope","$http","growl","titleService","$translate",function(a,b,c,d,e){function f(){a.content={title:e("Account.AccountPasswordCtrl.Title")},d.setTitle(a.content.title)}f(),a.$on("$translateChangeSuccess",function(){f()}),a.password={},a.submitted=!1,a.update=function(d){a.submitted=!0,d.$invalid||b.put(apiVersion+"/account/editPassword",a.password).success(function(){a.password={},a.submitted=!1,c.addSuccessMessage("Account.AccountPasswordCtrl.PasswordUpdated")}).error(function(b){a.password={},c.addServerMessages(b)})},a.sent=!1,a.sendPasswordLink=function(d){b.post(apiVersion+"/user/forgotPassword",{email:d}).success(function(){a.sent=!0,c.addSuccessMessage("Account.AccountPasswordCtrl.PasswordLinkSent")}).error(function(a){c.addServerMessages(a)})}}]),accountModule.config(["$stateProvider","securityAuthorizationProvider",function(a,b){a.state("account",{url:"/account",resolve:{auth:b.requireAuthenticatedUser},"abstract":!0,templateUrl:"scripts/user/templates/account.tpl.html",controller:"AccountCtrl"}).state("account.show",{url:"",templateUrl:"scripts/user/templates/accountShow.tpl.html",controller:"AccountViewCtrl"}).state("account.editPassword",{url:"/editPassword",templateUrl:"scripts/user/templates/accountPassword.tpl.html",controller:"AccountPasswordCtrl"})}]);var apiVersion,registerModule=angular.module("user.register",["ui.bootstrap.modal","config"]);registerModule.controller("RegisterCtrl",["$scope","$http","growl","titleService","$modal","$window","$state","$translate","referenceData","rsmDateUtils","$stateParams","server","api",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){a.content={title:h("Register.RegisterCtrl.Title")},d.setTitle(a.content.title)}apiVersion=l+m,a.user={},a.genders=i.get("genders"),a.user.firstName=k.firstName,a.user.lastName=k.lastName,a.user.email=k.email,a.user.gender=k.gender,k.birthday&&(a.birthdayField={startDateYear:new Date(+k.birthday).getUTCFullYear(),startDateMonth:new Date(+k.birthday).getUTCMonth(),startDateDay:new Date(+k.birthday).getUTCDate()}),n(),a.$on("$translateChangeSuccess",function(){n()}),a.translate=h,a.days=j.get("days"),a.months=j.get("months"),a.checkDate=function(a){var b={year:"startDateYear",month:"startDateMonth",day:"startDateDay"},c=j.checkDate(a,b);c&&(a=c)},a.submitted=!1,a.registerUser=function(d){a.submitted=!0,!d.$invalid&&a.birthdayField&&a.birthdayField.startDateYear&&a.birthdayField.startDateMonth&&a.birthdayField.startDateDay&&(a.user.birthday=Date.UTC(a.birthdayField.startDateYear,a.birthdayField.startDateMonth,a.birthdayField.startDateDay),b.post(apiVersion+"/user/register",a.user).success(function(){g.go("register.checkEmail")}).error(function(a){c.addServerMessages(a)}))},a.oAuth=function(a){f.location.href=l+"/auth/"+a},a.terms=function(){e.open({templateUrl:"scripts/user/templates/terms.tpl.html",controller:["$scope","$modalInstance",function(a,b){a.ok=function(){b.close(!0)},a.close=function(){b.dismiss("cancel")}}]})}}]),registerModule.controller("ResendActivationCtrl",["$scope","$http","growl","titleService","$state","$translate",function(a,b,c,d,e,f){function g(){a.content={title:f("Register.ResendActivationCtrl.Title")},d.setTitle(a.content.title)}a.user={},g(),a.$on("$translateChangeSuccess",function(){g()}),a.submitted=!1,a.resendActivation=function(d){a.submitted=!0,d.$invalid||b.post(apiVersion+"/user/resendActivation",a.user).success(function(){a.submitted=!1,e.go("home"),c.addSuccessMessage("Register.ResendActivationCtrl.ActivationKeySent"),a.user={}}).error(function(a){c.addServerMessages(a)})}}]),registerModule.controller("ForgotPasswordCtrl",["$scope","$http","$state","growl","titleService","$translate",function(a,b,c,d,e,f){function g(){a.content={title:f("Register.ForgotPasswordCtrl.Title")},e.setTitle(a.content.title)}a.user={},g(),a.$on("$translateChangeSuccess",function(){g()}),a.submitted=!1,a.forgotPassword=function(e){a.submitted=!0,e.$invalid||b.post(apiVersion+"/user/forgotPassword",a.user).success(function(){a.submitted=!1,d.addSuccessMessage("Register.ForgotPasswordCtrl.ResetLinkSent"),a.user={}}).error(function(b){a.user={},c.go("register.show"),d.addServerMessages(b)})}}]),registerModule.controller("ChangeForgottenPwdCtrl",["$scope","$http","$state","$stateParams","growl","titleService","security","$translate",function(a,b,c,d,e,f,g,h){function i(){a.content={title:h("Register.ChangeForgottenPasswordCtrl.Title")},f.setTitle(a.content.title)}a.user={},i(),a.$on("$translateChangeSuccess",function(){i()}),a.submitted=!1,a.changeForgottenPassword=function(f){a.submitted=!0,f.$invalid||(a.user.user_id=d.user_id,a.user.passwordResetKey=d.passwordResetKey,b.post(apiVersion+"/user/resetPassword",a.user).success(function(){a.submitted=!1,c.go("home"),g.requestCurrentUser(!0),e.addSuccessMessage("Register.ChangeForgottenPasswordCtrl.PasswordUpdated")}).error(function(a){e.addServerMessages(a)}))}}]),registerModule.ensureAnonymous={authenticated:["security","$state","$q",function(a,b,c){var d=c.defer();return a.requestCurrentUser().then(function(a){a&&b.go("home"),d.resolve()}),d.promise}]},registerModule.validatePasswordReset={redirect:["$stateParams","$state","$q","growl","$http",function(a,b,c,d,e){e.post(apiVersion+"/user/validatePasswordReset",a).success(function(){return!0}).error(function(a){return b.go("register.forgotPassword"),d.addServerMessages(a),!0})}]},registerModule.activate={activate:["$http","growl","$state","$stateParams",function(a,b,c,d){a.post(apiVersion+"/user/activate",{activationKey:d.activationKey}).success(function(){return b.addSuccessMessage("Register.Activate.Success"),c.go("home"),!0}).error(function(a){return c.go("register.resendActivation"),b.addServerMessages(a),!0})}]},registerModule.config(["$stateProvider",function(a){a.state("register",{url:"/register",resolve:registerModule.ensureAnonymous,"abstract":!0,templateUrl:"scripts/user/templates/register.tpl.html"}).state("register.show",{url:"?firstName&lastName&gender&email&birthday",templateUrl:"scripts/user/templates/registerShow.tpl.html",controller:"RegisterCtrl"}).state("register.forgotPassword",{url:"/forgotPassword",templateUrl:"scripts/user/templates/forgotPassword.tpl.html",controller:"ForgotPasswordCtrl"}).state("register.resendActivation",{url:"/resendActivation",templateUrl:"scripts/user/templates/resendActivation.tpl.html",controller:"ResendActivationCtrl"}).state("register.resetPassword",{url:"/resetPassword/:user_id/:passwordResetKey",templateUrl:"scripts/user/templates/changeForgottenPassword.tpl.html",controller:"ChangeForgottenPwdCtrl",resolve:registerModule.validatePasswordReset}).state("register.checkEmail",{url:"/awaitingEmailVerification",templateUrl:"scripts/user/templates/checkEmail.tpl.html"}).state("register.activate",{url:"/:activationKey",resolve:registerModule.activate})}]),angular.module("user.directives",[]).directive("atMatchField",[function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){var e=b.inheritedData("$formController")[c.atMatchField];d.$parsers.push(function(a){return a===e.$viewValue?(d.$setValidity("match",!0),a):void d.$setValidity("match",!1)}),e.$parsers.push(function(a){return d.$setValidity("match",a===d.$viewValue),a})}}}]);var apiVersion,profileModule=angular.module("user.profile",["config"]),ProfileCtrl=profileModule.controller("ProfileCtrl",["$scope","profile","server","api",function(a,b,c,d){apiVersion=c+d,a.profile=b.data}]),ProfileViewCtrl=profileModule.controller("ProfileViewCtrl",["$scope","titleService","history","$filter",function(a,b,c,d){b.setTitle("Profile: "+a.profile.firstName+" "+a.profile.lastName),a.history=d("sanitizeHistory")(c.data)}]);profileModule.controller("ProfileMessageCtrl",["$scope","$http","growl","titleService",function(a,b,c,d){d.setTitle("Message: "+a.profile.firstName+" "+a.profile.lastName),a.message={},a.submitted=!1,a.sendMessage=function(d){a.submitted=!0,d.$invalid||b.put(apiVersion+"/profile/editPassword",a.message).success(function(){a.message={},a.submitted=!1,c.addSuccessMessage("Profile.ProfileMessageCtrl.MessageSent")}).error(function(b){a.message={},c.addServerMessages(b)})}}]),ProfileCtrl.getProfile={profile:["$http","$stateParams","$state",function(a,b,c){return a.get(apiVersion+"/profile/"+b.profileId).success(function(a){return a&&a._id?a:void c.go("404")}).error(function(){c.go("404")})}]},ProfileViewCtrl.getHistory={history:["$http","$stateParams",function(a,b){return a.get(apiVersion+"/profile/"+b.profileId+"/history").success(function(a){return a?a:null}).error(function(){return null})}]},profileModule.config(["$stateProvider","securityAuthorizationProvider",function(a,b){a.state("profile",{url:"/profile/:profileId","abstract":!0,templateUrl:"scripts/user/templates/profile.tpl.html",controller:"ProfileCtrl",resolve:ProfileCtrl.getProfile}).state("profile.show",{url:"",templateUrl:"scripts/user/templates/profileShow.tpl.html",controller:"ProfileViewCtrl",resolve:ProfileViewCtrl.getHistory}).state("profile.message",{url:"/message",templateUrl:"scripts/user/templates/profileMessage.tpl.html",controller:"ProfileMessageCtrl",resolve:{auth:b.requireAuthenticatedUser}})}]);var projectModule=angular.module("project",["project.service","project.directive","project.filters","ui.bootstrap.typeahead"]).config(["$stateProvider","securityAuthorizationProvider",function(a,b){a.state("project",{url:"/project",templateUrl:"scripts/project/templates/project.tpl.html","abstract":!0}).state("project.create",{url:"/create",resolve:{auth:b.requireAuthenticatedUser},templateUrl:"scripts/project/templates/projectCreate.tpl.html",controller:"ProjectCreateCtrl"}).state("project.show",{url:"/:projectId",templateUrl:"scripts/project/templates/projectGraph.tpl.html",controller:"ProjectViewCtrl",resolve:projectModule.getProject})}]);projectModule.getProject={projectData:["projectService","$stateParams","growl","$state",function(a,b,c,d){return a.getProject(b.projectId).then(function(a){return a&&a.nodes?a:void d.go("404")})}]},projectModule.controller("ProjectViewCtrl",["$scope","projectData","titleService","$state","projectService","graphService","$translate",function(a,b,c,d,e,f,g){function h(){a.content={title:g("Person.PersonViewCtrl.Facts")},c.setTitle(b.name)}h(),a.$on("$translateChangeSuccess",function(){h()}),a.projectData=b,a.$watch(function(){return e.project},function(b){a.projectData=b}),a.selected={},a.$watch(function(){return e.selectedPerson},function(b){a.selected.person=b}),a.graphSettings=f.graphSettings(),a.navigateToPerson=function(){d.go("person.show",{personId:a.selected.person._id})},a.deselectPerson=function(){a.selected.person=null,f.removeSelectedNode()}}]),projectModule.controller("ProjectCreateCtrl",["titleService","$translate",function(a,b){a.setTitle(b("Project.ProjectCreateCtrl.Title"))}]);var apiVersion;angular.module("project.service",["config"]).factory("projectService",["$http","$q","$filter","security","server","api",function(a,b,c,d,e,f){function g(a,b,c){-1===c.indexOf(a)&&c.push(a),h.project.nodes[h.project.nodeIndex[a]].hide=!0,angular.forEach(Object.keys(h.project.relationships[a]),function(d){angular.forEach(h.project.relationships[a][d],function(d){var e=h.project.links[h.project.linkIndex[d.link]];if(!e.hide&&-1===b.indexOf(e._id)){b.push(e._id),e.hide=!0;var f=e.sourceId===a?e.targetId:e.sourceId;g(f,b,c)}})})}apiVersion=e+f;var h={currentProject:null,project:null,selectedPerson:null,getCurrentProject:function(){return a.get(apiVersion+"/projects/current").success(function(a){return a&&a.projectId?(h.currentProject=a,h.currentProject):(h.currentProject=null,h.currentProject)}).error(function(){return h.currentProject=null,h.currentProject})},getProject:function(d){var e=parseInt(d,10);return h.project&&h.project._id===e?b.when(h.project):a.get(apiVersion+"/project/"+e).then(function(a){return a&&a.data?(h.project=c("sanitizeProject")(a.data),h.project._id=e):h.project=null,h.project},function(){return h.project=null,h.project})},addRelationship:function(a){a.source=h.project.nodeIndex[a.sourceId],a.target=h.project.nodeIndex[a.targetId],h.project.links.push(a),h.project=c("sanitizeProject")(h.project)},addNode:function(a){var b=c("sanitizePerson")(a);h.project.nodes.push(b),h.project.levels.push(b.level),h.project=c("sanitizeProject")(h.project)},updateNode:function(a){h.project.nodes[h.project.nodeIndex[a._id]].living=a.living,h.project.nodes[h.project.nodeIndex[a._id]].gender=a.gender.gender,h.project.nodes[h.project.nodeIndex[a._id]].level=a.level,h.project.nodes[h.project.nodeIndex[a._id]].facts=a.facts,h.project.nodes[h.project.nodeIndex[a._id]].dates=a.dates,h.project.nodes[h.project.nodeIndex[a._id]].primaryName=a.primaryName.displayName},update:function(a){angular.forEach(Object.keys(a),function(b){"relationships"===b&&(a[b]=JSON.parse(a[b])),h.project[b]=a[b]})},addFact:function(a,b,c){var d;d="person"===c?h.project.nodes[h.project.nodeIndex[a]].facts:h.project.links[h.project.linkIndex[a]].facts,-1!==d.indexOf(b)?d.splice(d.indexOf(b),1,b):d.push(b)},getPath:function(b,c,d){return a.get(apiVersion+"/project/path/"+b+"/"+c+"/"+d)},hideLink:function(b,c,e){var f=[b],i=[];h.project.links[h.project.linkIndex[b]].hide=!0;var j=h.project.hidden;j.manuallyHidden.push(b);var k=[b].concat(j.links);return this.getPath(c,e,k).then(function(b){if(0===b.data.nodes.length&&g(c,f,i),j.nodes=j.nodes.concat(i),j.links=j.links.concat(f),d.currentUser){var e={hidden:JSON.stringify(j)};a.put(apiVersion+"/project/"+h.project._id,e)}})},showLink:function(b,c){var e=b.link._id?b.link._id:b.link,f=b.node._id?b.node._id:b.node;if(c||(c=1,h.project.hidden.manuallyHidden.splice(h.project.hidden.manuallyHidden.indexOf(e),1)),h.project.hidden.nodes.splice(h.project.hidden.nodes.indexOf(f),1),h.project.nodes[h.project.nodeIndex[f]].hide=!1,h.project.hidden.links.splice(h.project.hidden.links.indexOf(e),1),h.project.links[h.project.linkIndex[e]].hide=!1,Object.keys(h.project.relationships[f]).forEach(function(a){h.project.relationships[f][a].forEach(function(a){return-1===h.project.hidden.manuallyHidden.indexOf(a.link)&&-1!==h.project.hidden.links.indexOf(a.link)?h.showLink(a,c++):void 0})}),c--,0===c&&d.currentUser){var g={hidden:JSON.stringify(h.project.hidden)};a.put(apiVersion+"/project/"+h.project._id,g)}}};return h}]),angular.module("project.directive",["ui.bootstrap.modal"]).factory("graphService",function(){var a,b,c,d,e,f={node:{width:50,height:50,spacing:20},options:{width:24,height:24},view:{},relationship:{},expand:{},contract:{},showOptions:!1},g={data:d,createGraph:function(f){function h(){b.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}d=f;var i=d3.select("svg");c=d3.behavior.zoom().scaleExtent([.2,2]).on("zoom",h),i.call(c),b=d3.select("#zoomPan"),a=d3.layout.force().charge(-7e3).chargeDistance(1e3).gravity(.1),g.calculateLevels(d.levels),angular.forEach(d.nodes,function(a){a.y=e(a.level),a.x=e(a.level)+30})},calculateLevels:function(a){var b=Math.min.apply(null,a)-Math.max.apply(null,a),c=-Math.round(b/31556952e3);e=d3.scale.linear().domain([Math.min.apply(null,a),Math.max.apply(null,a)]).range([0,7*c])},graphSettings:function(){return f},centreNode:function(e){a.stop();var f=0;document.getElementsByClassName("personTitle").length>0&&(f=15+document.getElementsByClassName("personTitle")[0].offsetWidth);var g,h,i=window.innerWidth-f,j=window.innerHeight;angular.forEach(d.nodes,function(a){a._id===e&&(g=f+i/2-a.x,h=j/2-a.y,b.transition().duration(1e3).attr("transform","translate("+[g,h]+")scale(1)"))}),setTimeout(function(){c.translate([g,h])},1e3)},selectNode:function(a){var b=[a];angular.forEach(d.links,function(c){c.highlight=!1,c.sourceId===a?(b.push(c.targetId),c.fade=!1):c.targetId===a?(b.push(c.sourceId),c.fade=!1):c.fade=!0}),angular.forEach(d.nodes,function(a){a.fade=-1!==b.indexOf(a._id)?!1:!0})},removeSelectedNode:function(){angular.forEach(d.nodes,function(a){a.fade=!1}),angular.forEach(d.links,function(a){a.fade=!1})},highlightPath:function(a){var b=[],c=[];a.nodes.forEach(function(a){b.push(a)}),a.links.forEach(function(a){c.push(a)}),angular.forEach(d.links,function(a){-1===c.indexOf(a._id)?(a.fade=!0,a.highlight=!1):(a.fade=!1,a.highlight=!0)}),angular.forEach(d.nodes,function(a){a.fade=-1===b.indexOf(a._id)?!0:!1})},drawGraph:function(){function b(a){for(var b=d3.geom.quadtree(d.nodes),f=0,i=d.nodes.length;++f<i&&h;)b.visit(c(d.nodes[f]));g=h?a.alpha:1,angular.forEach(d.nodes,function(a){a.y+=(e(a.level)-a.y)*g})}function c(a){var b=f.node.width+30,c=a.x-b,d=a.x+b,e=a.y-b,g=a.y+b;return function(b,h,i,j,k){if(b.point&&b.point!==a){var l=a.x-b.point.x,m=a.y-b.point.y,n=Math.sqrt(l*l+m*m),o=3*f.node.width;o>n&&(n=(n-o)/n*.5,a.x-=l*=n,a.y-=m*=n,b.point.x+=l,b.point.y+=m)}return h>d||c>j||i>g||e>k}}h=!1,a.nodes(d.nodes).links(d.links).on("tick",b).start();var g,h=!0;setTimeout(function(){h=!1},50)}};return g}).controller("ProjectGraphCtrl",["$scope","$modal","$http","growl","$filter","projectService","graphService","$interval",function(a,b,c,d,e,f,g,h){g.createGraph(a.data);var i=h(function(){g.drawGraph()},100);setTimeout(function(){h.cancel(i),g.centreNode(f.project._primaryId)},2e3),a.hideOptions=function(){a.graph.showOptions=!1},a.toggleNodeOptions=function(b,c){var d={view:d3.select("#viewIcon"),relationship:d3.select("#relationshipIcon"),expand:d3.select("#expandIcon"),contract:d3.select("#contractIcon")};c.stopPropagation(),a.graph.showOptions===!0&&a.graph.selectedNode===b?a.graph.showOptions=!1:(a.graph.view.x=parseFloat(b.x)+parseFloat(a.graph.node.width),a.graph.view.y=parseFloat(b.y),d.view.attr("transform",function(){return"translate("+parseFloat(a.graph.view.x+5)+","+parseFloat(a.graph.view.y+4)+")scale(0.015)"}),a.graph.relationship.x=parseFloat(b.x)+parseFloat(a.graph.node.width),a.graph.relationship.y=parseFloat(b.y)+parseFloat(a.graph.options.height)+2,d.relationship.attr("transform",function(){return"translate("+parseFloat(a.graph.relationship.x+5)+","+parseFloat(a.graph.relationship.y+3)+")scale(0.015)"}),a.graph.contract.x=parseFloat(b.x),a.graph.contract.y=parseFloat(b.y)+parseFloat(a.graph.node.height),d.contract.attr("transform",function(){return"translate("+parseFloat(a.graph.contract.x+3)+","+parseFloat(a.graph.contract.y+3)+")scale(0.6)"}),a.graph.expand.x=parseFloat(b.x)+parseFloat(a.graph.options.width)+2,a.graph.expand.y=parseFloat(b.y)+parseFloat(a.graph.node.height),d.expand.attr("transform",function(){return"translate("+parseFloat(a.graph.expand.x+3)+","+parseFloat(a.graph.expand.y+3)+")scale(0.6)"}),a.graph.showOptions=!0,a.graph.selectedNode=b)},a.contractableLinksExist=function(a){if(void 0!==a){var b=0;return f.project.relationships[a]&&Object.keys(f.project.relationships[a]).forEach(function(c){f.project.relationships[a][c].forEach(function(a){-1===f.project.hidden.links.indexOf(a.link)&&b++})}),b}},a.expandableLinksExist=function(a){if(void 0!==a){var b=0;return f.project.relationships[a]&&Object.keys(f.project.relationships[a]).forEach(function(c){f.project.relationships[a][c].forEach(function(a){-1!==f.project.hidden.links.indexOf(a.link)&&b++})}),b}},a.contractLinks=function(c){var g,h=e("contractableLinks")(a.data,a.data.relationships[c]),i=a.contractableLinksExist(c);if(1===i){var k=[];h.child&&1===h.child.length&&k.push("child"),h.parent&&1===h.parent.length&&k.push("parent"),h.couple&&1===h.couple.length&&k.push("couple"),g=h[k[0]].pop(),f.hideLink(g.link,g.node,c).then(function(){},function(a){d.addServerMessages(a.data)})}else{var l=b.open({templateUrl:"scripts/project/templates/contractLinksModal.tpl.html",controller:j,resolve:{rels:function(){var b=e("populateNodeAndLink")(a.data,e("contractableLinks")(a.data,a.data.relationships[c]));return b},title:function(){return"Project.CollapseLink.Title"}}});l.result.then(function(a){f.hideLink(a.link._id,a.node._id,c).then(function(){},function(a){d.addServerMessages(a.data)})})}};var j=function(a,b,c,d,e){a.content={title:e},a.rels=d,a.selected={},a.ok=function(){b.close(a.selected.rel)},a.cancel=function(){b.dismiss("cancel")}};a.expandLinks=function(c){var d,g={},h=0;if(Object.keys(f.project.relationships[c]).forEach(function(a){f.project.relationships[c][a].forEach(function(b){-1!==f.project.hidden.links.indexOf(b.link)&&(d=b,h++,g[a]||(g[a]=[]),g[a].push(b))})}),1===h)f.showLink(d);else{var i=b.open({templateUrl:"scripts/project/templates/contractLinksModal.tpl.html",controller:j,resolve:{rels:function(){return e("populateNodeAndLink")(a.data,g)},title:function(){return"Project.ExpandLink.Title"}}});i.result.then(function(a){f.showLink(a)})}}}]).directive("projectGraph",function(){return{restrict:"E",scope:{data:"=",graph:"=settings"},controller:"ProjectGraphCtrl",templateUrl:"scripts/project/templates/graph.tpl.html"}}),angular.module("project.filters",[]).filter("sanitizeProject",["$filter",function(a){return function(b){return b=a("projectIndexesAndHidden")(b),b.levels=[],angular.forEach(b.nodes,function(c){c=a("sanitizePerson")(c),-1===b.levels.indexOf(c.level)&&b.levels.push(c.level)}),b}}]).filter("projectIndexesAndHidden",function(){return function(a){return a.nodeIndex={},a.linkIndex={},a.nodeIndex={},angular.forEach(a.nodes,function(b,c){a.hidden&&-1!==a.hidden.nodes.indexOf(b._id)&&(b.hide=!0),a.nodeIndex[b._id]=c}),a.linkIndex={},angular.forEach(a.links,function(b,c){a.hidden&&-1!==a.hidden.links.indexOf(b._id)&&(b.hide=!0),a.linkIndex[b._id]=c,b.source=a.nodeIndex[b.sourceId],b.target=a.nodeIndex[b.targetId]}),a}}).filter("contractableLinks",function(){return function(a,b){if(b){var c={};return angular.forEach(Object.keys(b),function(d){angular.forEach(b[d],function(b){-1===a.hidden.links.indexOf(b.link)&&(c[d]||(c[d]=[]),c[d].push(b))})}),c}return{}}}).filter("populateNodeAndLink",function(){return function(a,b){var c={};return angular.forEach(Object.keys(b),function(d){angular.forEach(b[d],function(b){c[d]||(c[d]=[]);var e=angular.copy(b);e.link=a.links[a.linkIndex[b.link]],e.node=a.nodes[a.nodeIndex[b.node]],c[d].push(e)})}),c}}).filter("iif",function(){return function(a,b,c){return a?b:c}});var apiVersion,personModule=angular.module("person",["ui.bootstrap.modal","person.service","person.filters","rsmFields.relationshipTypeField"]);personModule.controller("PersonCtrl",["$scope","security","server","api",function(a,b,c,d){a.edit={},a.$watch(function(){return b.currentUser},function(b){a.edit.loggedIn=!!b}),apiVersion=c+d}]);var PersonViewCtrl=personModule.controller("PersonViewCtrl",["$scope","referenceData","$http","$state","growl","$stateParams","titleService","personService","person","graphService","projectService",function(a,b,c,d,e,f,g,h,i,j,k){a.person=i,a.$watch(function(){return h.person},function(b){a.person=b,k.selectedPerson=b.primaryName.displayName.nameWithDates}),g.setTitle(a.person.primaryName.displayName.nameWithDates),a.$watch(function(){return j.data},function(){j.selectNode(a.person._id)}),!a.person.isPerson&&a.person.living&&(a.invite={show:!0}),a.inviteUser=function(b){if(a.submitted=!0,!b.$invalid){var d=[a.person.primaryName.nameForm.nameParts[0].type,a.person.primaryName.nameForm.nameParts[1].type],g="given"===d[0]?0:1,h="surname"===d[0]?0:1,i={_id:a.person._id,firstName:a.person.primaryName.nameForm.nameParts[g].value,lastName:a.person.primaryName.nameForm.nameParts[h].value,email:a.invite.email,gender:a.person.gender.gender};a.person.facts.forEach(function(a){"birth"===a.type&&a.date.approximate===!1&&a.date.startTimeStamp&&(i.birthday=a.date.startTimeStamp)}),a.submitted=!1,a.invite.show=!1,a.invite.email="",c.post(apiVersion+"/project/"+f.projectId+"/person/invite",i).success(function(){e.addSuccessMessage("Person.PersonViewCtrl.Invited")}).error(function(b){e.addServerMessages(b),a.invite.show=!0})}}}]);personModule.controller("PersonEditCtrl",["$scope","growl","$http","$stateParams","titleService","personService","$translate","nameService","referenceData",function(a,b,c,d,e,f,g,h,i){function j(){a.content={title:g("Person.PersonViewCtrl.Names")},e.setTitle(a.person.primaryName.displayName.nameWithDates+": "+a.content.title)}j(),a.$on("$translateChangeSuccess",function(){j()}),a.living=i.get("livingValues"),a.genders=i.get("genders"),a.$watch(function(){return f.person},function(b){a.person=b,l=angular.copy(a.person._primaryNameId),k=angular.copy(a.person)});var k=angular.copy(a.person);a.update=function(){a.person.living!==k.living?c.put(apiVersion+"/project/"+d.projectId+"/person/"+a.person._id,{living:a.person.living}).success(function(){k.living=a.person.living,a.edit.living=!1,f.updatePerson(a.person),b.addSuccessMessage("Person.PersonViewCtrl.RecordUpdated")}).error(function(c){a.person.living=k.living,b.addServerMessages(c)}):a.person.gender!==k.gender.gender&&c.put(apiVersion+"/project/"+d.projectId+"/person/"+a.person._id+"/gender/"+a.person.gender._id,{gender:a.person.gender.gender}).success(function(){k.gender=a.person.gender,a.edit.gender=!1,f.updatePerson(a.person),b.addSuccessMessage("Person.PersonViewCtrl.RecordUpdated")
}).error(function(c){a.person.gender=k.gender,b.addServerMessages(c)})};var l=angular.copy(a.person._primaryNameId);a.updatePrimaryName=function(){c.put(apiVersion+"/project/"+d.projectId+"/person/"+d.personId+"/name/"+a.person._primaryNameId,{primary:!0}).success(function(){angular.forEach(a.person.names,function(b){b._id===a.person._primaryNameId&&(a.person.primaryName=b,h.updateName(b))}),l=angular.copy(a.person._primaryNameId)}).error(function(c){b.addServerMessages(c),a.person._primaryNameId=angular.copy(l)})}}]),personModule.controller("PersonFactCtrl",["$scope","titleService","$translate",function(a,b,c){function d(){a.content={title:c("Person.PersonViewCtrl.Facts")},b.setTitle(a.person.primaryName.displayName.nameWithDates+": "+a.content.title)}d(),a.$on("$translateChangeSuccess",function(){d()})}]),personModule.controller("PersonRelationshipsCtrl",["$scope","$filter","projectService","growl","$stateParams","$http","rsmConfirmModal","$state","titleService","$translate",function(a,b,c,d,e,f,g,h,i,j){function k(){a.content={title:j("Person.PersonViewCtrl.Relationships")},i.setTitle(a.person.primaryName.displayName.nameWithDates+": "+a.content.title)}a.relationships=b("relationshipDetails")(a.person._id,c.project),k(),a.$on("$translateChangeSuccess",function(){k()}),a.edit.params=e,a.$watch(function(){return c.project},function(c){a.relationships=b("relationshipDetails")(a.person._id,c)}),a.removeRelationship=function(i,j){g.open({action:"Remove",type:"Relationship"},function(){f.delete(apiVersion+"/project/"+e.projectId+"/person/"+e.personId+"/relationship/"+j).success(function(d){angular.forEach(d.removeNodes,function(a){var b=c.project.nodeIndex[a],d=Object.keys(c.project.nodeIndex).indexOf(a.toString());c.project.nodes.splice(b,1),delete c.project.nodeIndex[a];for(var e=Object.keys(c.project.nodeIndex),f=e.length;f>d;d++)c.project.nodeIndex[e[d]]--}),angular.forEach(d.removeLinks,function(a){var b=c.project.linkIndex[a],d=Object.keys(c.project.linkIndex).indexOf(a.toString());c.project.links.splice(b,1),delete c.project.linkIndex[a];for(var e=Object.keys(c.project.linkIndex),f=e.length;f>d;d++)c.project.linkIndex[e[d]]--}),c.project.relationships=d.relationships,d.projectId?h.go("person.show",{projectId:d.projectId,personId:e.personId}):(c.project.hidden=d.hidden,a.relationships=b("relationshipDetails")(e.personId,c.project))}).error(function(a){d.addServerMessages(a)})})}}]);var PersonHistoryCtrl=personModule.controller("PersonHistoryCtrl",["$scope","$filter","history",function(a,b,c){a.history=b("sanitizeHistory")(c)}]),PersonPathCtrl=personModule.controller("PersonPathCtrl",["$scope","projectData","graphService","projectService","$stateParams","$filter","$location",function(a,b,c,d,e,f,g){var h=parseInt(e.personId,10);if(a.projectData=b,a.relatedPerson=null,a.excludedLinks=[],a.path=null,a.noPath=!1,a.$on("$stateChangeStart",function(){a.removePath()}),a.findPath=function(i){d.getPath(e.personId,i,a.excludedLinks).then(function(d){0===d.data.nodes.length?a.noPath=!0:(a.noPath=!1,a.path=f("path")(d.data,b,h),c.highlightPath(d.data))}),g.search().node||g.search({node:a.relatedPerson._id})},a.removePath=function(){a.relatedPerson=null,a.excludedLinks=[],a.path=null,a.noPath=!1,c.selectNode(h)},g.search().node){var i=g.search().node;a.findPath(i),a.relatedPerson=b.nodes[b.nodeIndex[i]].primaryName.nameWithDates}}]);personModule.controller("PersonMediaCtrl",[function(){}]),personModule.controller("PersonSourcesCtrl",[function(){}]),PersonViewCtrl.getPerson={person:["$stateParams","$state","personService",function(a,b,c){return c.getPerson(a).then(function(a){return a&&a._id?a:void b.go("404")})}]},PersonHistoryCtrl.getHistory={history:["$stateParams","$state","$http",function(a,b,c){return c.get(apiVersion+"/project/"+a.projectId+"/person/"+a.personId+"/history").then(function(a){return a&&a.data?a.data:null},function(){return null})}]},PersonPathCtrl.getProjectData={projectData:["$stateParams","projectService",function(a,b){return b.getProject(a.projectId).then(function(a){return a})}]},personModule.config(["$stateProvider",function(a){a.state("person",{url:"/person",parent:"project.show","abstract":!0,templateUrl:"scripts/person/templates/person.tpl.html",controller:"PersonCtrl"}).state("person.show",{url:"/:personId",resolve:PersonViewCtrl.getPerson,templateUrl:"scripts/person/templates/personShow.tpl.html",controller:"PersonViewCtrl"}).state("person.show.edit",{url:"/edit",templateUrl:"scripts/person/templates/personEdit.tpl.html",controller:"PersonEditCtrl"}).state("person.show.facts",{url:"/facts",templateUrl:"scripts/person/templates/personFacts.tpl.html",controller:"PersonFactCtrl"}).state("person.show.relationships",{url:"/relationships",templateUrl:"scripts/person/templates/personRelationships.tpl.html",controller:"PersonRelationshipsCtrl"}).state("person.show.history",{url:"/history",templateUrl:"scripts/person/templates/personHistory.tpl.html",controller:"PersonHistoryCtrl",resolve:PersonViewCtrl.getHistory}).state("person.show.path",{url:"/path",templateUrl:"scripts/person/templates/personPaths.tpl.html",controller:"PersonPathCtrl"})}]);var apiVersion;angular.module("person.service",["project.service","services.referenceData","config"]).factory("personService",["$http","$q","$filter","projectService","server","api",function(a,b,c,d,e,f){apiVersion=e+f;var g={person:null,getPerson:function(d){var e=parseInt(d.personId,10),f=parseInt(d.projectId,10);return g.person&&g.person._id===e?b.when(g.person):a.get(apiVersion+"/project/"+f+"/person/"+e).then(function(a){return g.person=a&&a.data?c("sanitizePerson")(a.data):null,g.person},function(){return g.person=null,g.person})},updatePerson:function(a){g.person=a,d.updateNode(g.person)}};return g}]).factory("nameService",["$filter","personService","projectService","server","api",function(a,b,c,d,e){apiVersion=d+e;var f={name:null,nameForm:null,editableFullText:!1,getName:function(a){return b.getPerson(a).then(function(b){return b?angular.forEach(b.names,function(c){c._id===parseInt(a.nameId,10)&&(f.name=c,angular.forEach(c.nameForms,function(d){d._id===parseInt(a.nameFormId,10)&&(f.nameForm=d,f.nameForm.canRemove=c._id===b._primaryNameId&&1===c.nameForms.length?!1:!0),angular.forEach(d.nameParts,function(a){a._tempId=a._id})}))}):(f.name=null,f.nameForm=null),{name:f.name,nameForm:f.nameForm}})},updateName:function(d){return d.displayName=a("displayName")(d,b.person.dates),f.name=d,f.nameForm=null,angular.forEach(b.person.names,function(a,c){a._id===d._id&&b.person.names.splice(c,1,d)}),b.person.primaryName._id===d._id&&(b.person=a("sanitizePerson")(b.person),c.updateNode(b.person)),d},addName:function(c){c.displayName=a("displayName")(c,b.person.dates),f.name=c,b.person.names.push(c)},removeName:function(a){f.name=null,f.nameForm=null,angular.forEach(b.person.names,function(c,d){c._id===a&&b.person.names.splice(d,1)})},removeNameForm:function(c){f.nameForm=null,angular.forEach(f.name.nameForms,function(a,b){a._id===c&&f.name.nameForms.splice(b,1)}),f.name.displayName=a("displayName")(f.name,b.person.dates),angular.forEach(b.person.names,function(a,c){a._id===f.name._id&&b.person.names.splice(c,1,f.name)})}};return f}]).factory("factService",["$filter","personService","projectService","graphService","server","api",function(a,b,c,d,e,f){apiVersion=e+f;var g={fact:null,factSource:null,getFact:function(a,d){return g.fact=null,g.factSource=null,a.relationshipId?c.getProject(a.projectId).then(function(b){return angular.forEach(b.links,function(b){b._id===a.relationshipId&&(g.factSource=b)}),g.factSource?(angular.forEach(g.factSource.facts,function(a){a._id===parseInt(d,10)&&(g.fact=a)}),g.fact):null}):b.getPerson(a).then(function(a){return a&&(g.factSource=a,angular.forEach(g.factSource.facts,function(a){a._id===parseInt(d,10)&&(g.fact=a)})),g.fact})},addFact:function(d,e){g.fact=a("factDetails")(d);var f,h;e?(h=e,f="relationship"):(b.person.facts.push(d),h=b.person._id,f="person"),c.addFact(h,d,f)},updateFact:function(e){g.fact=a("factDetails")(e),angular.forEach(g.factSource.facts,function(a,b){a._id===e._id&&g.factSource.facts.splice(b,1,e)}),("birth"===g.fact.type||"death"===g.fact.type)&&(b.person=a("sanitizePerson")(b.person),"birth"===g.fact.type&&(-1===c.project.levels.indexOf(b.person.level)&&c.project.levels.push(b.person.level),d.calculateLevels(c.project.levels))),c.updateNode(b.person),("birth"===g.fact.type||"death"===g.fact.type)&&d.drawGraph()},removeFact:function(a){g.fact=null,angular.forEach(g.factSource.facts,function(b,c){b._id===a&&g.factSource.facts.splice(c,1)})}};return g}]),angular.module("person.filters",["project.filters"]).filter("sanitizePerson",["$filter",function(a){return function(b){return b.facts=a("sanitizeFacts")(b.facts),b.dates=a("displayPersonDate")(b),b.level=a("calculateLevel")(b),b.names?angular.forEach(b.names,function(c){c.displayName=a("displayName")(c,b.dates),!c.displayName,c._id===b._primaryNameId&&(b.primaryName=c)}):b.primaryName=a("displayName")(b),b}}]).filter("sanitizeFacts",["$filter",function(a){return function(b){return angular.forEach(b,function(b){b=a("factDetails")(b)}),b}}]).filter("factDetails",["$filter","referenceData",function(a,b){var c=b.get("factTypes"),d=b.get("detailedRelationshipTypes");return function(b){return delete b.value,b.values&&b.values.length>0&&(b.value=a("defaultLangName")(b.values),angular.forEach(d,function(a){a.value===b.value.value&&(b.valueOrder=a.order)})),b.place&&(delete b.place.name,b.place.names&&b.place.names.length>0&&(b.place.name=a("defaultLangName")(b.place.names))),c.forEach(function(a){a.value===b.type&&(b.order=a.order,b.category=a.category)}),b.date||(b.date=null),b}}]).filter("displayName",["languages",function(a){return function(b,c){var d;d=c?c:b.dates;var e=15;b.nameForm=a.getDefaultLangValue(b.nameForms,null);var f={displayName:b.nameForm.fullText,nameWithDates:b.nameForm.fullText+" "+d},g=b.nameForm.fullText.length;if(g>e){var h=b.nameForm.fullText.split(" (");h.length>1&&(f.maiden="("+h.pop()),f.name=h.length>1?h.join("("):h[0]}else f.name=b.nameForm.fullText;return f}}]).filter("givenName",function(){return function(a){var b;return a.forEach(function(a){a.mandatory&&"given"===a.type&&(b=a.value)}),b}}).filter("displayDate",["$filter",function(a){return function(b,c){var d,e,f,g;return e=new Date(b.endTimestamp),f=new Date(b.startTimestamp),g=c?"yyyy":"mediumDate",b&&(d=b.approximate?"before"===b.range?"< "+a("date")(e,g)+"*":"after"===b.range?"> "+a("date")(f,g)+"*":"(> "+a("date")(f,g)+"* - < "+a("date")(e,g)+"*)":a("date")(f,g)),d}}]).filter("displayPersonDate",["$filter",function(a){return function(b){var c,d;angular.forEach(b.facts,function(b){"birth"===b.type&&(c=a("displayDate")(b.date,!0)),"death"===b.type&&(d=a("displayDate")(b.date,!0))});var e="("+c+" - ";return d&&(e+=d),e+=")"}}]).filter("calculateLevel",function(){return function(a){var b;return angular.forEach(a.facts,function(a){"birth"===a.type&&(b=a.date.startTimestamp?a.date.startTimestamp:a.date.endTimestamp)}),b}}).filter("living",["referenceData",function(a){var b=a.get("livingValues");return function(a){for(var c=0,d=b.length;d>c;c++)if(b[c].value===a)return b[c].name}}]).filter("gender",["referenceData",function(a){var b=a.get("genders");return function(a){for(var c=0,d=b.length;d>c;c++)if(b[c].value===a)return b[c].name}}]).filter("inArray",function(){return function(a,b,c){return a.filter(function(a){return-1!==a[b].indexOf(c)?a:void 0})}}).filter("inArrayValue",["referenceData",function(a){return function(b,c,d){if(""===b||void 0===b)return null;var e;return e=Array.isArray(c)?c:a.get(c),e.filter(function(a){return-1!==a[d].indexOf(b)?a:void 0})}}]).filter("byType",["referenceData",function(a){return function(b,c){var d;return d=Array.isArray(b)?b:a.get(b),d.filter(function(a){return a.type===c?a:void 0})}}]).filter("byValue",["referenceData",function(a){return function(b,c){var d;return d=Array.isArray(b)?b:a.get(b),d.filter(function(a){return a.value===c?a:void 0})}}]).filter("byFieldName",function(){return function(a,b,c){return a.filter(function(a){return a[b]===c?a:void 0})}}).filter("fieldValue",function(){return function(a,b){return a[b]}}).filter("valueName",["referenceData",function(a){return function(b,c){var d;d=Array.isArray(c)?c:a.get(c);for(var e=0,f=d.length;f>e;e++)if(d[e].value===b)return d[e].name}}]).filter("defaultLangName",["languages",function(a){return function(b){return a.getDefaultLangValue(b)}}]).filter("languageExists",function(){return function(a,b,c){var d=[];return angular.forEach(b,function(a){a.lang!==c&&d.push(a.lang)}),a.filter(function(a){return-1===d.indexOf(a.code)?a:void 0})}}).filter("availableNameTypes",function(){return function(a,b){var c,d=a;return b.forEach(function(a){"birthName"===a.type&&(c=!0)}),c&&(d=a.filter(function(a){return"birthName"!==a.value?a:void 0})),d}}).filter("nameOrder",["referenceData",function(a){var b=a.get("nameTypes");return function(a){return a.forEach(function(a){a.order||b.forEach(function(b){b.value===a.type&&(a.order=b.order)})}),a}}]).filter("calculatedName",function(){return function(a){var b={};angular.forEach(a,function(a){(a.mandatory||"maiden"===a.type)&&(b[a.type]=a.value)});var c=b.given;return b.surname&&(c+=" "+b.surname),b.maiden&&(c+=" ("+b.maiden+")"),c}}).filter("parseNameForm",["$filter",function(a){return function(b){b.customFullText&&0!==b.fullText.length?b.fullText!==a("calculatedName")(b.nameParts)&&(b.customFullText=!0):b.fullText=a("calculatedName")(b.nameParts),delete b.canRemove;for(var c=0,d=b.nameParts.length;d>c;c++){var e=b.nameParts[c];delete e._tempId,delete e.showQualifier,""===e.value&&(b.nameParts.splice(c,1),d--,c--)}return b}}]).filter("factCategories",["referenceData",function(a){var b=a.get("factTypes"),c=a.get("factCategories"),d=[];return b.forEach(function(a){-1===d.indexOf(a.category)&&d.push(a.category)}),function(a){var b=[];return a.forEach(function(a){-1===b.indexOf(a.category)&&b.push(a.category)}),b.sort(function(a,b){var d=c.indexOf(a),e=c.indexOf(b);return d-e}),b}}]).filter("availableFactTypes",["referenceData","personService",function(a,b){var c=[];return function(a,d){var e=[];return angular.forEach(b.person.facts,function(a){-1===e.indexOf(a.type)&&e.push(a.type)}),angular.forEach(a,function(a){a.relType===d&&(a.unique?-1===e.indexOf(a.value)&&-1===c.indexOf(a)&&c.push(a):-1===c.indexOf(a)&&c.push(a))}),c}}]).filter("dateFilter",["$filter",function(a){var b,c,d;return function(e){return e.startDateYear&&(e.startDateMonth||0===e.startDateMonth)&&e.startDateDay?b=a("date")(new Date(Date.UTC(e.startDateYear,e.startDateMonth,e.startDateDay)),"longDate"):e.startDateYear&&(e.startDateMonth||0===e.startDateMonth)?b=a("date")(new Date(Date.UTC(e.startDateYear,e.startDateMonth)),"MMMM yyyy"):e.startDateYear&&(b=e.startDateYear),e.endDateYear&&(e.endDateMonth||0===e.endDateMonth)&&e.endDateDay?c=a("date")(new Date(Date.UTC(e.endDateYear,e.endDateMonth,e.endDateDay)),"longDate"):e.endDateYear&&(e.endDateMonth||0===e.endDateMonth)?c=a("date")(new Date(Date.UTC(e.endDateYear,e.endDateMonth)),"MMMM yyyy"):e.endDateYear&&(c=e.endDateYear),e.approximate?("range"===e.range&&(d="("+b+" - "+c+")"),"before"===e.range&&c&&(d="< "+c),"after"===e.range&&b&&(d="> "+b),d):b}}]).filter("parseFact",["$filter",function(a){return function(b){return b.date=a("parseDate")(b.date),b.values=a("parseTextValue")(b.values),b}}]).filter("parseDate",function(){return function(a){a&&a.approximate?"before"===a.range?(delete a.startDateYear,delete a.startDateMonth,delete a.startDateDay,delete a.startTimestamp):"after"===a.range&&(delete a.endDateYear,delete a.endDateMonth,delete a.endDateDay,delete a.endTimestamp):a&&(a.approximate=!1,a.range="range",delete a.endDateYear,delete a.endDateMonth,delete a.endDateDay,delete a.endTimestamp);var b;return a&&a.startDateYear&&(b=!0,a.startTimestamp=a.startDateMonth?a.startDateDay?Date.UTC(a.startDateYear,a.startDateMonth,a.startDateDay):Date.UTC(a.startDateYear,a.startDateMonth):Date.UTC(a.startDateYear,0)),a&&a.endDateYear&&(b=!0,a.endTimestamp=a.endDateMonth?a.endDateDay?Date.UTC(a.endDateYear,a.endDateMonth,a.endDateDay):Date.UTC(a.endDateYear,a.endDateMonth):Date.UTC(a.endDateYear,0)),b||(a=null),a}}).filter("parseTextValue",function(){return function(a){if(a)for(var b=0,c=a.length;c>b;b++)delete a[b].showLanguage,delete a[b]._tempId,(""===a[b].value||""===a[b].lang)&&(a.splice(b,1),c--,b--);return a&&0!==a.length?a:null}}).filter("calculateDate",["$filter","referenceData",function(a,b){return function(c,d){var e={parent:angular.copy(c.potentialParents),child:angular.copy(c.potentialChildren),couple:angular.copy(c.potentialPartners)};e[d.type].push(d);var f,g,h=b.get("factTypes"),i=a("byFieldName")(h,"relType","couple"),j=i.map(function(a){return a.value});angular.forEach(e.couple,function(a){angular.forEach(a.facts,function(a){if(-1!==j.indexOf(a.type)&&a.date){var b=a.date.startTimestamp?a.date.startTimestamp:a.date.endTimestamp;(!f||f>b)&&(f=b)}})}),angular.forEach(e.child,function(a){angular.forEach(a.person.facts,function(a){if("birth"===a.type){var b=a.date.startTimestamp?a.date.startTimestamp:a.date.endTimestamp;(!g||g>b)&&(g=b)}})});var k;angular.forEach(e.parent,function(a){angular.forEach(a.person.facts,function(a){if("birth"===a.type){var b=a.date.startTimestamp?a.date.startTimestamp:a.date.endTimestamp;(!k||k>b)&&(k=b)}})});var l,m,n=504911232e3;if(g||f){var o;return o=g&&f?Math.min(g,f):g?g:f,l=o-n,{approximate:!0,range:"before",endDateYear:new Date(l).getUTCFullYear(),endDateMonth:new Date(l).getUTCMonth(),endDateDay:new Date(l).getUTCDay(),endTimestamp:l}}return k?(m=k+n,{approximate:!0,range:"after",startDateYear:new Date(m).getUTCFullYear(),startDateMonth:new Date(m).getUTCMonth(),startDateDay:new Date(m).getUTCDay(),startTimestamp:m}):null}}]).filter("relationshipDetails",["$filter",function(a){return function(b,c){if(c.relationships[b]){var d=Object.keys(c.relationships[b]);return angular.forEach(d,function(d){angular.forEach(c.relationships[b][d],function(b){b.person||(b.person=c.nodes[c.nodeIndex[b.node]]),b.relationship||(b.relationship=c.links[c.linkIndex[b.link]],b.relationship.facts=a("sanitizeFacts")(b.relationship.facts),b.relationship.facts.forEach(function(a){a.value&&(b.relationship.subType=a.value.value)}))})}),c.relationships[b]}return{}}}]).filter("availableRelationshipTypes",function(){return function(a,b){return a.filter(function(a){return-1===a.category.indexOf("Sibling")||b&&0!==b.length?a:void 0})}}).filter("relationshipGender",function(){return function(a,b){return"male"===a?"parent"===b?"father":"son":"parent"===b?"mother":"daughter"}}).filter("excludePerson",function(){return function(a,b){return a.filter(function(a){return a._id!==b})}}).filter("sanitizeHistory",["languages","$filter",function(a,b){return function(c){return c.forEach(function(c){var d,e=angular.fromJson(c.fields),f={name:[{field:"primaryName",display:"Person.PersonEditCtrl.KnownBy"}],nameForm:[{field:"lang",display:"Person.PersonEditCtrl.Language"},{field:"fullText",display:""}],namePart:[{field:"value",display:""},{field:"qualifier",display:"Relationship.CreateCtrl.Qualifier"}],textValue:[{field:"value",display:""},{field:"lang",display:"lang",valueFilter:"langName"}],person:[{field:"gender",display:"",valueFilter:"gender"},{field:"living",display:"",valueFilter:"living"}],date:[{field:"startTimestamp",display:"History.Start",valueFilter:function(a){return b("date")(a,"mediumDate")}},{field:"endTimestamp",display:"History.End",valueFilter:function(a){return b("date")(a,"mediumDate")}}],fact:[],relationship:[]};switch(c.record){case"History.Name":d=f.name,c.action=c.type;break;case"History.NameForm":d=f.nameForm,c.action="update",c.record="History.Name";break;case"History.NamePart":d=f.namePart,c.action="update",c.record="History.Name",c.subRecord="History.NamePart";break;case"History.Fact":d=f.fact,c.action=c.type;break;case"History.FactValue":d=f.textValue,c.action="update",c.record="History.Fact",c.subRecord="History.FactValue";break;case"History.FactDate":d=f.date,c.action="update",c.record="History.Fact",c.subRecord="History.FactDate";break;case"History.Place":d=f.textValue,c.action="update",c.record="History.Fact",c.subRecord="History.Place";break;case"History.Person":d=f.person,c.action=c.type;break;case"History.Relationship":d=f.relationship,c.action=c.type}if(d){var g=[];d.forEach(function(a){g.push(a.field)})}"History.Fact"===c.record&&"create"===c.type&&(c.date=e.date,c.place=e.place?e.place:{names:e.names},c.values=e.values);var h=function(a){var c;if(a){var e=angular.copy(a);c={},Object.keys(e).forEach(function(a){if(-1!==g.indexOf(a)){var f=d[g.indexOf(a)].display;"function"==typeof f&&(f=f(e[a])),d[g.indexOf(a)].valueFilter&&(e[a]=b(d[g.indexOf(a)].valueFilter)(e[a])),c[f]=e[a]}})}return c},i=function(a,c){var d,e,g;if(a){var h=angular.copy(a);d=[],c&&(e=f[c],g=[],e.forEach(function(a){g.push(a.field)})),h.forEach(function(a){var c={};Object.keys(a).forEach(function(d){if(-1!==g.indexOf(d)){var f=e[g.indexOf(d)].display;"function"==typeof f&&(f=f(a[d])),e[g.indexOf(d)].valueFilter&&(a[d]=b(e[g.indexOf(d)].valueFilter)(a[d])),c[f]=a[d]}}),d.push(c)})}return d};c.namePart=h(c.namePart),c.value=h(c.value),c.place&&(c.place=i(c.place.names,"textValue")),c.values=i(c.values,"textValue"),c.date&&(c.date=b("displayDate")(c.date)),"update"===c.type&&(c.updates={},d&&Object.keys(e).forEach(function(a){if(-1!==g.indexOf(a)){var f=d[g.indexOf(a)].display;if("function"==typeof f&&(f=f(e[a])),d[g.indexOf(a)].valueFilter){var h=d[g.indexOf(a)].valueFilter;"function"==typeof h?(e[a].oldValue=h(e[a].oldValue),e[a].newValue=h(e[a].newValue)):(e[a].oldValue=b(h)(e[a].oldValue),e[a].newValue=b(h)(e[a].newValue))}c.updates[f]=e[a]}})),c.people.forEach(function(b){b.nameForm=a.getDefaultLangValue(b.nameForms,null),b.relType="History."+b.relType})}),c}}]).filter("historyIcon",function(){return function(a){var b="";return"History.Person"===a.record?b="user":"History.Name"===a.record?b="address-book":"History.Fact"===a.record?b="profile":"History.Relationship"===a.record&&(b="users"),"create"===a.action?b+=" text-success":"update"===a.action?b+=" text-warning":"remove"===a.action&&(b+=" text-danger"),b}}).filter("historyAction",["$translate",function(a){return function(b){var c=a("History.Actions."+b.action);return b.subRecord&&(c+=a(b.subRecord)+" "+a("History.Actions.Against")+" "),c+=a(b.record)}}]).filter("oppositeFact",function(){return function(a){switch(a){case"engagement":case"other":case"commonLawMarriage":case"civilUnion":case"domesticPartnership":return"separation";case"marriage":case"marriageLicense":case"marriageContract":case"marriageNotice":case"marriageBanns":return"divorce"}}}).filter("path",function(){return function(a,b){var c={nodes:[],links:[]};return a.nodes.forEach(function(a){c.nodes.push(b.nodes[b.nodeIndex[a]])}),a.links.forEach(function(a){c.links.push(b.links[b.linkIndex[a]])}),c}}).filter("relationshipName",function(){return function(a,b,c){var d,e;if(a.sourceId===b._id)d=a.type.toLowerCase(),e=c.nodes[c.nodeIndex[a.targetId]].gender;else switch(e=b.gender,a.type){case"CHILD":d="parent";break;case"PARENT":d="child";break;case"COUPLE":d=a.subType}if("male"===e)switch(d){case"parent":return"son";case"child":return"father";default:return d}else switch(d){case"parent":return"daughter";case"child":return"mother";default:return d}}});var apiVersion,nameModule=angular.module("name",["person.filters","rsmFields.namePartField","rsmFields.fullTextField","rorymadden.confirmModal"]),i,len,NameCtrl=nameModule.controller("NameCtrl",["$scope","referenceData","security","languages","$translate","server","api",function(a,b,c,d,e,f,g){a.qualifiers=b.get("namePartQualifiers"),a.nameTypes=b.get("nameTypes"),a.languages=d.getAllLanguageCodes(),a.translate=e,a.$watch(function(){return c.currentUser},function(b){a.edit.loggedIn=!!b}),apiVersion=f+g}]);nameModule.controller("NameEditCtrl",["$scope","$stateParams","referenceData","$http","$q","$state","growl","languages","titleService","$filter","nameService","names","rsmConfirmModal","$translate",function(a,b,c,d,e,f,g,h,j,k,l,m,n,o){if(m.nameForm){a.name=m.name,a.nameForm=m.nameForm;var p=angular.copy(a.name),q=angular.copy(a.nameForm);a.$watch(function(){return l.name},function(b){a.name=angular.copy(b)}),a.$watch(function(){return l.nameForm},function(b){a.nameForm=angular.copy(b)}),a.$on("$stateChangeStart",function(b,c,d){a.nameForm&&angular.forEach(a.nameForm.nameParts,function(a){delete a.showQualifier}),a.canTransition||angular.equals(q,a.nameForm)||(b.preventDefault(),n.open({action:"Unsaved"},function(){a.name=p,a.nameForm=q,f.go(c.name,d)}))}),a.content={title:k("valueName")(a.name.type,a.nameTypes)},j.setTitle(a.person.primaryName.displayName.nameWithDates+": "+a.content.title),a.edit.fields={type:!1,showLanguageValue:!1,showLanguageTabs:!0,showLanguageField:!1},a.submitted=!1,a.submit=function(c){if(a.submitted=!0,!c.$invalid){a.nameForm=k("parseNameForm")(a.nameForm);var e={};q.fullText!==a.nameForm.fullText&&(e.fullText=a.nameForm.fullText),q.customFullText!==a.nameForm.customFullText&&(e.customFullText=a.nameForm.customFullText),q.lang!==a.nameForm.lang&&(e.lang=a.nameForm.lang);var h=[],j=[],m=[];angular.forEach(a.nameForm.nameParts,function(a){a._id?h.push(a):(j.push(a),m.push(i))});var n=[],o=[];angular.forEach(q.nameParts,function(a){var b=!1;angular.forEach(h,function(c){if(c._id===a._id){b=!0;var d=angular.copy(a);if(delete d._tempId,delete d.showQualifier,!angular.equals(c,d)){var e={};c.value!==a.value&&""!==a.value&&(e.value=c.value),angular.equals(c.qualifier,a.qualifier)||(e.qualifier=c.qualifier),c.order!==a.order&&(e.order=c.order),Object.keys(e).length&&n.push({_id:a._id,updates:e})}}}),b||o.push({_id:a._id})});var p=[];if(Object.keys(e).length>0&&p.push({record:"NameForm",action:"update",ids:{personId:parseInt(b.personId,10),nameId:parseInt(b.nameId,10),nameFormId:parseInt(b.nameFormId,10),projectId:parseInt(b.projectId,10)},data:e}),j.length>0)for(i=0,len=j.length;len>i;i++){var r=j[i];p.push({record:"NamePart",action:"create",ids:{personId:parseInt(b.personId,10),nameId:parseInt(b.nameId,10),nameFormId:parseInt(b.nameFormId,10),projectId:parseInt(b.projectId,10)},data:r})}if(n.length>0)for(i=0,len=n.length;len>i;i++){var s=n[i];p.push({record:"NamePart",action:"update",ids:{personId:parseInt(b.personId,10),nameId:parseInt(b.nameId,10),nameFormId:parseInt(b.nameFormId,10),namePartId:parseInt(s._id,10),projectId:parseInt(b.projectId,10)},data:s.updates})}if(o.length>0)for(i=0,len=o.length;len>i;i++){var t=o[i];p.push({record:"NamePart",action:"remove",ids:{personId:parseInt(b.personId,10),nameId:parseInt(b.nameId,10),nameFormId:parseInt(b.nameFormId,10),namePartId:parseInt(t._id,10),projectId:parseInt(b.projectId,10)}})}d.post(apiVersion+"/multipleRequests",p).then(function(c){angular.forEach(a.nameForm.nameParts,function(a){angular.forEach(c.data,function(b){b&&b.type===a.type&&b.order===a.order&&(a._id=b._id)})}),angular.forEach(a.name.nameForms,function(b,c){b._id===a.nameForm._id&&a.name.nameForms.splice(c,1,a.nameForm)}),l.updateName(a.name),a.canTransition=!0,f.go("person.show.edit",b)},function(b){g.addServerMessages(b.data),a.submitted=!1})}},a.remove=function(){var c=o("Person.PersonEditCtrl.Language"),e=o("Person.PersonEditCtrl.Name");a.nameForm.canRemove&&(a.modalInstance=a.name.nameForms.length>1?n.open({action:"Remove",type:c},function(){d.delete(apiVersion+"/project/"+b.projectId+"/person/"+b.personId+"/name/"+a.name._id+"/"+a.nameForm._id).success(function(){l.removeNameForm(a.nameForm._id),f.go("person.show.edit",b)}).error(function(a){g.addServerMessages(a)})}):n.open({action:"Remove",type:e},function(){d.delete(apiVersion+"/project/"+b.projectId+"/person/"+b.personId+"/name/"+a.name._id).success(function(){l.removeName(a.name._id),f.go("person.show.edit",b)}).error(function(a){g.addServerMessages(a)})}))}}else f.go("404")}]),nameModule.controller("NameCreateCtrl",["$scope","$stateParams","referenceData","$http","$state","growl","languages","titleService","$filter","$translate","nameService","rsmConfirmModal",function(a,b,c,d,e,f,g,h,j,k,l,m){function n(){a.content={title:k("Name.CreateCtrl.Title")},h.setTitle(a.person.primaryName.displayName.nameWithDates+": "+a.content.title)}a.translate=k,n(),a.$on("$translateChangeSuccess",function(){n()}),a.nameForm={lang:g.getUserLanguage(),customFullText:!1,nameParts:[{type:"given",value:"",qualifier:["primary"],mandatory:!0,order:0}]},a.name={nameForms:[a.nameForm]};var o=angular.copy(a.name);a.$on("$stateChangeStart",function(b,c,d){a.canTransition||angular.equals(o,a.name)||(b.preventDefault(),m.open({action:"Unsaved"},function(){a.name=angular.copy(o),e.go(c.name,d)}))}),a.setType=function(){if("alsoKnownAs"!==a.name.type){var b;angular.forEach(a.nameForm.nameParts,function(a){"surname"!==a.type||b||(b=!0,a.mandatory||(a.mandatory=!0))}),b||a.nameForm.nameParts.push({type:"surname",value:"",qualifier:["family"],mandatory:!0,order:1})}else for(i=0,len=a.nameForm.nameParts.length;len>i;i++)"surname"===a.nameForm.nameParts[i].type&&(""===a.nameForm.nameParts[i].value?(a.nameForm.nameParts.splice(i,1),len--):delete a.nameForm.nameParts[i].mandatory)},a.edit.fields={type:!0,showLanguageValue:!0,showLanguageTabs:!1,showLanguageField:!1},a.toggleShowLanguageField=function(){a.edit.fields.showLanguageField=!a.edit.fields.showLanguageField,a.edit.fields.showLanguageValue=!a.edit.fields.showLanguageValue},a.submitted=!1,a.submit=function(){a.submitted=!0,a.name.nameForms=[j("parseNameForm")(a.nameForm)],d.post(apiVersion+"/project/"+b.projectId+"/person/"+b.personId+"/names",a.name).success(function(c){l.addName(c),a.canTransition=!0,e.go("person.show.edit",b)}).error(function(b){f.addServerMessages(b),a.submitted=!1})}}]),nameModule.controller("NameCreateNameFormCtrl",["$scope","$stateParams","referenceData","$http","$state","growl","languages","titleService","$filter","nameService","$translate","names","rsmConfirmModal",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.name=l.name;var n=function(){var b=k(i("valueName")(a.name.type,a.nameTypes));a.content={title:k("NameForm.CreateCtrl.Title")+" "+b},h.setTitle(a.person.primaryName.displayName.nameWithDates+": "+a.content.title)};n(),a.$on("$translateChangeSuccess",function(){n()}),a.nameForm={lang:g.getUserLanguage(),customFullText:!1,nameParts:[{type:"given",value:"",qualifier:["primary"],mandatory:!0,order:0},{type:"surname",value:"",qualifier:["family"],order:1}]};var o=angular.copy(a.nameForm);a.$on("$stateChangeStart",function(b,c,d){a.canTransition||angular.equals(o,a.nameForm)||(b.preventDefault(),m.open({action:"Unsaved"},function(){a.nameForm=angular.copy(o),e.go(c.name,d)}))}),"familiar"!==a.name.type&&(a.nameForm.nameParts[1].mandatory=!0),a.edit.fields={type:!1,showLanguageValue:!1,showLanguageTabs:!1,showLanguageField:!0},a.submit=function(){var c=i("parseNameForm")(a.nameForm);d.post(apiVersion+"/project/"+b.projectId+"/person/"+b.personId+"/name/"+b.nameId,c).success(function(c){a.name.nameForms.push(c),j.updateName(a.name),a.canTransition=!0,e.go("name.show",{personId:b.personId,nameId:b.nameId,nameFormId:c._id,projectId:b.projectId}),f.addSuccessMessage("Person.PersonViewCtrl.RecordUpdated")}).error(function(a){f.addServerMessages(a)})}}]),NameCtrl.getName=["$stateParams","$state","nameService",function(a,b,c){var d={personId:parseInt(a.personId,10),projectId:parseInt(a.projectId,10),nameId:parseInt(a.nameId,10),nameFormId:parseInt(a.nameFormId,10)};return c.getName(d).then(function(a){return a&&a.name?a:void b.go("404")})}],nameModule.config(["$stateProvider","securityAuthorizationProvider",function(a,b){a.state("name",{url:"/name","abstract":!0,parent:"person.show",templateUrl:"scripts/person/templates/abstract.tpl.html",controller:"NameCtrl"}).state("name.create",{url:"/create",resolve:{auth:b.requireAuthenticatedUser},templateUrl:"scripts/person/templates/nameForm.tpl.html",controller:"NameCreateCtrl"}).state("name.createNameForm",{url:"/:nameId/create",resolve:{auth:b.requireAuthenticatedUser,names:NameCtrl.getName},templateUrl:"scripts/person/templates/nameForm.tpl.html",controller:"NameCreateNameFormCtrl"}).state("name.show",{url:"/:nameId/:nameFormId",resolve:{names:NameCtrl.getName},templateUrl:"scripts/person/templates/nameForm.tpl.html",controller:"NameEditCtrl"})
}]),angular.module("rsmFields.fullTextField",[]).directive("rsmFullTextField",["$filter",function(a){return{restrict:"E",scope:{nameForm:"="},templateUrl:"scripts/person/directives/fullTextField/templates/nameFullTextField.tpl.html",link:function(b,c,d){function e(a){return"false"===a&&(a=!1),"true"===a&&(a=!0),a}b.editable=!1,b.loggedIn=!0,d.loggedIn&&(b.loggedIn=e(d.loggedIn)),d.$observe("loggedIn",function(a){b.loggedIn=e(a)}),b.canEdit=function(){if(b.loggedIn){if(b.nameForm&&b.nameForm.customFullText)return!0;var c=a("calculatedName")(b.nameForm.nameParts);return c?!0:!1}return!1};var f=angular.copy(b.nameForm.fullText),g=angular.copy(b.nameForm.customFullText);b.edit=function(){b.editable=!0,b.nameForm.customFullText||(b.nameForm.fullText=a("calculatedName")(b.nameForm.nameParts)),b.nameForm.customFullText=!0},b.cancelEdit=function(){b.editable=!1,b.nameForm.customFullText=g,b.nameForm.customFullText?b.nameForm.fullText=angular.copy(f):delete b.nameForm.fullText}}}}]),angular.module("rsmFields.namePartField",[]).directive("rsmNamePartField",["$filter",function(a){return{restrict:"E",require:"ngModel",scope:{nameParts:"=ngModel"},templateUrl:"scripts/person/directives/namePartField/templates/namePartField.tpl.html",link:function(b,c,d){function e(a){return"false"===a&&(a=!1),"true"===a&&(a=!0),a}b.label=d.label,b.name=d.name,b.mandatory=e(d.mandatory),b.loggedIn=d.loggedIn,d.$observe("loggedIn",function(a){b.loggedIn=e(a)}),d.$observe("nameParts",function(){b.parts=a("byType")(b.nameParts,b.name)}),b.qualifiers=JSON.parse(d.qualifiers),b.toggleQualifier=function(a,b){-1!==b.indexOf(a)?b.splice(b.indexOf(a),1):b.push(a)};var f=0;b.addField=function(){var a={type:b.name,value:"",_tempId:"t"+f++,qualifier:[angular.copy(b.qualifiers[0].value)],order:b.nameParts.length};b.nameParts.push(a),b.parts.push(a)},b.removedFields={},b.removeField=function(c){for(var d,e=0,f=b.nameParts.length;f>e;e++){var g=b.nameParts[e];if(g._tempId===c||g._id===c){g._id&&(b.removedFields[b.name]||(b.removedFields[b.name]={}),b.removedFields[b.name][c]=g),b.nameParts.splice(b.nameParts.indexOf(g),1),f--,d=e;break}}for(;f>d;d++)b.nameParts[d].value=b.nameParts[d].value,b.nameParts[d].order=d;b.parts=a("byType")(b.nameParts,b.name)},b.reinstateField=function(a,c){if(b.removedFields[a][c]){b.nameParts.splice(b.removedFields[a][c].order,0,b.removedFields[a][c]);for(var d=b.removedFields[a][c].order+1,e=b.nameParts.length;e>d;d++)b.nameParts[d].value=b.nameParts[d].value,b.nameParts[d].order=d;b.parts.push(b.removedFields[a][c])}}}}}]);var apiVersion,factModule=angular.module("fact",["person.filters","rorymadden.dateUtils","rsmFields.placeField","rsmFields.dateField","rsmFields.textField","rorymadden.confirmModal","rorymadden.placeAutoComplete","config"]),i,len,j,len2,k,len3,value,update,placeName,FactCtrl=factModule.controller("FactCtrl",["$scope","referenceData","security","languages","$translate","rsmDateUtils","$stateParams","server","api",function(a,b,c,d,e,f,g,h,i){a.languages=d.getAllLanguageCodes(),a.translate=e,a.factTypes=b.get("factTypes"),a.days=f.get("days"),a.months=f.get("months"),a.factGroup=g.relationshipId?"COUPLE"===a.relationship.relationship.type?"couple":"parentChild":"person",a.$watch(function(){return c.currentUser},function(b){a.edit.loggedIn=!!b}),apiVersion=h+i}]);factModule.controller("FactEditCtrl",["$scope","$stateParams","$translate","$http","$q","$state","growl","languages","titleService","$filter","factService","fact","rsmConfirmModal",function(a,b,c,d,e,f,g,h,l,m,n,o,p){function q(){a.content={title:c(m("valueName")(a.fact.type,a.factTypes))},l.setTitle(a.person.primaryName.displayName.nameWithDates+": "+a.content.title)}a.fact=angular.copy(o);var r=angular.copy(a.fact);if(a.$watch(function(){return n.fact},function(b){a.fact=angular.copy(b),angular.forEach(a.factTypes,function(b){a.fact&&b.value===a.fact.type&&(a.factType=b)})},!0),a.$on("$stateChangeStart",function(b,c,d){a.fact.values=m("parseTextValue")(a.fact.values),null===a.fact.values&&delete a.fact.values,a.fact.values&&0===a.fact.values.length&&!r.values&&(r.values=a.fact.values),null===a.fact.place&&delete a.fact.place,!a.fact.date||a.fact.date.startDateYear||a.fact.date.endDateYear||(a.fact.date=null),a.canTransition||angular.equals(r,a.fact)||(b.preventDefault(),p.open({action:"Unsaved"},function(){a.fact=angular.copy(r),f.go(c.name,d)}))}),q(),a.$on("$translateChangeSuccess",function(){q()}),a.edit.fields={type:!1},a.hide={date:!1,place:!1,text:!1},a.relationship&&a.relationship.relationship&&a.relationship.relationship.facts){var s=a.relationship.relationship.facts[0].type;"biologicalParent"===s&&(a.hide.date=!0,a.hide.text=!0,a.hide.place=!0)}a.canRemove=function(){return!a.edit.loggedIn||"birth"===o.type||"person"!==o.relType&&1===n.factSource.facts.length?!1:!0},a.submitted=!1,a.submit=function(c){if(a.submitted=!0,!c.$invalid){if(a.fact=m("parseFact")(a.fact),!a.fact.date&&!a.fact.values&&!a.fact.place)return g.addErrorMessage("Fact.Error.DataRequired"),void(a.submitted=!1);a.canTransition=!0;var e={};r.confidence!==a.fact.confidence&&(e.confidence=a.fact.confidence),r.type!==a.fact.type&&(e.type=a.fact.type);var h,l,o={};r.date&&!a.fact.date?l=r.date:r.date&&!angular.equals(r.date,a.fact.date)?a.fact.date.startDateYear&&(a.fact.date.startDateYear||a.fact.date.endDateYear)?(angular.forEach(Object.keys(a.fact.date),function(b){a.fact.date[b].constructor===Object||angular.equals(r.date[b],a.fact.date[b])||(o[b]=a.fact.date[b])}),r.date&&!a.fact.date._id&&(a.fact.date._id=r.date._id)):l=r.date:!r.date&&a.fact.date&&(h=!0);var p,q,s,t,u={},v=[],w={};r.place?a.fact.place?(r.place.lat!==a.fact.place.lat||r.place.lon!==a.fact.place.lon)&&(q=r.place,p=!0):q=r.place:!r.place&&a.fact.place&&(p=!0);var x=function(a){for(var b=a.concat(),c=0;c<b.length;++c)for(var d=c+1;d<b.length;++d)b[c]===b[d]&&b.splice(d--,1);return b},y=[],z=[],A=[];if(a.fact.values)for(i=0,len=a.fact.values.length;len>i;i++)value=a.fact.values[i],""===value.value?(a.fact.values.splice(i,1),len--,i--):value._id?y.push(value):(delete value._tempId,z.push(value),A.push(i));var B=[],C=[];r.values&&angular.forEach(r.values,function(a){var b=!1;angular.forEach(y,function(c){if(c._id===a._id&&(b=!0,!angular.equals(c,a))){update={};var d=x(Object.keys(c).concat(Object.keys(a)));angular.forEach(d,function(b){c[b]!==a[b]&&(update[b]=c[b])}),Object.keys(update).length&&B.push({_id:a._id,updates:update})}}),b||C.push({_id:a._id})});var D=[],E=[];if(a.fact.place&&a.fact.place.names&&!p)for(i=0,len=a.fact.place.names.length;len>i;i++)placeName=a.fact.place.names[i],placeName._id?D.push(placeName):(delete placeName._tempId,v.push(placeName),E.push(i));var F=[],G=[];if(r.place&&r.place.names&&a.fact.place&&!p)for(i=0,len=r.place.names.length;len>i;i++){placeName=r.place.names[i];var H=!1;for(j=0,len2=D.length;len2>j;j++){var I=D[j];if(I._id===placeName._id&&(H=!0,!angular.equals(I,placeName))){update={};var J=x(Object.keys(I).concat(Object.keys(placeName)));for(k=0,len3=J.length;len3>k;k++)I[J[k]]!==placeName[J[k]]&&(update[J[k]]=I[J[k]]);Object.keys(update).length&&F.push({_id:placeName._id,updates:update})}}H||q||G.push({_id:placeName._id})}var K=[],L="/person/"+b.personId;if(b.relationshipId&&(L+="/relationship/"+b.relationshipId),Object.keys(e).length>0&&K.push({record:"Fact",action:"update",ids:{personId:parseInt(b.personId,10),relationshipId:b.relationshipId?parseInt(b.relationshipId,10):void 0,factId:parseInt(b.factId,10),projectId:parseInt(b.projectId,10)},data:e}),h&&K.push({record:"Date",action:"create",ids:{personId:parseInt(b.personId,10),relationshipId:b.relationshipId?parseInt(b.relationshipId,10):void 0,factId:parseInt(b.factId,10),projectId:parseInt(b.projectId,10)},data:a.fact.date}),Object.keys(o).length>0&&K.push({record:"Date",action:"update",ids:{personId:parseInt(b.personId,10),relationshipId:b.relationshipId?parseInt(b.relationshipId,10):void 0,factId:parseInt(b.factId,10),dateId:a.fact.date._id,projectId:parseInt(b.projectId,10)},data:o}),l&&K.push({record:"Date",action:"remove",ids:{personId:parseInt(b.personId,10),relationshipId:b.relationshipId?parseInt(b.relationshipId,10):void 0,factId:parseInt(b.factId,10),dateId:l._id,projectId:parseInt(b.projectId,10)}}),p&&K.push({record:"Place",action:"create",ids:{personId:parseInt(b.personId,10),relationshipId:b.relationshipId?parseInt(b.relationshipId,10):void 0,factId:parseInt(b.factId,10),projectId:parseInt(b.projectId,10)},data:a.fact.place}),Object.keys(u).length>0&&K.push({record:"Place",action:"update",ids:{personId:parseInt(b.personId,10),relationshipId:b.relationshipId?parseInt(b.relationshipId,10):void 0,factId:parseInt(b.factId,10),placeId:a.fact.place._id,projectId:parseInt(b.projectId,10)},data:u}),s&&a.fact.place&&a.fact.place._id&&K.push({record:"PlaceDate",action:"create",ids:{personId:parseInt(b.personId,10),relationshipId:b.relationshipId?parseInt(b.relationshipId,10):void 0,factId:parseInt(b.factId,10),placeId:a.fact.place._id,dateId:a.fact.place.date,projectId:parseInt(b.projectId,10)},data:a.fact.place.date}),Object.keys(w).length>0&&K.push({record:"PlaceDate",action:"update",ids:{personId:parseInt(b.personId,10),relationshipId:b.relationshipId?parseInt(b.relationshipId,10):void 0,factId:parseInt(b.factId,10),placeId:a.fact.place._id,dateId:a.fact.place.date._id,projectId:parseInt(b.projectId,10)},data:w}),t&&K.push({record:"PlaceDate",action:"remove",ids:{personId:parseInt(b.personId,10),relationshipId:b.relationshipId?parseInt(b.relationshipId,10):void 0,factId:parseInt(b.factId,10),placeId:a.fact.place._id,dateId:a.fact.place.date._id,projectId:parseInt(b.projectId,10)}}),q&&K.push({record:"Place",action:"remove",ids:{personId:parseInt(b.personId,10),relationshipId:b.relationshipId?parseInt(b.relationshipId,10):void 0,factId:parseInt(b.factId,10),dateId:parseInt(b.dateId,10),placeId:q._id,projectId:parseInt(b.projectId,10)}}),z.length>0)for(i=0,len=z.length;len>i;i++)K.push({record:"FactValue",action:"create",ids:{personId:parseInt(b.personId,10),relationshipId:b.relationshipId?parseInt(b.relationshipId,10):void 0,factId:parseInt(b.factId,10),projectId:parseInt(b.projectId,10)},data:z[i]});if(B.length>0)for(i=0,len=B.length;len>i;i++)K.push({record:"FactValue",action:"update",ids:{personId:parseInt(b.personId,10),relationshipId:b.relationshipId?parseInt(b.relationshipId,10):void 0,factId:parseInt(b.factId,10),valueId:B[i]._id,projectId:parseInt(b.projectId,10)},data:B[i].updates});if(C.length>0)for(i=0,len=C.length;len>i;i++)K.push({record:"FactValue",action:"remove",ids:{personId:parseInt(b.personId,10),relationshipId:b.relationshipId?parseInt(b.relationshipId,10):void 0,factId:parseInt(b.factId,10),valueId:C[i]._id,projectId:parseInt(b.projectId,10)}});if(v.length>0)for(i=0,len=v.length;len>i;i++)a.fact.place&&a.fact.place._id&&K.push({record:"PlaceName",action:"create",ids:{personId:parseInt(b.personId,10),relationshipId:b.relationshipId?parseInt(b.relationshipId,10):void 0,factId:parseInt(b.factId,10),placeId:a.fact.place._id,projectId:parseInt(b.projectId,10)},data:v[i]});if(F.length>0)for(i=0,len=F.length;len>i;i++)K.push({record:"PlaceName",action:"update",ids:{personId:parseInt(b.personId,10),relationshipId:b.relationshipId?parseInt(b.relationshipId,10):void 0,factId:parseInt(b.factId,10),placeId:a.fact.place._id,nameId:F[i]._id,projectId:parseInt(b.projectId,10)},data:F[i].updates});if(G.length>0)for(i=0,len=G.length;len>i;i++)K.push({record:"PlaceName",action:"remove",ids:{personId:parseInt(b.personId,10),relationshipId:b.relationshipId?parseInt(b.relationshipId,10):void 0,factId:parseInt(b.factId,10),placeId:a.fact.place._id,nameId:G[i]._id,projectId:parseInt(b.projectId,10)}});d.post(apiVersion+"/multipleRequests",K).then(function(c){angular.forEach(c.data,function(b){h&&b.startDateYear&&(a.fact.date=b),p&&b.lat&&(a.fact.place=b),angular.forEach(v,function(c,d){b.value===c.value&&b.lang===c.lang&&(c._id=b._id,a.fact.place.names.splice(E[d],1,c))}),angular.forEach(z,function(c,d){b&&b.value===c.value&&b.lang===c.lang&&(c._id=b._id,a.fact.values.splice(A[d],1,c))})}),n.updateFact(a.fact,b.relationshipId),setTimeout(function(){a.$apply()},50),b.relationshipId?f.go("person.show.relationships",b):f.go("person.show.facts",b)},function(b){g.addServerMessages(b.data),a.submitted=!1,a.canTransition=!1;var c=0;angular.forEach(a.fact.values,function(a){a._id||(a._tempId="t"+c,c++)})})}},a.remove=function(){var c;c=a.relationship?"Relationship":"Fact",p.open({action:"Remove",type:c},function(){var c="/project/"+b.projectId+"/person/"+b.personId;b.relationshipId&&(c+="/relationship/"+b.relationshipId),d.delete(apiVersion+c+"/fact/"+a.fact._id).success(function(){n.removeFact(a.fact._id),a.canTransition=!0,b.relationshipId?f.go("person.show.relationships",b):f.go("person.show.facts",b)}).error(function(a){g.addServerMessages(a)})})}}]),factModule.controller("FactCreateCtrl",["$scope","$stateParams","referenceData","$http","$state","growl","languages","titleService","$filter","$translate","factService","rsmConfirmModal",function(a,b,c,d,e,f,g,h,j,k,l,m){function n(){a.content={title:k("Fact.CreateCtrl.Title")},h.setTitle(a.person.primaryName.displayName.nameWithDates+": "+a.content.title)}n(),a.$on("$translateChangeSuccess",function(){n()}),a.fact={relType:b.relationshipId?a.relationship.relationship.type.toLowerCase():"person",type:""};var o=angular.copy(a.fact);a.$on("$stateChangeStart",function(b,c,d){a.canTransition||angular.equals(o,a.fact)||(b.preventDefault(),m.open({action:"Unsaved"},function(){a.fact=angular.copy(o),e.go(c.name,d)}))}),a.setType=function(){for(i=0,len=a.factTypes.length;len>i;i++)if(a.factTypes[i].value===a.fact.type){a.factType=angular.copy(a.factTypes[i]);break}},a.edit.fields={type:!0},a.submitted=!1,a.submit=function(){if(a.submitted=!0,a.fact=j("parseFact")(a.fact),!a.fact.date&&!a.fact.values&&!a.fact.place)return f.addErrorMessage("Fact.Error.DataRequired"),void(a.submitted=!1);var c="/project/"+b.projectId+"/person/"+b.personId;b.relationshipId&&(c+="/relationship/"+b.relationshipId),d.post(apiVersion+c+"/facts",a.fact).success(function(c){l.addFact(c,b.relationshipId),a.canTransition=!0,b.relationshipId?e.go("person.show.relationships",b):e.go("person.show.facts",b)}).error(function(b){f.addServerMessages(b),a.submitted=!1;var c=0;angular.forEach(a.fact.values,function(a){a._id||(a._tempId="t"+c,c++)})})}}]),FactCtrl.getFact=["$stateParams","$state","factService",function(a,b,c){var d={personId:parseInt(a.personId,10),projectId:parseInt(a.projectId,10)};return a.relationshipId&&(d.relationshipId=parseInt(a.relationshipId,10)),c.getFact(d,a.factId).then(function(a){return a?a:void b.go("404")})}],factModule.config(["$stateProvider","securityAuthorizationProvider",function(a,b){a.state("fact",{url:"/fact","abstract":!0,parent:"person.show",templateUrl:"scripts/person/templates/abstract.tpl.html",controller:"FactCtrl"}).state("fact.create",{url:"/create",resolve:{auth:b.requireAuthenticatedUser},templateUrl:"scripts/person/templates/factForm.tpl.html",controller:"FactCreateCtrl"}).state("fact.show",{url:"/:factId",resolve:{fact:FactCtrl.getFact},templateUrl:"scripts/person/templates/factForm.tpl.html",controller:"FactEditCtrl"})}]);var apiVersion,relationshipModule=angular.module("relationship",["person.filters","ui.bootstrap","fact","rorymadden.placeAutoComplete","project.directive"]);relationshipModule.controller("RelationshipCtrl",["$scope","referenceData","security","projectService","$filter","server","api",function(a,b,c,d,e,f,g){a.relationshipTypeQualifiers=b.get("relationshipTypeQualifiers"),a.relationships=e("relationshipDetails")(a.person._id,d.project),a.$watch(c.currentUser,function(){a.edit.loggedIn=c.currentUser?!0:!1}),apiVersion=f+g}]),relationshipModule.controller("RelationshipCreateCtrl",["$scope","referenceData","languages","titleService","$filter","$http","$stateParams","growl","$state","personService","$translate","rsmConfirmModal","projectService","$modal","graphService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(){a.content={title:k("Relationship.CreateCtrl.Title")},d.setTitle(a.person.primaryName.displayName.nameWithDates+": "+a.content.title)}p(),a.$on("$translateChangeSuccess",function(){p()}),a.detailedRelationshipTypes=b.get("detailedRelationshipTypes"),a.genders=b.get("genders"),a.translate=k,a.selected={};var q=parseInt(g.personId,10);a.relationship={person:{living:!0,names:[{type:"birthName",primary:!0,nameForms:[{lang:c.getUserLanguage(),nameParts:[{type:"given",mandatory:!0,qualifier:"primary"},{type:"surname",mandatory:!0,qualifier:"family"},{type:"maiden",qualifier:"maiden"}]}]}],facts:[{relType:"person",type:"birth",date:{approximate:!1,range:"range"}},{relType:"person",type:"residence"},{relType:"person",type:"death",date:{approximate:!1,range:"range"}},{relType:"person",type:"burial"}],genders:[{primary:!0}]},facts:[{date:{approximate:!1,range:"range"}},{date:{approximate:!1,range:"range"}}]};var r=angular.copy(a.relationship);a.$on("$stateChangeStart",function(b,c,d){a.canTransition||angular.equals(r,a.relationship)||(b.preventDefault(),l.open({action:"Unsaved"},function(){a.relationship=angular.copy(r),i.go(c.name,d)}))}),a.edit.fields={type:!0,qualifier:!0,showQualifier:!0},m.getProject(g.projectId).then(function(b){a.projectData=b}),a.dates={};var s;a.onTypeChange=function(){a.relationship.potentialParents=[],a.relationship.potentialPartners=[],a.relationship.potentialChildren=[],a.dates={},a.edit.fields.qualifier=!0,a.edit.fields.showQualifier=!0,a.typeQualifiers=e("inArray")(a.relationshipTypeQualifiers,"relTypes",a.selected.type),s=e("byValue")(a.detailedRelationshipTypes,a.selected.type)[0];var b,c=[],d=[];if("couple"===s.relType&&(a.dates.startDate=!0,a.dates.startDateName=s.startDateName,-1!==["wife","husband","exWife","exHusband"].indexOf(a.selected.type)&&(a.selected.qualifier="marriage",a.edit.fields.showQualifier=!1),angular.forEach(m.project.links,function(d){d.sourceId===q&&"PARENT"===d.type&&(b=d.targetId),d.targetId===q&&"CHILD"===d.type&&(b=d.sourceId),b&&-1===c.indexOf(b)&&(c.push(b),a.relationship.potentialChildren.push({person:m.project.nodes[m.project.nodeIndex[b]],relationship:angular.copy(d)}))})),s.endDateName&&(a.dates.endDate=!0,a.dates.endDateName=s.endDateName),"parentChild"===s.relType)switch(a.selected.type){case"mother":case"father":d=[];var f=!1;b=null,angular.forEach(m.project.links,function(c){var e=angular.copy(c);c.sourceId===q&&"CHILD"===c.type?b=c.targetId:c.targetId===q&&"PARENT"===c.type&&(b=c.sourceId),b&&-1===d.indexOf(b)&&(d.push(b),delete e.subType,a.relationship.potentialPartners.push({person:m.project.nodes[m.project.nodeIndex[b]],relationship:e}),c.facts[0].value&&c.subType===a.selected.type&&"biologicalParent"===c.facts[0].type&&(f=!0))}),c=[],b=null,angular.forEach(m.project.links,function(e){-1!==d.indexOf(e.sourceId)&&"PARENT"===e.type&&e.targetId!==q&&(b=e.targetId),-1!==d.indexOf(e.targetId)&&"CHILD"===e.type&&e.sourceId!==q&&(b=e.sourceId),b&&-1===c.indexOf(b)&&(c.push(b),a.relationship.potentialChildren.push({person:m.project.nodes[m.project.nodeIndex[b]],relationship:angular.copy(e)}))}),f?(a.selected.qualifier=null,a.edit.fields.qualifier=!0):(a.dates.startDate=!1,a.typeQualifiers[0]&&(a.selected.qualifier=a.typeQualifiers[0].value),a.edit.fields.qualifier=!1);break;case"brother":case"sister":d=[],b=null,angular.forEach(m.project.links,function(c){c.sourceId===q&&"CHILD"===c.type?b=c.targetId:c.targetId===q&&"PARENT"===c.type&&(b=c.sourceId);var e=angular.copy(c);b&&-1===d.indexOf(b)&&(d.push(b),a.relationship.potentialParents.push({person:m.project.nodes[m.project.nodeIndex[b]],relationship:e}))}),a.dates.startDate=!1,a.dates.endDate=!1,a.selected.qualifier="sibling",a.edit.fields.showQualifier=!1;break;case"son":case"daughter":c=[],d=[],b=null,angular.forEach(m.project.links,function(e){if(e.sourceId===q&&"PARENT"===e.type&&-1===c.indexOf(e.targetId)&&c.push(e.targetId),e.targetId===q&&"CHILD"===e.type&&-1===c.indexOf(e.sourceId)&&c.push(e.sourceId),e.sourceId===q&&"COUPLE"===e.type&&(b=e.targetId),e.targetId===q&&"COUPLE"===e.type&&(b=e.sourceId),b&&-1===d.indexOf(b)){d.push(b);var f=m.project.nodes[m.project.nodeIndex[b]],g=angular.copy(e);"female"===f.gender&&(g.subType="mother"),"male"===f.gender&&(g.subType="father"),a.relationship.potentialParents.push({person:f,relationship:g})}}),angular.forEach(m.project.links,function(e){angular.forEach(c,function(c){b=null,e.sourceId===c&&"CHILD"===e.type&&e.targetId!==q&&(b=e.targetId),e.targetId===c&&"PARENT"===e.type&&e.sourceId!==q&&(b=e.sourceId);var f=angular.copy(e);b&&-1===d.indexOf(b)&&(d.push(b),a.relationship.potentialParents.push({person:m.project.nodes[m.project.nodeIndex[b]],relationship:f}))})}),angular.forEach(a.relationship.potentialParents,function(a){-1===["mother","father","son","daughter"].indexOf(a.relationship.subType)&&(a.relationship.facts[0].type="biologicalParent","male"===a.person.gender&&(a.relationship.subType="father"),"female"===a.person.gender&&(a.relationship.subType="mother"))}),a.dates.startDate=!1,a.selected.qualifier=a.typeQualifiers[0].value,a.edit.fields.qualifier=!1}s.gender&&(a.relationship.person.genders[0].gender=s.gender)},a.onTypeQualifierChange=function(){"parentChild"===s.relType&&"biologicalParent"!==a.selected.qualifier?(a.dates.startDate=!0,a.dates.startDateName="ReferenceData.DetailedRelationshipTypes.Dates.StartDateRelationship"):"biologicalParent"===a.selected.qualifier&&(a.dates.startDate=!1)},a.edit.removeLocation=function(b){delete a.relationship.person.facts[b].place};var t=[];a.edit.validateRelationships=function(){angular.forEach(t,function(b){"parent"===b.type&&a.relationship.potentialParents.push(b.value),"child"===b.type&&a.relationship.potentialChildren.push(b.value),"partner"===b.type&&a.relationship.potentialPartners.push(b.value)}),t=[];var b=a.relationship.existingPerson._id,c={};Object.keys(m.project.relationships[b]).forEach(function(a){c[a]||(c[a]=[]),angular.forEach(m.project.relationships[b][a],function(b){c[a].push(b.link)})}),angular.forEach(c.parent,function(b){var c=m.project.links[m.project.linkIndex[b]];angular.forEach(a.relationship.potentialParents,function(b){(b.person._id===c.sourceId||b.person._id===c.targetId)&&t.push({type:"parent",value:a.relationship.potentialParents.splice(a.relationship.potentialParents.indexOf(b),1)[0]})})}),angular.forEach(c.child,function(b){var c=m.project.links[m.project.linkIndex[b]];angular.forEach(a.relationship.potentialChildren,function(b){(b.person._id===c.sourceId||b.person._id===c.targetId)&&t.push({type:"child",value:a.relationship.potentialChildren.splice(a.relationship.potentialChildren.indexOf(b),1)[0]})})}),angular.forEach(c.couple,function(b){var c=m.project.links[m.project.linkIndex[b]];angular.forEach(a.relationship.potentialPartners,function(b){(b.person._id===c.sourceId||b.person._id===c.targetId)&&t.push({type:"partner",value:a.relationship.potentialPartners.splice(a.relationship.potentialPartners.indexOf(b),1)[0]})})})},a.edit.relatedPerson=!1,a.edit.newPerson=function(){a.edit.relatedPerson=!1,delete a.relationship.relatedPerson},a.edit.relatedPersonPrep=function(){a.edit.relatedPerson=!0},a.submit=function(b){if(a.submitted=!0,!b.$invalid)if(a.canTransition=!0,a.relationship.potentialParents.length>0||a.relationship.potentialPartners.length>0||a.relationship.potentialChildren.length>0){var c=n.open({templateUrl:"scripts/person/templates/relationshipPotentials.tpl.html",controller:["$scope","$modalInstance","relationship","detailedRelationshipTypes","$translate","selected",function(a,b,c,d,e,f){a.relationship=c,a.detailedRelationshipTypes=d,a.selected=f,a.translate=e,a.ok=function(){var c=u();if("sibling"!==a.selected.qualifier||c.exists)b.close();else{for(var d in c.removed)a.relationship[d]=c.removed[d];h.addErrorMessage(e("Relationship.Error.SiblingRequiresParent"))}},a.cancel=function(){angular.forEach(g,function(b){a.relationship[b.type].push(b.rel[0])}),b.dismiss("cancel")};var g=[];a.removeRelated=function(b,c){"sibling"===a.selected.qualifier&&"potentialParents"===c&&1===a.relationship[c].length?h.addErrorMessage(e("Relationship.Error.SiblingRequiresParent")):angular.forEach(a.relationship[c],function(d){if(d.person._id===b){var e={type:c,rel:a.relationship[c].splice(a.relationship[c].indexOf(d),1)};g.push(e)}})},a.partnerTypeChange=function(a){-1!==["wife","husband","exWife","exHusband"].indexOf(a.relationship.subType)&&(a.factType="marriage")}}],resolve:{relationship:function(){return a.relationship},detailedRelationshipTypes:function(){return a.detailedRelationshipTypes},selected:function(){return a.selected}}});c.result.then(function(){v(angular.copy(a.relationship))},function(){a.submitted=!1,a.canTransition=!1})}else v(angular.copy(a.relationship))};var u=function(){var b,c,d,e={potentialParents:[],potentialChildren:[],potentialPartners:[]};for(c=0,d=a.relationship.potentialParents.length;d>c;c++){var f=a.relationship.potentialParents[c];f.factType?b=!0:(e.potentialParents.push(a.relationship.potentialParents.splice(c,1)[0]),c--,d--)}for(c=0,d=a.relationship.potentialChildren.length;d>c;c++){var g=a.relationship.potentialChildren[c];g.factType?b=!0:(e.potentialChildren.push(a.relationship.potentialChildren.splice(c,1)[0]),c--,d--)}for(c=0,d=a.relationship.potentialPartners.length;d>c;c++){var h=a.relationship.potentialPartners[c];h.relationship.subType?b=!0:(e.potentialPartners.push(a.relationship.potentialPartners.splice(c,1)[0]),c--,d--)}return{exists:b,removed:e}},v=function(b){b.person.names[0].nameForms[0].nameParts[2].value||b.person.names[0].nameForms[0].nameParts.splice(2,1);var c,d=angular.copy(a.selected.type);if("sibling"===a.selected.qualifier&&("brother"===a.selected.type?a.selected.type="son":"sister"===a.selected.type&&(a.selected.type="daughter"),s=e("byValue")(a.detailedRelationshipTypes,a.selected.type)[0],c=b.potentialParents.pop(),a.selected.qualifier=c.relationship.facts[0].type),b.type=s.relType,b.subType=a.selected.type,b.facts[0].relType=b.type,b.facts[0].type=a.selected.qualifier,b.facts[1].relType=b.type,s.endDateName?(b.facts[1].type=e("oppositeFact")(a.selected.qualifier),b.facts[1].date&&(b.facts[1].date.approximate||(b.facts[0].date.endDateYear=b.facts[1].date.startDateYear,b.facts[0].date.endDateMonth=b.facts[1].date.startDateMonth,b.facts[0].date.endDateDay=b.facts[1].date.startDateDay,b.facts[0].date.approximate=!0,b.facts[0].date.range="range"),b.facts[1].date=e("parseDate")(b.facts[1].date)),b.facts[0].date=e("parseDate")(b.facts[0].date)):(b.facts.splice(1,1),b.facts[0].date=e("parseDate")(b.facts[0].date)),a.relationship.existingPerson)b[s.personType]=a.relationship.existingPerson,delete b.person,delete b.existingPerson;else{if(delete b.existingPerson,b.person.names[0].nameForms[0].fullText=e("calculatedName")(b.person.names[0].nameForms[0].nameParts),b.person.living?(b.person.facts.splice(2,2),b.person.facts[1].place||b.person.facts.splice(1,1)):(delete b.person.email,b.person.facts[3].place||b.person.facts.splice(3,1),b.person.facts[2].date?b.person.facts[2].date=e("parseDate")(b.person.facts[2].date):b.person.facts.splice(2,1),b.person.facts.splice(1,1)),!b.person.facts[0].date||!b.person.facts[0].date.startDateYear&&!b.person.facts[0].date.endDateYear){var j;j="couple"===s.personType?s.personType:"parent"===s.personType?"child":"parent";var k={type:j,facts:b.facts,person:a.person};if(c&&(k.person=c.person),b.person.facts[0].date=e("calculateDate")(b,k),!b.person.facts[0].date)return a.canTransition=!1,a.submitted=!1,h.addErrorMessage("Relationship.Error.CoupleStartDate")}b.person.facts[0].date=e("parseDate")(b.person.facts[0].date),b[s.personType]=[b.person],delete b.person}var l;l=c?c.person._id:g.personId,f.post(apiVersion+"/project/"+g.projectId+"/person/"+l+"/relationships",b).success(function(b){b.node&&m.addNode(b.node),angular.forEach(b.links,function(a){m.addRelationship(a)}),m.update(b.project),o.calculateLevels(m.project.levels),o.drawGraph(),setTimeout(function(){a.$apply()},600),i.go("person.show.relationships",g)}).error(function(b){h.addServerMessages(b),a.canTransition=!1,a.submitted=!1,c&&(a.selected.qualifier="sibling",a.selected.type=d)})}}]),relationshipModule.controller("RelationshipEditCtrl",["$scope","referenceData","$stateParams",function(a,b,c){var d=parseInt(c.relationshipId,10);angular.forEach(a.relationships.parent,function(b){b.relationship._id===d&&(a.relationship=b)}),angular.forEach(a.relationships.child,function(b){b.relationship._id===d&&(a.relationship=b)}),angular.forEach(a.relationships.couple,function(b){b.relationship._id===d&&(a.relationship=b)})}]),relationshipModule.config(["$stateProvider","securityAuthorizationProvider",function(a,b){a.state("relationship",{url:"/relationship","abstract":!0,parent:"person.show",templateUrl:"scripts/person/templates/abstract.tpl.html",controller:"RelationshipCtrl"}).state("relationship.create",{url:"/create",resolve:{auth:b.requireAuthenticatedUser},templateUrl:"scripts/person/templates/relationshipForm.tpl.html",controller:"RelationshipCreateCtrl"}).state("relationship.show",{url:"/:relationshipId","abstract":!0,templateUrl:"scripts/person/templates/abstract.tpl.html",controller:"RelationshipEditCtrl"}).state("relationship.fact",{url:"/fact","abstract":!0,parent:"relationship.show",templateUrl:"scripts/person/templates/abstract.tpl.html",controller:"FactCtrl"}).state("relationship.fact.create",{url:"/create",resolve:{auth:b.requireAuthenticatedUser},templateUrl:"scripts/person/templates/factForm.tpl.html",controller:"FactCreateCtrl"}).state("relationship.fact.show",{url:"/:factId",templateUrl:"scripts/person/templates/factForm.tpl.html",controller:"FactEditCtrl",resolve:{fact:FactCtrl.getFact}})}]),angular.module("rsmFields.placeField",[]).directive("rsmPlaceField",["googleMaps","$filter",function(a){return{restrict:"E",require:"ngModel",scope:{place:"=ngModel"},templateUrl:"scripts/person/directives/placeField/templates/placeField.tpl.html",link:function(b,c,d,e){function f(a){return"false"===a&&(a=!1),"true"===a&&(a=!0),a}b.loggedIn=!0,d.loggedIn&&(b.loggedIn=f(d.loggedIn)),d.$observe("loggedIn",function(a){b.loggedIn=f(a)}),b.show=!0,d.show&&(b.show=f(d.show)),d.$observe("show",function(a){b.show=f(a),b.show||b.place&&(!b.place||b.place.lat)||b.removePlace()}),b.hide=!1,d.hide&&(b.hide=f(d.hide)),b.label=d.label||"rsmPlaceField.Place",b.optional=f(d.optional),b.showPlace=function(){b.show=!0},b.removePlace=function(a){b.place=null,angular.element(c.find("input")[0]).val(""),b.show=a?!0:!1},b.preventSubmission=function(a){13===a.which&&a.preventDefault()},!b.hide&&b.loggedIn&&a.runMap().then(function(){var a,f="en",g={language:f};b.gPlace=new google.maps.places.Autocomplete(c.find("input")[0],g),google.maps.event.addListener(b.gPlace,"place_changed",function(){var c=b.gPlace.getPlace();c.geometry&&(a={lat:c.geometry.location.lat(),lon:c.geometry.location.lng(),names:[{lang:f,value:c.formatted_address}]},b.$apply(function(){b.place=a}))});var h=function(){var b=!0;b=c.val()&&(!a||a&&!a.lat)?!1:!0,e.$setValidity("place",b)};b.$watch(d.ngModel,function(){h()})})}}}]),angular.module("rsmFields.dateField",[]).directive("rsmDateField",["$translate","rsmDateUtils",function(a,b){return{restrict:"E",require:"ngModel",scope:{date:"=ngModel"},templateUrl:"scripts/person/directives/dateField/templates/dateField.tpl.html",link:function(c,d,e){function f(a){return"false"===a&&(a=!1),"true"===a&&(a=!0),a}c.loggedIn=!0,e.loggedIn&&(c.loggedIn=f(e.loggedIn)),e.$observe("loggedIn",function(a){c.loggedIn=f(a)}),c.days=b.get("days"),c.months=b.get("months"),c.dateElements={},c.translate=a,e.$observe("show",function(){var a=f(e.show);c.show=a||c.date&&(c.date.startDateYear||c.date.endDateYear)?!0:!1,c.show&&!c.date&&c.showDate(),c.show||!c.date||c.date.startDateYear||c.date.endDateYear||c.removeDate()}),c.hide=!1,e.hide&&(c.hide=f(e.hide)),c.label=e.label||"rsmDateField.Date",c.optional=f(e.optional),c.dateRangeOptions=[{value:"range",name:"ReferenceData.DateRangeOptions.Range"},{value:"before",name:"ReferenceData.DateRangeOptions.Before"},{value:"after",name:"ReferenceData.DateRangeOptions.After"}],c.setDateRangeOption=function(){"range"===c.date.range&&(c.dateElements.startDate=!0,c.dateElements.endDate=!0),"before"===c.date.range&&(c.dateElements.startDate=!1,c.dateElements.endDate=!0),"after"===c.date.range&&(c.dateElements.startDate=!0,c.dateElements.endDate=!1)
},c.setDateType=function(){c.date&&c.date.approximate?this.setDateRangeOption():(c.dateElements.startDate=!0,c.dateElements.endDate=!1)},c.setDateType(),c.checkDate=function(a,c){var d={year:c+"DateYear",month:c+"DateMonth",day:c+"DateDay"},e=b.checkDate(a,d);e&&(a=e)},c.showDate=function(){c.show=!0,c.date||(c.date={}),c.date.approximate=!1,c.date.range="range"},c.removeDate=function(){c.date&&(c.date=null),c.dateElements.startDate=!1,c.dateElements.endDate=!1,c.show=!1}}}}]),angular.module("rsmFields.textField",[]).directive("rsmTextField",["$translate","languages",function(a,b){return{restrict:"E",scope:{values:"="},templateUrl:"scripts/person/directives/textField/templates/textField.tpl.html",link:function(c,d,e){function f(a){return"false"===a&&(a=!1),"true"===a&&(a=!0),a}c.loggedIn=f(e.loggedIn),e.$observe("loggedIn",function(a){c.loggedIn=f(a)}),c.values||(c.values=[]),c.hide=f(e.hide),c.label=e.label,e.$observe("label",function(a){c.label=a}),c.translate=a,c.languages=b.getAllLanguageCodes();var g=0;c.addValue=function(){var a=b.getUserLanguage(),d=!1;angular.forEach(c.values,function(b){b.lang===a&&(a="",d=!0)}),c.values.push({lang:a,value:"",showLanguage:d,_tempId:"t"+g++})},f(e.show)&&c.loggedIn&&0===c.values.length&&c.addValue(),e.$observe("show",function(){f(e.show)||1!==c.values.length||""===c.values[0].value&&(c.values=[]),f(e.show)&&c.loggedIn&&0===c.values.length&&c.addValue()}),c.removedValues={},c.removeValue=function(a){for(var b,d=0,e=c.values.length;e>d;d++){var f=c.values[d];if(f._tempId===a||f._id===a){f._id&&(c.removedValues[a]=f),c.values.splice(c.values.indexOf(f),1),e--,b=d;break}}},c.reinstateValue=function(a){c.removedValues[a]&&c.values.push(c.removedValues[a])},c.toggleValueLanguage=function(a){c.values[a].showLanguage=!c.values[a].showLanguage}}}}]),angular.module("rorymadden.placeAutoComplete",[]).provider("googleMaps",function(){var a={libraries:"places"},b=function(b,c){var d=this;this.makeMap=function(){var b="https://maps.googleapis.com/maps/api/js?",c=function(){angular.forEach(a,function(a,c){b+="&"+c+"="+a})};return a&&-1!==Object.keys(a).indexOf("sensor")?c():a?(a.sensor=!1,c()):b+="?sensor=false&v=3.14",b},this.runMapDeferred=null,this.runMap=function(){if(this.runMapDeferred)return this.runMapDeferred.promise;var a=b.defer();if(this.runMapDeferred=a,"undefined"!=typeof c.google&&"undefined"!=typeof c.google.maps)return a.resolve(c.google.maps),a.promise;var e="onGoogleMapsReady"+Math.round(1e3*Math.random());window[e]=function(){window[e]=null,a.resolve(c.google.maps)};var f=document.createElement("script");return f.type="text/javascript",f.src=d.makeMap()+"&callback="+e,document.body.appendChild(f),a.promise}};this.useSensor=function(b){b&&(a.sensor=b)},this.apiKey=function(b){return b?(a.key=b,this):void 0},this.useLanguage=function(b){return b?(a.language=b,this):void 0},this.useLibrary=function(b){return b?(a.libraries=b,this):void 0},this.useVersion=function(b){return b?(a.v=b,this):void 0},this.$get=["$q","$window",function(a,c){return new b(a,c)}]}),angular.module("rsmFields.relationshipTypeField",[]).directive("rsmRelationshipTypeField",["$filter","$http","referenceData","$translate","growl",function(a,b,c,d,e){return{restrict:"E",scope:{relationship:"="},templateUrl:"scripts/person/directives/relationshipTypeField/templates/relationshipTypeField.tpl.html",link:function(a,f,g){function h(a){return"false"===a&&(a=!1),"true"===a&&(a=!0),a}a.editable=!1,a.translate=d,a.factTypes=c.get("factTypes"),a.detailedRelationshipTypes=c.get("detailedRelationshipTypes"),g.$observe("loggedIn",function(b){a.loggedIn=h(b)}),a.params=JSON.parse(g.params);var i=angular.copy(a.relationship.subType);a.edit=function(){a.editable=!0},a.cancelEdit=function(){a.editable=!1},a.updateType=function(){b.put(apiVersion+"/project/"+a.params.projectId+"/person/"+a.params.personId+"/relationship/"+a.relationship._id,{subType:a.relationship.subType}).success(function(){i=angular.copy(a.relationship.subType),a.editable=!1,e.addSuccessMessage("Person.PersonViewCtrl.RecordUpdated")}).error(function(b){a.relationship.subType=angular.copy(i),e.addServerMessages(b)})}}}}]);